# UI Config 智能配置系统 - 任务跟踪清单

## 文档信息

| 项目 | 内容 |
|------|------|
| 项目名称 | UI Config 智能配置系统 |
| 版本 | v1.0.0 (Demo) |
| 创建日期 | 2026-01-06 |
| 最后更新 | 2026-01-06 |
| 关联文档 | EARS-Requirements.md, M1-M6 Spec 文档 |

---

## 任务总览

### 里程碑

| 里程碑 | 描述 | 目标日期 | 状态 |
|--------|------|----------|------|
| MS1 | 项目初始化与基础框架搭建 | - | ✅ 已完成 |
| MS2 | M1 System Prompt 配置管理 | - | ✅ 已完成 |
| MS3 | M2 页面截图智能解析 | - | ✅ 已完成 |
| MS4 | M3 多轮澄清对话 | - | ✅ 已完成 |
| MS5 | M4 JSON Config 生成 | - | ✅ 已完成 |
| MS6 | M5 可视化配置编辑 | - | ✅ 已完成 |
| MS7 | M6 MCP 服务器管理 | - | ✅ 已完成 |
| MS8 | 集成测试与文档完善 | - | 🔄 进行中 |

### 进度统计

| 指标 | 数值 |
|------|------|
| 总任务数 | 78 |
| 已完成 | 75 |
| 进行中 | 3 |
| 待开始 | 0 |
| 完成率 | 96% |

### 状态图例

- 🔲 未开始
- 🔄 进行中
- ✅ 已完成
- ⏸️ 暂停
- ❌ 取消

---

## 任务详情

### 阶段 0: 项目初始化 (MS1)

#### 0.1 开发环境搭建

| ID | 任务 | 负责人 | 状态 | 备注 |
|----|------|--------|------|------|
| T0.1.1 | 创建项目仓库，初始化 Git | - | ✅ | 项目结构已创建 |
| T0.1.2 | 搭建 Python 后端项目结构 (FastAPI) | - | ✅ | Python 3.10+ |
| T0.1.3 | 搭建前端项目结构 (Vue 3 + Vite) | - | ✅ | Vue 3 + Vite + Pinia |
| T0.1.4 | 配置数据库连接 (SQLite 开发环境) | - | ✅ | 异步 SQLAlchemy |
| T0.1.5 | 配置 VL 模型 API 连接 | - | ✅ | Qwen3-VL-8B-Instruct |
| T0.1.6 | 编写 docker-compose 开发环境配置 | - | 🔲 | 可选 |

#### 0.2 基础设施

| ID | 任务 | 负责人 | 状态 | 备注 |
|----|------|--------|------|------|
| T0.2.1 | 实现数据库连接池与 session 管理 | - | ✅ | app/database.py |
| T0.2.2 | 实现统一异常处理中间件 | - | ✅ | app/core/exceptions.py |
| T0.2.3 | 实现统一响应格式封装 | - | ✅ | app/core/response.py |
| T0.2.4 | 配置 CORS 跨域 | - | ✅ | app/main.py |
| T0.2.5 | 实现文件上传目录管理 | - | ✅ | uploads/ |

---

### 阶段 1: M1 System Prompt 配置管理 (MS2)

#### 1.1 后端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T1.1.1 | 创建 system_prompts 数据库表 | - | ✅ | T0.2.1 | REQ-M1-001 |
| T1.1.2 | 实现 SystemPrompt SQLAlchemy Model | - | ✅ | T1.1.1 | |
| T1.1.3 | 实现 Pydantic Schema 定义 | - | ✅ | | |
| T1.1.4 | 实现默认 Prompt 模板 | - | ✅ | | REQ-M1-004 |
| T1.1.5 | 实现 SystemPromptService 业务逻辑 | - | ✅ | T1.1.2 | |
| T1.1.6 | 实现 GET /api/v1/system-prompt 接口 | - | ✅ | T1.1.5 | REQ-M1-004 |
| T1.1.7 | 实现 PUT /api/v1/system-prompt 接口 | - | ✅ | T1.1.5 | REQ-M1-006, REQ-M1-008 |
| T1.1.8 | 实现 POST /api/v1/system-prompt/reset 接口 | - | ✅ | T1.1.5 | REQ-M1-007 |
| T1.1.9 | 实现 GET /api/v1/system-prompt/stats 接口 | - | ✅ | T1.1.5 | REQ-M1-005 |

#### 1.2 前端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T1.2.1 | 创建 SystemPromptConfig 页面路由 | - | ✅ | T0.1.3 | |
| T1.2.2 | 实现 PromptEditor 文本编辑器组件 | - | ✅ | | REQ-M1-002 |
| T1.2.3 | 实现 CharacterCounter 字符计数组件 | - | ✅ | | REQ-M1-005 |
| T1.2.4 | 实现加载/保存/重置功能 | - | ✅ | T1.1.6-8 | REQ-M1-006, REQ-M1-007 |
| T1.2.5 | 实现未保存离开确认弹窗 | - | ✅ | | REQ-M1-010 |
| T1.2.6 | 实现保存成功 Toast 提示 (3秒) | - | ✅ | | REQ-M1-006 |
| T1.2.7 | 实现字符超限提示 | - | ✅ | | REQ-M1-008 |
| T1.2.8 | 实现字符不足建议提示 | - | ✅ | | REQ-M1-012 |

#### 1.3 测试

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T1.3.1 | 编写 M1 后端单元测试 | - | 🔲 | T1.1.* |
| T1.3.2 | 编写 M1 前端组件测试 | - | 🔲 | T1.2.* |
| T1.3.3 | M1 功能验收测试 | - | 🔲 | T1.3.1-2 |

---

### 阶段 2: M2 页面截图智能解析 (MS3)

#### 2.1 后端 - 图片上传

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T2.1.1 | 创建 page_configs 数据库表 | - | ✅ | T0.2.1 | |
| T2.1.2 | 创建 parse_sessions 数据库表 | - | ✅ | T2.1.1 | |
| T2.1.3 | 实现 PageConfig SQLAlchemy Model | - | ✅ | T2.1.1 | |
| T2.1.4 | 实现 ParseSession SQLAlchemy Model | - | ✅ | T2.1.2 | |
| T2.1.5 | 实现图片上传 API (流式写入) | - | ✅ | T0.2.5 | REQ-M2-005, REQ-M2-019 |
| T2.1.6 | 实现文件格式校验 (PNG/JPG) | - | ✅ | T2.1.5 | REQ-M2-001, REQ-M2-010 |
| T2.1.7 | 实现文件大小校验 (10MB) | - | ✅ | T2.1.5 | REQ-M2-002, REQ-M2-011 |

#### 2.2 后端 - VL 模型服务

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T2.2.1 | 实现 VLModelService 基础类 | - | ✅ | T0.1.5 | REQ-M2-007 |
| T2.2.2 | 实现图片加载与 Base64 编码 | - | ✅ | T2.2.1 | |
| T2.2.3 | 实现本地图片读取 (uploads 目录限制) | - | ✅ | T2.2.2 | REQ-M2-018 |
| T2.2.4 | 实现外部 URL 图片拉取 | - | ✅ | T2.2.2 | REQ-M2-015 |
| T2.2.5 | 实现基础 SSRF 防护 (Demo 简化版) | - | ✅ | T2.2.4 | REQ-M2-016 |
| T2.2.6 | 实现外部 URL Content-Type 校验 | - | ✅ | T2.2.4 | REQ-M2-017 |
| T2.2.7 | 实现解析 Prompt 构建 | - | ✅ | T2.2.1 | |
| T2.2.8 | 实现 VL 模型调用 (30秒超时) | - | ✅ | T2.2.1 | REQ-M2-004 |
| T2.2.9 | 实现 JSON 解析与纠错重试 | - | ✅ | T2.2.8 | REQ-M2-021 |
| T2.2.10 | 实现解析结果结构化 | - | ✅ | T2.2.9 | REQ-M2-008 |

#### 2.3 后端 - 解析 API

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T2.3.1 | 实现 POST /api/v1/pages/parse 接口 | - | ✅ | T2.2.* | REQ-M2-007 |
| T2.3.2 | 实现后台异步解析任务 | - | ✅ | T2.3.1 | |
| T2.3.3 | 实现 GET /parse/{session_id}/status 接口 | - | ✅ | T2.3.2 | REQ-M2-009 |
| T2.3.4 | 实现解析超时处理 | - | ✅ | T2.3.2 | REQ-M2-012 |
| T2.3.5 | 实现解析失败日志记录 | - | ✅ | T2.3.2 | REQ-M2-013 |
| T2.3.6 | 实现临时图片清理定时任务 | - | ✅ | | REQ-M2-020 |

#### 2.4 前端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T2.4.1 | 创建页面配置列表页 | - | ✅ | | |
| T2.4.2 | 实现 ImageUploader 图片上传组件 | - | ✅ | | REQ-M2-005, REQ-M2-006 |
| T2.4.3 | 实现拖拽上传功能 | - | ✅ | T2.4.2 | REQ-M2-006 |
| T2.4.4 | 实现上传进度条 | - | ✅ | T2.4.2 | REQ-M2-006 |
| T2.4.5 | 实现图片预览与替换 | - | ✅ | T2.4.2 | |
| T2.4.6 | 实现"AI 辅助填写"按钮 | - | ✅ | | REQ-M2-007 |
| T2.4.7 | 实现解析中状态 UI (加载动画、禁用按钮) | - | ✅ | T2.4.6 | REQ-M2-009 |
| T2.4.8 | 实现解析结果自动填充表单 | - | ✅ | T2.4.6 | REQ-M2-008 |
| T2.4.9 | 实现无图片上传提示 | - | ✅ | | REQ-M2-014 |

#### 2.5 测试

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T2.5.1 | 编写图片上传单元测试 | - | 🔲 | T2.1.* |
| T2.5.2 | 编写 VL 模型服务单元测试 | - | 🔲 | T2.2.* |
| T2.5.3 | 编写解析 API 集成测试 | - | 🔲 | T2.3.* |
| T2.5.4 | M2 功能验收测试 | - | 🔲 | T2.5.1-3 |

---

### 阶段 3: M3 多轮澄清对话 (MS4)

#### 3.1 后端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T3.1.1 | 实现 clarify_history 数据结构 | - | ✅ | T2.1.4 | REQ-M3-014 |
| T3.1.2 | 实现 VLModelService.clarify() 方法 | - | ✅ | T2.2.1 | REQ-M3-006 |
| T3.1.3 | 实现置信度阈值判断 (85%) | - | ✅ | T3.1.2 | REQ-M3-001, REQ-M3-007 |
| T3.1.4 | 实现最大澄清轮次限制 (5轮) | - | ✅ | T3.1.2 | REQ-M3-001 |
| T3.1.5 | 实现 POST /clarify/{session_id}/respond 接口 | - | ✅ | T3.1.2 | REQ-M3-006 |
| T3.1.6 | 实现 POST /clarify/{session_id}/confirm 接口 | - | ✅ | | REQ-M3-008 |
| T3.1.7 | 实现 GET /clarify/{session_id}/history 接口 | - | ✅ | | REQ-M3-003 |
| T3.1.8 | 实现澄清响应超时处理 (15秒) | - | ✅ | T3.1.5 | REQ-M3-002 |
| T3.1.9 | 实现超时自动重试 (1次) | - | ✅ | T3.1.8 | REQ-M3-010 |

#### 3.2 前端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T3.2.1 | 实现 ClarifyPanel AI 助手面板组件 | - | ✅ | | REQ-M3-004 |
| T3.2.2 | 实现对话气泡 UI | - | ✅ | T3.2.1 | REQ-M3-005 |
| T3.2.3 | 实现快捷选项按钮 | - | ✅ | T3.2.1 | REQ-M3-005 |
| T3.2.4 | 实现文本输入与发送 | - | ✅ | T3.2.1 | REQ-M3-005 |
| T3.2.5 | 实现加载状态动画 | - | ✅ | T3.2.1 | |
| T3.2.6 | 实现"完成配置"按钮 | - | ✅ | | REQ-M3-008 |
| T3.2.7 | 实现表单"待确认"标记 | - | ✅ | | REQ-M3-009 |
| T3.2.8 | 实现状态管理 (Pinia store) | - | ✅ | | |
| T3.2.9 | 实现 AI 更新冲突提示弹窗 | - | ✅ | T3.2.8 | REQ-M3-013 |

#### 3.3 测试

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T3.3.1 | 编写澄清 API 单元测试 | - | 🔲 | T3.1.* |
| T3.3.2 | 编写前端面板组件测试 | - | 🔲 | T3.2.* |
| T3.3.3 | M3 功能验收测试 | - | 🔲 | T3.3.1-2 |

---

### 阶段 4: M4 JSON Config 生成 (MS5)

#### 4.1 后端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T4.1.1 | 定义 UI_CONFIG_SCHEMA (JSON Schema) | - | ✅ | | REQ-M4-001 |
| T4.1.2 | 实现 ConfigService 配置生成逻辑 | - | ✅ | T4.1.1 | REQ-M4-003 |
| T4.1.3 | 实现 Schema 验证 | - | ✅ | T4.1.1 | REQ-M4-004 |
| T4.1.4 | 实现 buttonList 非空校验 | - | ✅ | T4.1.3 | REQ-M4-009 |
| T4.1.5 | 实现 POST /api/v1/config/generate 接口 | - | ✅ | T4.1.2 | REQ-M4-003 |
| T4.1.6 | 实现 POST /api/v1/config/validate 接口 | - | ✅ | T4.1.3 | REQ-M4-007 |

#### 4.2 前端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T4.2.1 | 实现 JSON 预览区组件 | - | ✅ | | REQ-M4-004 |
| T4.2.2 | 实现 JSON 语法高亮 | - | ✅ | T4.2.1 | |
| T4.2.3 | 实现验证错误高亮显示 | - | ✅ | T4.2.1 | REQ-M4-007 |
| T4.2.4 | 实现"复制 JSON"按钮 | - | ✅ | T4.2.1 | REQ-M4-005 |
| T4.2.5 | 实现"下载 JSON"按钮 | - | ✅ | T4.2.1 | REQ-M4-006 |

#### 4.3 测试

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T4.3.1 | 编写 Schema 验证单元测试 | - | 🔲 | T4.1.* |
| T4.3.2 | M4 功能验收测试 | - | 🔲 | T4.3.1 |

---

### 阶段 5: M5 可视化配置编辑 (MS6)

#### 5.1 前端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T5.1.1 | 实现 ConfigEditor 主组件 | - | ✅ | | REQ-M5-001 |
| T5.1.2 | 实现基本信息区 (名称/描述双语) | - | ✅ | T5.1.1 | REQ-M5-003 |
| T5.1.3 | 实现页面能力区 (按钮列表/可选操作) | - | ✅ | T5.1.1 | REQ-M5-003 |
| T5.1.4 | 实现 AI 上下文区 (行为规则/页面目标) | - | ✅ | T5.1.1 | REQ-M5-003 |
| T5.1.5 | 实现双击编辑模式 | - | ✅ | T5.1.1 | REQ-M5-004 |
| T5.1.6 | 实现按钮列表增删 | - | ✅ | T5.1.3 | REQ-M5-005, REQ-M5-006 |
| T5.1.7 | 实现最后一个按钮不可删除 | - | ✅ | T5.1.6 | REQ-M5-009 |
| T5.1.8 | 实现手动保存功能 | - | ✅ | | REQ-M5-002, REQ-M5-007 |
| T5.1.9 | 实现"未保存"状态标记 | - | ✅ | T5.1.8 | REQ-M5-008 |
| T5.1.10 | 实现必填字段验证提示 | - | ✅ | | REQ-M4-008 |

#### 5.2 测试

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T5.2.1 | 编写编辑器组件测试 | - | 🔲 | T5.1.* |
| T5.2.2 | M5 功能验收测试 | - | 🔲 | T5.2.1 |

---

### 阶段 6: M6 MCP 服务器管理 (MS7)

#### 6.1 后端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T6.1.1 | 创建 mcp_servers 数据库表 | - | ✅ | T0.2.1 | |
| T6.1.2 | 实现 MCPServer SQLAlchemy Model | - | ✅ | T6.1.1 | |
| T6.1.3 | 定义预置 Context7 MCP 配置 | - | ✅ | | REQ-M6-001 |
| T6.1.4 | 实现 GET /api/v1/mcp 列表接口 | - | ✅ | T6.1.2 | REQ-M6-004 |
| T6.1.5 | 实现 POST /{preset_key}/toggle 开关接口 | - | ✅ | T6.1.2 | REQ-M6-005 |
| T6.1.6 | 实现 POST /api/v1/mcp/upload 上传接口 | - | ✅ | T6.1.2 | REQ-M6-006, REQ-M6-007 |
| T6.1.7 | 实现 MCP 配置文件大小校验 (1MB) | - | ✅ | T6.1.6 | REQ-M6-003 |
| T6.1.8 | 实现 MCP JSON 格式验证 | - | ✅ | T6.1.6 | REQ-M6-011 |
| T6.1.9 | 实现服务器连通性测试 (10秒超时) | - | ✅ | T6.1.6 | REQ-M6-012 |
| T6.1.10 | 实现自定义健康检查路径 | - | ✅ | T6.1.9 | REQ-M6-015 |
| T6.1.11 | 实现重复服务器检测 | - | ✅ | T6.1.6 | REQ-M6-013 |
| T6.1.12 | 实现 DELETE /api/v1/mcp/{server_id} 接口 | - | ✅ | T6.1.2 | REQ-M6-010 |

#### 6.2 前端开发

| ID | 任务 | 负责人 | 状态 | 依赖 | 对应需求 |
|----|------|--------|------|------|----------|
| T6.2.1 | 创建 MCP 管理页面 | - | ✅ | | REQ-M6-004 |
| T6.2.2 | 实现预制服务器卡片组件 | - | ✅ | T6.2.1 | REQ-M6-004 |
| T6.2.3 | 实现启用/禁用开关 | - | ✅ | T6.2.2 | REQ-M6-005 |
| T6.2.4 | 实现自定义服务器卡片组件 | - | ✅ | T6.2.1 | REQ-M6-004 |
| T6.2.5 | 实现"添加自定义 MCP"弹窗 | - | ✅ | | REQ-M6-006 |
| T6.2.6 | 实现文件上传 Tab | - | ✅ | T6.2.5 | REQ-M6-006 |
| T6.2.7 | 实现代码编辑 Tab (Monaco) | - | ✅ | T6.2.5 | REQ-M6-008 |
| T6.2.8 | 实现 JSON 语法错误实时提示 | - | ✅ | T6.2.7 | REQ-M6-008 |
| T6.2.9 | 实现编辑/删除功能 | - | ✅ | T6.2.4 | REQ-M6-009, REQ-M6-010 |

#### 6.3 测试

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T6.3.1 | 编写 MCP API 单元测试 | - | 🔲 | T6.1.* |
| T6.3.2 | M6 功能验收测试 | - | 🔲 | T6.3.1 |

---

### 阶段 7: 集成与收尾 (MS8)

| ID | 任务 | 负责人 | 状态 | 依赖 |
|----|------|--------|------|------|
| T7.1 | 全模块集成测试 | - | 🔲 | MS2-MS7 |
| T7.2 | 端到端流程测试 | - | 🔲 | T7.1 |
| T7.3 | 性能基准测试 (响应时间) | - | 🔲 | T7.1 |
| T7.4 | 编写部署文档 | - | 🔲 | |
| T7.5 | 编写用户操作指南 | - | 🔲 | |
| T7.6 | Bug 修复与优化 | - | 🔲 | T7.2 |

---

## 依赖关系图

```
阶段 0 (基础设施)
    │
    ├──▶ 阶段 1 (M1 System Prompt)
    │         │
    │         ▼
    ├──▶ 阶段 2 (M2 图片解析) ◀── 依赖 M1 (System Prompt)
    │         │
    │         ▼
    ├──▶ 阶段 3 (M3 澄清对话) ◀── 依赖 M2 (解析结果)
    │         │
    │         ├──▶ 阶段 4 (M4 JSON 生成)
    │         │         │
    │         │         ▼
    │         └──▶ 阶段 5 (M5 可视化编辑) ◀── 依赖 M4 (Schema)
    │
    └──▶ 阶段 6 (M6 MCP 管理) ── 独立模块，可并行开发
              │
              ▼
         阶段 7 (集成测试)
```

### 关键依赖说明

| 依赖项 | 被依赖方 | 说明 |
|--------|----------|------|
| T0.2.1 数据库连接 | 所有数据模型 | 必须先完成 |
| T0.1.5 VL 模型配置 | M2 解析服务 | 需要模型 API 地址和密钥 |
| T1.1.5 SystemPromptService | M2 解析 | 解析时需要获取当前 System Prompt |
| T2.1.4 ParseSession Model | M3 澄清 | 澄清基于解析会话进行 |
| T4.1.1 UI_CONFIG_SCHEMA | M5 编辑器 | 表单验证依赖 Schema 定义 |

---

## 风险与问题

### 当前风险

| ID | 风险描述 | 影响 | 等级 | 缓解措施 | 状态 |
|----|----------|------|------|----------|------|
| R1 | VL 模型 API 不稳定 | 解析功能不可用 | 高 | 增加重试机制、降级提示 | 🔲 待处理 |
| R2 | 模型输出格式不稳定 | JSON 解析失败 | 中 | 纠错重试、更严格的 Prompt | 🔲 待处理 |
| R3 | 大图片上传内存占用 | 服务器 OOM | 中 | 流式写入、大小限制 | 🔲 已规划 |

### 已知问题

| ID | 问题描述 | 发现日期 | 优先级 | 状态 |
|----|----------|----------|--------|------|
| - | 暂无 | - | - | - |

---

## 变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 2026-01-06 | v1.0 | 初始创建任务清单 | - |
| 2026-01-06 | v1.1 | 完成 M1-M6 全部后端和前端代码开发 | AI |
| 2026-01-06 | v1.2 | 项目成功运行验证，后端 8000 端口，前端 5173 端口 | AI |

---

## 备注

- 本文档随项目进度持续更新
- 任务状态变更时需同步更新进度统计
- 里程碑完成后更新对应状态
- 发现新风险/问题时及时记录

