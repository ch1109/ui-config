import{r as c,l as pe,i,c as r,a as t,b as k,m as Q,t as u,e as v,w as G,v as J,k as D,F as j,f as B,d as K,g as H,h as $,u as fe,o as d,n as L,j as I,p as N,M as W,E as X}from"./index-CjHtS17A.js";import{p as U,a as P}from"./index-PrkzALow.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"page-config-container"},ke={class:"top-header"},ge={class:"header-left"},_e={class:"header-title"},be={class:"sync-time"},we={class:"main-body"},ye={class:"project-sidebar"},Ce={class:"sidebar-search"},xe={class:"project-list"},Me=["onClick"],je={class:"project-info"},Be={class:"project-name"},$e={class:"project-id"},Le={class:"project-pages"},Pe=["onClick"],Ve=["onClick"],Te={key:0,class:"empty-projects"},Se={class:"page-main"},ze={class:"page-toolbar"},De={class:"filter-tabs"},He=["onClick"],Ie={class:"toolbar-right"},Ne={class:"search-wrapper"},Ue={class:"page-content"},Ee={key:0,class:"loading-state"},qe={key:1,class:"empty-state"},Fe={key:2,class:"page-grid"},Oe=["onClick"],Re={class:"card-thumbnail"},Ae=["src","alt"],Qe={key:1,class:"thumbnail-placeholder"},Ge={class:"card-content"},Je={class:"card-header"},Ke={class:"card-title"},We={class:"card-id"},Xe={class:"card-footer"},Ye={key:1,class:"update-time"},Ze={class:"card-actions"},et=["onClick"],tt=["onClick"],ot={class:"project-form"},lt={class:"form-group"},st={class:"form-group"},at={class:"form-group"},nt={class:"form-group"},it={class:"color-picker"},rt=["onClick"],dt={class:"form-actions"},ct={__name:"PageList",setup(ut){const V=fe(),Y=c(new Date().toLocaleString("zh-CN",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})),_=c([]),p=c([]),E=c(!0),y=c(""),f=c(null),h=c(null),C=c(""),x=c(""),w=c(!1),m=c(null),T=c(!1),s=c({name:"",project_id:"",description:"",color:"#3b82f6"}),Z=["#3b82f6","#6366f1","#8b5cf6","#ec4899","#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#64748b","#1e293b"],ee=[{label:"全部",value:""},{label:"已配置",value:"configured"},{label:"草稿",value:"draft"},{label:"错误",value:"error"}],q=K(()=>{if(!x.value)return p.value;const o=x.value.toLowerCase();return p.value.filter(e=>e.name.toLowerCase().includes(o)||e.project_id&&e.project_id.toLowerCase().includes(o))}),F=K(()=>{let o=_.value;if(f.value!==null&&(o=o.filter(e=>e.project_id===f.value)),y.value&&(o=o.filter(e=>e.status===y.value)),C.value){const e=C.value.toLowerCase();o=o.filter(a=>a.page_id.toLowerCase().includes(e)||a.name_zh.toLowerCase().includes(e))}return o});pe(async()=>{try{const[o,e]=await Promise.all([U.list(),P.list()]);_.value=o,p.value=e,e.length>0&&M(e[0])}catch(o){console.error("Failed to load data:",o),i.error("加载数据失败")}finally{E.value=!1}});const te=o=>{let e=_.value;return f.value!==null&&(e=e.filter(a=>a.project_id===f.value)),o?e.filter(a=>a.status===o).length:e.length},S=o=>{const e=p.value.find(a=>a.id===o);return(e==null?void 0:e.color)||"#3b82f6"},M=o=>{o?(f.value=o.id,h.value=o):(f.value=null,h.value=null)},O=(o=null)=>{if(m.value=o,o)s.value={name:o.name,project_id:o.project_id||`proj_${o.id}`,description:o.description||"",color:o.color||"#3b82f6"};else{const e=Date.now().toString(36);s.value={name:"",project_id:`proj_${e}`,description:"",color:"#3b82f6"}}w.value=!0},oe=async()=>{var o,e,a;if(!s.value.name.trim()){i.warning("请输入项目名称");return}if(!s.value.project_id.trim()){i.warning("请输入项目 ID");return}T.value=!0;try{if(m.value){const n=await P.update(m.value.id,{name:s.value.name,description:s.value.description,color:s.value.color}),b=p.value.findIndex(z=>z.id===m.value.id);b>-1&&(p.value[b]={...p.value[b],...n}),((o=h.value)==null?void 0:o.id)===m.value.id&&(h.value={...h.value,...n}),i.success("项目更新成功")}else{const n=await P.create({name:s.value.name,project_id:s.value.project_id,description:s.value.description,color:s.value.color});p.value.unshift(n),M(n),i.success("项目创建成功")}w.value=!1}catch(n){i.error(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.detail)||"操作失败")}finally{T.value=!1}},le=o=>{W.confirm({title:"删除项目",icon:k(X),content:`确定要删除项目「${o.name}」吗？项目下的页面不会被删除，但会取消关联。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await P.delete(o.id),p.value=p.value.filter(a=>a.id!==o.id),f.value===o.id&&(p.value.length>0?M(p.value[0]):(f.value=null,h.value=null));const e=await U.list();_.value=e,i.success("项目已删除")}catch{i.error("删除失败，请重试")}}})},se=o=>({configured:"success",draft:"warning",pending:"info",error:"error"})[o]||"default",ae=o=>({configured:"已配置",draft:"草稿",pending:"待确认",error:"错误"})[o]||o,ne=o=>{const e=new Date(o),n=new Date-e;return n<6e4?"刚刚":n<36e5?`${Math.floor(n/6e4)} 分钟前`:n<864e5?`${Math.floor(n/36e5)} 小时前`:e.toLocaleDateString("zh-CN")},R=()=>{f.value?V.push(`/page/new?project=${f.value}`):V.push("/page/new")},A=o=>{V.push(`/page/${o}`)},ie=o=>{W.confirm({title:"删除页面配置",icon:k(X),content:`确定要删除「${o.name_zh}」吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await U.delete(o.page_id),_.value=_.value.filter(e=>e.id!==o.id),i.success("删除成功")}catch{i.error("删除失败，请重试")}}})},re=()=>{i.info("查看代码功能开发中...")},de=()=>{i.info("导入功能开发中...")},ce=()=>{i.info("导出功能开发中...")},ue=()=>{i.info("拉取功能开发中...")},ve=()=>{i.info("推送功能开发中...")};return(o,e)=>{const a=$("a-input"),n=$("a-textarea"),b=$("a-button"),z=$("a-modal");return d(),r("div",me,[t("header",ke,[t("div",ge,[e[10]||(e[10]=Q('<div class="logo-icon" data-v-b3d394d0><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b3d394d0><path d="M16 18l2-2v-3m0-6V4l-2-2H8L6 4v3m0 6v3l2 2h8" data-v-b3d394d0></path><path d="M10 9h4" data-v-b3d394d0></path><path d="M10 13h2" data-v-b3d394d0></path></svg></div>',1)),t("div",_e,[e[9]||(e[9]=t("h1",null,"界面配置",-1)),t("span",be,"已同步 ("+u(Y.value)+")",1)])]),t("div",{class:"header-actions"},[t("button",{class:"action-btn code-btn",title:"查看代码",onClick:re},[...e[11]||(e[11]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M16 18l6-6-6-6M8 6l-6 6 6 6"})],-1)])]),t("button",{class:"action-btn",onClick:de},[...e[12]||(e[12]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),t("polyline",{points:"17 8 12 3 7 8"}),t("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1),v(" 导入 ",-1)])]),t("button",{class:"action-btn",onClick:ce},[...e[13]||(e[13]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),v(" 导出 ",-1)])]),t("button",{class:"action-btn",onClick:ue},[...e[14]||(e[14]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 3v12m0 0l-4-4m4 4l4-4"}),t("path",{d:"M3 15v4a2 2 0 002 2h14a2 2 0 002-2v-4"})],-1),v(" 拉取 ",-1)])]),t("button",{class:"action-btn primary-btn",onClick:ve},[...e[15]||(e[15]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 19V7m0 0l-4 4m4-4l4 4"}),t("path",{d:"M5 12H3a2 2 0 00-2 2v5a2 2 0 002 2h18a2 2 0 002-2v-5a2 2 0 00-2-2h-2"})],-1),v(" 推送 ",-1)])])])]),t("div",we,[t("aside",ye,[t("div",Ce,[e[16]||(e[16]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"search-icon"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"M21 21l-4.35-4.35"})],-1)),G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),type:"text",placeholder:"搜索项目...",class:"search-input"},null,512),[[J,x.value]])]),t("button",{class:"add-project-btn",onClick:e[1]||(e[1]=l=>O())},[...e[17]||(e[17]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 4v16m-8-8h16"})],-1),v(" 添加新项目 ",-1)])]),t("div",xe,[(d(!0),r(j,null,B(q.value,l=>(d(),r("div",{key:l.id,class:L(["project-item",{active:f.value===l.id}]),onClick:g=>M(l)},[t("div",je,[t("h4",Be,u(l.name),1),t("p",$e,"ID: "+u(l.project_id),1),t("p",Le,u(l.page_count||0)+" 页面",1)]),t("div",{class:"project-actions",onClick:e[2]||(e[2]=I(()=>{},["stop"]))},[t("button",{class:"project-action-btn",onClick:g=>O(l),title:"编辑"},[...e[18]||(e[18]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Pe),t("button",{class:"project-action-btn delete",onClick:g=>le(l),title:"删除"},[...e[19]||(e[19]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,Ve)])],10,Me))),128)),q.value.length===0?(d(),r("div",Te,[...e[20]||(e[20]=[t("p",null,"暂无项目",-1)])])):D("",!0)])]),t("main",Se,[t("div",ze,[t("div",De,[(d(),r(j,null,B(ee,l=>t("button",{key:l.value,class:L(["filter-tab",{active:y.value===l.value}]),onClick:g=>y.value=l.value},u(l.label)+" "+u(te(l.value)),11,He)),64))]),t("div",Ie,[t("div",Ne,[e[21]||(e[21]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"search-icon"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"M21 21l-4.35-4.35"})],-1)),G(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),type:"text",placeholder:"搜索页面...",class:"search-input"},null,512),[[J,C.value]])]),t("button",{class:"add-page-btn",onClick:R},[...e[22]||(e[22]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 4v16m-8-8h16"})],-1),v(" 添加新页面 ",-1)])])])]),t("div",Ue,[E.value?(d(),r("div",Ee,[...e[23]||(e[23]=[t("div",{class:"loading-spinner"},[t("div",{class:"spinner"})],-1),t("p",null,"加载中...",-1)])])):F.value.length===0?(d(),r("div",qe,[e[25]||(e[25]=Q('<div class="empty-illustration" data-v-b3d394d0><svg viewBox="0 0 200 200" fill="none" data-v-b3d394d0><circle cx="100" cy="100" r="80" fill="#f1f5f9" data-v-b3d394d0></circle><rect x="60" y="50" width="80" height="100" rx="8" fill="#e2e8f0" data-v-b3d394d0></rect><rect x="70" y="65" width="40" height="6" rx="3" fill="#cbd5e1" data-v-b3d394d0></rect><rect x="70" y="80" width="60" height="6" rx="3" fill="#cbd5e1" data-v-b3d394d0></rect><rect x="70" y="95" width="50" height="6" rx="3" fill="#cbd5e1" data-v-b3d394d0></rect><circle cx="100" cy="130" r="15" fill="#3b82f6" opacity="0.2" data-v-b3d394d0></circle><path d="M95 130h10M100 125v10" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" data-v-b3d394d0></path></svg></div><h3 data-v-b3d394d0>暂无页面配置</h3>',2)),t("p",null,u(h.value?`项目「${h.value.name}」下还没有页面`:"创建您的第一个页面配置，开始使用 AI 辅助解析功能"),1),t("button",{class:"create-btn",onClick:R},[...e[24]||(e[24]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[t("path",{d:"M12 4v16m-8-8h16"})],-1),v(" 开始创建 ",-1)])])])):(d(),r("div",Fe,[(d(!0),r(j,null,B(F.value,l=>(d(),r("article",{key:l.id,class:"page-card",onClick:g=>A(l.page_id)},[t("div",Re,[l.screenshot_url?(d(),r("img",{key:0,src:l.screenshot_url,alt:l.name_zh,loading:"lazy"},null,8,Ae)):(d(),r("div",Qe,[...e[26]||(e[26]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})],-1)])]))]),t("div",Ge,[t("div",Je,[t("h3",Ke,u(l.name_zh),1),t("span",{class:L(["status-badge",se(l.status)])},u(ae(l.status)),3)]),t("p",We,u(l.page_id),1),t("div",Xe,[l.project_name?(d(),r("span",{key:0,class:"project-tag",style:N({background:S(l.project_id)+"20",color:S(l.project_id)})},[t("span",{class:"tag-dot",style:N({background:S(l.project_id)})},null,4),v(" "+u(l.project_name),1)],4)):D("",!0),l.updated_at?(d(),r("span",Ye,[e[27]||(e[27]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M12 6v6l4 2"})],-1)),v(" "+u(ne(l.updated_at)),1)])):D("",!0)])]),t("div",Ze,[t("button",{class:"card-action-btn edit",onClick:I(g=>A(l.page_id),["stop"]),title:"编辑"},[...e[28]||(e[28]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,et),t("button",{class:"card-action-btn delete",onClick:I(g=>ie(l),["stop"]),title:"删除"},[...e[29]||(e[29]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,tt)])],8,Oe))),128))]))])])]),k(z,{open:w.value,"onUpdate:open":e[8]||(e[8]=l=>w.value=l),title:m.value?"编辑项目":"新建项目",width:480,footer:null,destroyOnClose:!0,class:"project-modal"},{default:H(()=>[t("div",ot,[t("div",lt,[e[30]||(e[30]=t("label",null,[v("项目名称 "),t("span",{class:"required"},"*")],-1)),k(a,{value:s.value.name,"onUpdate:value":e[4]||(e[4]=l=>s.value.name=l),placeholder:"请输入项目名称",maxlength:100},null,8,["value"])]),t("div",st,[e[31]||(e[31]=t("label",null,[v("项目 ID "),t("span",{class:"required"},"*")],-1)),k(a,{value:s.value.project_id,"onUpdate:value":e[5]||(e[5]=l=>s.value.project_id=l),placeholder:"例如：proj_default",maxlength:50,disabled:!!m.value},null,8,["value","disabled"]),e[32]||(e[32]=t("p",{class:"form-hint"},"项目唯一标识，创建后不可修改",-1))]),t("div",at,[e[33]||(e[33]=t("label",null,"项目描述",-1)),k(n,{value:s.value.description,"onUpdate:value":e[6]||(e[6]=l=>s.value.description=l),placeholder:"请输入项目描述（可选）",rows:3,maxlength:500},null,8,["value"])]),t("div",nt,[e[34]||(e[34]=t("label",null,"项目颜色",-1)),t("div",it,[(d(),r(j,null,B(Z,l=>t("button",{key:l,class:L(["color-option",{active:s.value.color===l}]),style:N({background:l}),onClick:g=>s.value.color=l},null,14,rt)),64))])]),t("div",dt,[k(b,{onClick:e[7]||(e[7]=l=>w.value=!1)},{default:H(()=>[...e[35]||(e[35]=[v("取消",-1)])]),_:1}),k(b,{type:"primary",loading:T.value,onClick:oe},{default:H(()=>[v(u(m.value?"保存":"创建"),1)]),_:1},8,["loading"])])])]),_:1},8,["open","title"])])}}},ht=he(ct,[["__scopeId","data-v-b3d394d0"]]);export{ht as default};
