import{q as Ae,r as g,c as le,o as re,s as Ie,b as r,j as d,d as e,e as H,F as Z,p as ie,k as _,t as S,f as ne,m as ee,w as G,n as De,g as de,x as Ve,y as oe,i as W,v as K,l as $,h as ae,z as Ne,A as Ee,a as U,u as ze,B as Be,C as Ue,D as pe,M as he,E as Se}from"./index-VWhHohYx.js";import{_ as ue,p as se,c as Le}from"./_plugin-vue_export-helper-CLyVweMD.js";function be(c,N){if(!N)return c;let o=c||"";const{behavior_rules:p,page_goal:v}=N;return p&&!o.includes("## è¡Œä¸ºè§„åˆ™")&&(o+=`

## è¡Œä¸ºè§„åˆ™
${p}`),v&&!o.includes("## é¡µé¢ç›®æ ‡")&&(o+=`

## é¡µé¢ç›®æ ‡
${v}`),o.trim()}function _e(c,N){if(!N)return c;let o=c||"";const{behavior_rules:p,page_goal:v}=N;return p&&!o.includes("## Behavior Rules")&&(o+=`

## Behavior Rules
${p}`),v&&!o.includes("## Page Goal")&&(o+=`

## Page Goal
${v}`),o.trim()}const je=Ae("uiConfig",()=>{const c=g({page_id:"",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},button_list:[],optional_actions:[]}),N=g(null),o=g(!1),p=g(null),v=g(null),n=le(()=>o.value);function E(i){Object.assign(c.value,i),o.value=!0}function m(i){return o.value?{conflict:!0}:(A(i),{conflict:!1})}function M(i){A(i),o.value=!1}function A(i){if(i.page_id&&(c.value.page_id=i.page_id),i.page_name&&(c.value.name={"zh-CN":i.page_name["zh-CN"]||"",en:i.page_name.en||""}),i.page_description){let C=i.page_description["zh-CN"]||"",I=i.page_description.en||"";i.ai_context&&(C=be(C,i.ai_context),I=_e(I,i.ai_context)),c.value.description={"zh-CN":C,en:I}}i.button_list&&(c.value.button_list=i.button_list),i.optional_actions&&(c.value.optional_actions=i.optional_actions)}function L(){}function j(){c.value={page_id:"",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},button_list:[],optional_actions:[]},N.value=null,o.value=!1,p.value=null}function z(i){const C={...i};i.ai_context&&i.description&&(C.description={"zh-CN":be(i.description["zh-CN"]||"",i.ai_context),en:_e(i.description.en||"",i.ai_context)}),delete C.ai_context,N.value=JSON.parse(JSON.stringify(C)),c.value=JSON.parse(JSON.stringify(C)),o.value=!1}function a(i){p.value=i}function k(i,C="success",I=3e3){v.value={message:i,type:C},setTimeout(()=>{v.value=null},I)}return{draftConfig:c,originalConfig:N,isDirty:o,currentSession:p,toast:v,hasChanges:n,applyUserEdit:E,tryApplyAiUpdate:m,forceApplyAiUpdate:M,keepUserEdit:L,resetConfig:j,setOriginalConfig:z,setCurrentSession:a,showToast:k}}),Oe=["src"],Pe={class:"overlay"},Re={class:"btn-action"},Te=["disabled"],He={key:1,class:"upload-progress"},Je={class:"progress-ring"},qe={viewBox:"0 0 100 100"},Fe=["stroke-dasharray"],Ge={class:"percent"},We={key:2,class:"upload-placeholder-wrapper"},Ke={class:"upload-placeholder"},Ze=["disabled"],Qe=["src"],Xe={__name:"ImageUploader",props:{modelValue:String,disabled:Boolean},emits:["update:modelValue","upload-success","upload-error"],setup(c,{emit:N}){const o=c,p=N,v=g(!1),n=g(!1),E=g(0),m=g(!1),M=g({width:0,height:0}),A=le(()=>M.value.width||520),L=()=>{o.disabled||(v.value=!0)},j=()=>{v.value=!1},z=b=>{if(v.value=!1,o.disabled||n.value)return;const u=b.dataTransfer.files;u.length>0&&k(u[0])},a=async b=>{const u=b.target,x=u.files;try{x&&x.length>0&&await k(x[0])}finally{u.value=""}},k=async b=>{var O,J,P;if(!b)return;if(!["image/png","image/jpeg","image/jpg"].includes(b.type)){p("upload-error",{code:"INVALID_FILE_TYPE",message:"ä»…æ”¯æŒ PNGã€JPG æ ¼å¼çš„å›¾ç‰‡"});return}const x=10*1024*1024;if(b.size>x){p("upload-error",{code:"FILE_TOO_LARGE",message:"å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MB"});return}n.value=!0,E.value=0;try{const D=await se.uploadImage(b,B=>{E.value=B});p("update:modelValue",D.file_url),p("upload-success",D)}catch(D){console.error("Upload error:",D);let B="ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",Q="UPLOAD_FAILED";D.code==="UPLOAD_FAILED"||D.name==="NotReadableError"?(B=D.message,Q="FILE_READ_ERROR"):(O=D.message)!=null&&O.includes("Network Error")||D.code==="ERR_NETWORK"?(B="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ",Q="NETWORK_ERROR"):(P=(J=D.response)==null?void 0:J.data)!=null&&P.message?(B=D.response.data.message,Q=D.response.data.error||"SERVER_ERROR"):D.message&&(B=D.message),p("upload-error",{code:Q,message:B})}finally{n.value=!1}},i=()=>{p("update:modelValue",null)},C=()=>{if(o.disabled||n.value||!o.modelValue)return;const b=new Image;b.onload=()=>{const u=b.naturalWidth||b.width,x=b.naturalHeight||b.height,O=Math.floor(window.innerWidth*.9),J=Math.floor(window.innerHeight*.9),P=Math.min(1,O/u,J/x);M.value={width:Math.max(1,Math.floor(u*P)),height:Math.max(1,Math.floor(x*P))},m.value=!0},b.onerror=()=>{M.value={width:520,height:390},m.value=!0},b.src=o.modelValue},I=async b=>{var O;const u=document.activeElement;if(u&&(u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable)||o.disabled||n.value)return;const x=(O=b.clipboardData)==null?void 0:O.items;if(!(!x||x.length===0))for(let J=0;J<x.length;J++){const P=x[J];if(P.type.startsWith("image/")){b.preventDefault();const D=P.getAsFile();if(D){await k(D);return}}}};return re(()=>{document.addEventListener("paste",I)}),Ie(()=>{document.removeEventListener("paste",I)}),(b,u)=>{const x=de("a-modal");return d(),r(Z,null,[e("div",{class:ee(["image-uploader",{"is-dragover":v.value,"has-image":c.modelValue,"is-disabled":c.disabled||n.value}]),onDragover:ie(L,["prevent"]),onDragleave:j,onDrop:ie(z,["prevent"])},[c.modelValue?(d(),r(Z,{key:0},[e("img",{src:c.modelValue,alt:"é¡µé¢æˆªå›¾",class:"preview-image",onClick:C},null,8,Oe),e("div",Pe,[e("button",{class:"btn-action",type:"button",onClick:ie(C,["stop"])},[...u[1]||(u[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M2 12s3.5-6 10-6 10 6 10 6-3.5 6-10 6-10-6-10-6z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),_(" æŸ¥çœ‹å¤§å›¾ ",-1)])]),e("label",Re,[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",disabled:c.disabled||n.value,onChange:a,class:"hidden-input"},null,40,Te),u[2]||(u[2]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})],-1)),u[3]||(u[3]=_(" æ›´æ¢ ",-1))]),e("button",{class:"btn-action danger",type:"button",onClick:ie(i,["stop"])},[...u[4]||(u[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1),_(" ç§»é™¤ ",-1)])])])],64)):n.value?(d(),r("div",He,[e("div",Je,[(d(),r("svg",qe,[u[5]||(u[5]=e("circle",{class:"bg",cx:"50",cy:"50",r:"45"},null,-1)),e("circle",{class:"progress",cx:"50",cy:"50",r:"45","stroke-dasharray":`${E.value*283} 283`},null,8,Fe)])),e("span",Ge,S(Math.round(E.value*100))+"%",1)]),u[6]||(u[6]=e("p",null,"ä¸Šä¼ ä¸­...",-1))])):(d(),r("div",We,[e("label",Ke,[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",disabled:c.disabled||n.value,onChange:a,class:"hidden-input"},null,40,Ze),u[7]||(u[7]=ne('<div class="upload-icon" data-v-524d4854><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-524d4854><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-524d4854></path></svg></div><p class="upload-text" data-v-524d4854>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p><p class="upload-hint" data-v-524d4854>æˆ–ç‚¹å‡»ä¸Šä¼ </p><p class="upload-formats" data-v-524d4854>æ”¯æŒ PNG, JPG (æœ€å¤§ 10MB)</p>',4))]),u[8]||(u[8]=e("div",{class:"paste-hint"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),e("span",null,[_("ä¹Ÿå¯æŒ‰ "),e("kbd",null,"Ctrl"),_("+"),e("kbd",null,"V"),_(" ç²˜è´´å›¾ç‰‡")])],-1))]))],34),H(x,{open:m.value,"onUpdate:open":u[0]||(u[0]=O=>m.value=O),title:null,footer:null,maskClosable:!0,width:A.value,centered:"",bodyStyle:{padding:"0"}},{default:G(()=>[e("img",{src:c.modelValue,alt:"é¡µé¢æˆªå›¾",class:"preview-modal-image",style:De({width:M.value.width?M.value.width+"px":"auto",height:M.value.height?M.value.height+"px":"auto"})},null,12,Qe)]),_:1},8,["open","width"])],64)}}},Ye=ue(Xe,[["__scopeId","data-v-524d4854"]]),et={class:"config-editor"},tt={class:"section"},st={class:"form-grid"},at={class:"form-field full-width"},nt={class:"form-field"},ot={key:0,class:"field-hint error"},lt={class:"form-field"},it={key:0,class:"field-hint error"},rt={class:"form-field full-width"},dt={class:"field-help"},ut={key:0,class:"help-content"},ct={class:"form-field full-width"},vt={class:"section"},pt={class:"form-field"},ft={class:"list-editor"},gt=["onUpdate:modelValue"],mt=["onClick"],ht={key:0,class:"field-hint error"},bt={class:"form-field"},_t={class:"list-editor"},yt=["onUpdate:modelValue"],wt=["onClick"],kt=`æè¿°æ­¤é¡µé¢çš„åŠŸèƒ½å’Œç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œ...

ç¤ºä¾‹æ ¼å¼ï¼š
ç”¨æˆ·ä¸­å¿ƒæ˜¯ç®¡ç†ä¸ªäººä¿¡æ¯çš„æ ¸å¿ƒé¡µé¢ã€‚

ç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œï¼š
- ä¿®æ”¹å¤´åƒå’Œæ˜µç§°
- æ›´æ–°è”ç³»æ–¹å¼
- ä¿®æ”¹å¯†ç 

## è¡Œä¸ºè§„åˆ™
- å¼•å¯¼ç”¨æˆ·å®Œå–„å¿…å¡«ä¿¡æ¯
- æ•æ„Ÿæ“ä½œéœ€äºŒæ¬¡ç¡®è®¤

## é¡µé¢ç›®æ ‡
å¸®åŠ©ç”¨æˆ·ç»´æŠ¤ä¸ªäººä¿¡æ¯ï¼Œç¡®ä¿è´¦æˆ·å®‰å…¨`,Ct={__name:"ConfigEditor",props:{config:{type:Object,required:!0},sessionId:String,errors:{type:Object,default:()=>({})}},emits:["config-changed"],setup(c,{emit:N}){const o=c,p=N,v=g(!1),n=Ve({page_id:"",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},button_list:[""],optional_actions:[]});re(()=>{E()}),oe(()=>o.config,()=>{E()},{deep:!0});const E=()=>{var z,a,k,i,C;if(o.config){n.page_id=o.config.page_id||"",n.name={"zh-CN":((z=o.config.name)==null?void 0:z["zh-CN"])||"",en:((a=o.config.name)==null?void 0:a.en)||""};let I=((k=o.config.description)==null?void 0:k["zh-CN"])||"",b=((i=o.config.description)==null?void 0:i.en)||"";if(o.config.ai_context){const{behavior_rules:u,page_goal:x}=o.config.ai_context;u&&!I.includes("## è¡Œä¸ºè§„åˆ™")&&(I+=`

## è¡Œä¸ºè§„åˆ™
${u}`),x&&!I.includes("## é¡µé¢ç›®æ ‡")&&(I+=`

## é¡µé¢ç›®æ ‡
${x}`),u&&!b.includes("## Behavior Rules")&&(b+=`

## Behavior Rules
${u}`),x&&!b.includes("## Page Goal")&&(b+=`

## Page Goal
${x}`)}n.description={"zh-CN":I.trim(),en:b.trim()},n.button_list=(C=o.config.button_list)!=null&&C.length?[...o.config.button_list]:[""],n.optional_actions=o.config.optional_actions?[...o.config.optional_actions]:[]}},m=()=>{p("config-changed",{page_id:n.page_id,name:{...n.name},description:{...n.description},button_list:[...n.button_list],optional_actions:[...n.optional_actions]})},M=()=>{n.button_list.push(""),m()},A=z=>{n.button_list.length<=1||(n.button_list.splice(z,1),m())},L=()=>{n.optional_actions.push(""),m()},j=z=>{n.optional_actions.splice(z,1),m()};return(z,a)=>(d(),r("div",et,[e("section",tt,[a[13]||(a[13]=e("div",{class:"section-header"},[e("div",{class:"section-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("h3",null,"åŸºæœ¬ä¿¡æ¯")],-1)),e("div",st,[e("div",at,[a[6]||(a[6]=e("label",null,[_(" é¡µé¢ ID (è‹±æ–‡æ ‡è¯†) "),e("span",{class:"required"},"*")],-1)),W(e("input",{"onUpdate:modelValue":a[0]||(a[0]=k=>n.page_id=k),type:"text",class:ee(["form-input",{error:c.errors.page_id}]),placeholder:"ä¾‹å¦‚: 1.0home_page, 4.1face_authorization_page",onInput:m},null,34),[[K,n.page_id]]),e("span",{class:ee(["field-hint",{error:c.errors.page_id}])},S(c.errors.page_id||"æ ¼å¼: {é¡µé¢ç¼–å·}{è‹±æ–‡åç§°}ï¼Œå¦‚ 4.1face_authorization_pageï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”"),3)]),e("div",nt,[a[7]||(a[7]=e("label",null,[_(" é¡µé¢åç§° (ä¸­æ–‡) "),e("span",{class:"required"},"*")],-1)),W(e("input",{"onUpdate:modelValue":a[1]||(a[1]=k=>n.name["zh-CN"]=k),type:"text",class:ee(["form-input",{error:c.errors.name_zh}]),placeholder:"ä¾‹å¦‚: é¦–é¡µã€ç”¨æˆ·ä¸­å¿ƒ",onInput:m},null,34),[[K,n.name["zh-CN"]]]),c.errors.name_zh?(d(),r("span",ot,S(c.errors.name_zh),1)):$("",!0)]),e("div",lt,[a[8]||(a[8]=e("label",null,[_(" Page Name (EN) "),e("span",{class:"required"},"*")],-1)),W(e("input",{"onUpdate:modelValue":a[2]||(a[2]=k=>n.name.en=k),type:"text",class:ee(["form-input",{error:c.errors.name_en}]),placeholder:"e.g. Home Page, User Profile",onInput:m},null,34),[[K,n.name.en]]),c.errors.name_en?(d(),r("span",it,S(c.errors.name_en),1)):$("",!0)]),e("div",rt,[a[11]||(a[11]=e("label",null,[_(" é¡µé¢æè¿° (ä¸­æ–‡) "),e("span",{class:"label-hint"},"åŒ…å«åŠŸèƒ½è¯´æ˜ã€è¡Œä¸ºè§„åˆ™å’Œé¡µé¢ç›®æ ‡")],-1)),W(e("textarea",{"onUpdate:modelValue":a[3]||(a[3]=k=>n.description["zh-CN"]=k),class:"form-textarea description-textarea",rows:"8",placeholder:kt,onInput:m},null,544),[[K,n.description["zh-CN"]]]),e("div",dt,[e("button",{type:"button",class:"help-toggle",onClick:a[4]||(a[4]=k=>v.value=!v.value)},[a[9]||(a[9]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)),_(" "+S(v.value?"æ”¶èµ·æ ¼å¼è¯´æ˜":"æŸ¥çœ‹æ ¼å¼è¯´æ˜"),1)]),v.value?(d(),r("div",ut,[...a[10]||(a[10]=[e("p",null,[e("strong",null,"æ¨èæ ¼å¼ï¼š")],-1),e("pre",null,`é¡µé¢åŠŸèƒ½æ¦‚è¿°...

ç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œï¼š
- æ“ä½œ1
- æ“ä½œ2

## è¡Œä¸ºè§„åˆ™
AI åœ¨æ­¤é¡µé¢åº”éµå¾ªçš„çº¦æŸ...

## é¡µé¢ç›®æ ‡
ç”¨æˆ·åœ¨æ­¤é¡µé¢çš„ä¸»è¦ç›®æ ‡...`,-1)])])):$("",!0)])]),e("div",ct,[a[12]||(a[12]=e("label",null,[_(" Page Description (EN) "),e("span",{class:"label-hint"},"Optional")],-1)),W(e("textarea",{"onUpdate:modelValue":a[5]||(a[5]=k=>n.description.en=k),class:"form-textarea",rows:"4",placeholder:"Describe the page features and available user actions...",onInput:m},null,544),[[K,n.description.en]])])])]),e("section",vt,[a[20]||(a[20]=ne('<div class="section-header" data-v-57d8bbe6><div class="section-icon accent" data-v-57d8bbe6><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-57d8bbe6><rect x="3" y="3" width="7" height="7" data-v-57d8bbe6></rect><rect x="14" y="3" width="7" height="7" data-v-57d8bbe6></rect><rect x="14" y="14" width="7" height="7" data-v-57d8bbe6></rect><rect x="3" y="14" width="7" height="7" data-v-57d8bbe6></rect></svg></div><h3 data-v-57d8bbe6>é¡µé¢èƒ½åŠ›</h3></div>',1)),e("div",pt,[a[16]||(a[16]=e("label",null," å¯ç‚¹å‡»æŒ‰é’® ",-1)),e("div",ft,[(d(!0),r(Z,null,ae(n.button_list,(k,i)=>(d(),r("div",{key:i,class:"list-item"},[W(e("input",{"onUpdate:modelValue":C=>n.button_list[i]=C,type:"text",class:"form-input",placeholder:"æŒ‰é’® ID (snake_case)",onInput:m},null,40,gt),[[K,n.button_list[i]]]),n.button_list.length>1?(d(),r("button",{key:0,class:"remove-btn",onClick:C=>A(i),type:"button"},[...a[14]||(a[14]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M15 9l-6 6M9 9l6 6"})],-1)])],8,mt)):$("",!0)]))),128)),e("button",{class:"add-btn",onClick:M,type:"button"},[...a[15]||(a[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v8M8 12h8"})],-1),_(" æ·»åŠ æŒ‰é’® ",-1)])])]),c.errors.button_list?(d(),r("span",ht,S(c.errors.button_list),1)):$("",!0)]),e("div",bt,[a[19]||(a[19]=e("label",null,"å¯é€‰æ“ä½œ",-1)),e("div",_t,[(d(!0),r(Z,null,ae(n.optional_actions,(k,i)=>(d(),r("div",{key:i,class:"list-item"},[W(e("input",{"onUpdate:modelValue":C=>n.optional_actions[i]=C,type:"text",class:"form-input",placeholder:"æ“ä½œ ID",onInput:m},null,40,yt),[[K,n.optional_actions[i]]]),e("button",{class:"remove-btn",onClick:C=>j(i),type:"button"},[...a[17]||(a[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M15 9l-6 6M9 9l6 6"})],-1)])],8,wt)]))),128)),e("button",{class:"add-btn",onClick:L,type:"button"},[...a[18]||(a[18]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v8M8 12h8"})],-1),_(" æ·»åŠ æ“ä½œ ",-1)])])])])])]))}},xt=ue(Ct,[["__scopeId","data-v-57d8bbe6"]]),$t={class:"clarify-panel"},Mt={class:"panel-header"},At={key:0,class:"message assistant"},It={class:"bubble-wrapper"},Dt={key:0,class:"avatar small"},Vt={class:"bubble"},Nt=["src","onClick"],Et=["innerHTML"],zt={key:1,class:"streaming-cursor"},Bt={class:"timestamp"},Ut={key:1,class:"message assistant"},St={class:"bubble-wrapper"},Lt={class:"bubble"},jt={class:"streaming-output"},Ot={key:1,class:"parsing-message"},Pt={key:2,class:"message assistant"},Rt={key:3,class:"message assistant"},Tt={class:"bubble-wrapper"},Ht={class:"bubble config-preview"},Jt={class:"config-summary"},qt={key:0,class:"config-item"},Ft={class:"page-id-value"},Gt={key:1,class:"config-item"},Wt={key:2,class:"config-item"},Kt={class:"tag-list"},Zt={key:3,class:"config-item"},Qt={class:"tag-list"},Xt={key:4,class:"message assistant"},Yt={class:"bubble-wrapper"},es={class:"bubble"},ts={key:0,class:"quick-options"},ss=["onClick"],as={key:0,class:"pending-image"},ns=["src"],os={class:"input-area"},ls={class:"input-wrapper"},is=["disabled"],rs=["disabled"],ds=["disabled"],us={__name:"ClarifyPanel",props:{sessionId:String,parseResult:Object,status:String,currentConfig:Object,imageUrl:String,streamingContent:String},emits:["config-updated","config-confirmed","completed"],setup(c,{emit:N}){const o=c,p=N,v=g([]),n=g(null),E=g(""),m=g(!1),M=g(null),A=g(null),L=g(null),j=g(null),z=g(!1),a=g(null),k=g(!1),i=le(()=>({pending:"ç­‰å¾…ä¸­",parsing:"åˆ†æä¸­...",clarifying:"å¯¹è¯ä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"})[o.status]||"");oe(()=>o.parseResult,h=>{var l;h&&o.status==="completed"&&!k.value&&(a.value=h,z.value=!0,B()),((l=h==null?void 0:h.clarification_questions)==null?void 0:l.length)>0?n.value=h.clarification_questions[0]:n.value=null},{immediate:!0}),oe(()=>o.status,(h,l)=>{var R;h==="parsing"&&l!=="parsing"&&(v.value.push({role:"assistant",content:"æ­£åœ¨åˆ†æé¡µé¢æˆªå›¾ï¼Œè¯·ç¨å€™...",timestamp:new Date}),k.value=!1,z.value=!1,B()),h==="clarifying"&&o.parseResult&&(v.value.push({role:"assistant",content:"æˆ‘å·²å®Œæˆåˆæ­¥åˆ†æï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è¦ç¡®è®¤ï¼š",timestamp:new Date}),((R=o.parseResult.clarification_questions)==null?void 0:R.length)>0&&(n.value=o.parseResult.clarification_questions[0]),B())}),oe(()=>o.streamingContent,()=>{o.streamingContent&&B()});const C=()=>{a.value&&(p("config-confirmed",a.value),k.value=!0,z.value=!1,v.value.push({role:"user",content:"ç¡®è®¤åº”ç”¨æ­¤é…ç½®",timestamp:new Date}),B())},I=()=>{z.value=!1,v.value.push({role:"user",content:"éœ€è¦é‡æ–°è¯†åˆ«",timestamp:new Date}),v.value.push({role:"assistant",content:"å¥½çš„ï¼Œè¯·é‡æ–°ä¸Šä¼ å›¾ç‰‡æˆ–æè¿°æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¼šé‡æ–°åˆ†æã€‚",timestamp:new Date}),B()},b=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),P())},u=h=>{A.value=h;const l=new FileReader;return l.onload=R=>{L.value=R.target.result},l.readAsDataURL(h),!1},x=h=>{var R;const l=(R=h.target.files)==null?void 0:R[0];if(l){if(!["image/png","image/jpeg","image/jpg"].includes(l.type))return;u(l)}h.target.value=""},O=()=>{A.value=null,L.value=null},J=h=>{j.value=h},P=async()=>{var R,X;if(!E.value.trim()&&!A.value||m.value)return;const h=E.value.trim(),l=L.value;E.value="",O(),v.value.push({role:"user",content:h||"(ä¸Šä¼ äº†å›¾ç‰‡)",image:l,timestamp:new Date}),B(),m.value=!0;try{if(o.sessionId&&(o.status==="clarifying"||o.status==="completed")){let q="";const w=v.value.length;v.value.push({role:"assistant",content:"",timestamp:new Date,isStreaming:!0});const te=Le.chatStream(o.sessionId,h,o.currentConfig,F=>{F.type==="content"&&(q+=F.content,v.value[w].content=q,B())},F=>{v.value[w].isStreaming=!1,v.value[w].content=q||"å¥½çš„ï¼Œæˆ‘å·²æ ¹æ®æ‚¨çš„å»ºè®®æ›´æ–°äº†é…ç½®ã€‚",F&&(a.value=F,z.value=!0,k.value=!1),m.value=!1,B()},F=>{v.value[w].isStreaming=!1,v.value[w].content=`âŒ ${F||"è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•"}`,m.value=!1,B()});window._currentChatStream=te}else v.value.push({role:"assistant",content:'è¯·å…ˆä¸Šä¼ é¡µé¢æˆªå›¾å¹¶ç‚¹å‡»"AI è¾…åŠ©å¡«å†™"ï¼Œæˆ‘ä¼šå¸®æ‚¨è¯†åˆ«é¡µé¢å…ƒç´ ã€‚',timestamp:new Date}),m.value=!1}catch(q){v.value.push({role:"assistant",content:`âŒ ${((X=(R=q.response)==null?void 0:R.data)==null?void 0:X.message)||"è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•"}`,timestamp:new Date}),m.value=!1}finally{B()}},D=h=>{E.value=h,P()},B=()=>{Ne(()=>{M.value&&(M.value.scrollTop=M.value.scrollHeight)})},Q=h=>h?h.replace(/\n/g,"<br>"):"",ce=h=>new Date(h).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(h,l)=>{var X,q;const R=de("a-image");return d(),r("div",$t,[e("div",Mt,[l[2]||(l[2]=ne('<div class="assistant-info" data-v-0826f096><div class="avatar" data-v-0826f096><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-0826f096><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z" data-v-0826f096></path></svg></div><span class="name" data-v-0826f096>UI config å¡«å†™åŠ©æ‰‹</span></div>',1)),c.status?(d(),r("span",{key:0,class:ee(["status-badge",c.status])},[l[1]||(l[1]=e("span",{class:"status-dot"},null,-1)),_(" "+S(i.value),1)],2)):$("",!0)]),e("div",{class:"chat-container",ref_key:"chatContainer",ref:M},[v.value.length===0&&!c.status?(d(),r("div",At,[...l[3]||(l[3]=[ne('<div class="bubble" data-v-0826f096><div class="welcome-content" data-v-0826f096><div class="welcome-icon" data-v-0826f096>ğŸ‘‹</div><div class="welcome-text" data-v-0826f096><p data-v-0826f096>ä½ å¥½ï¼ä¸Šä¼ é¡µé¢æˆªå›¾å¹¶ç‚¹å‡»&quot;AI è¾…åŠ©å¡«å†™&quot;ï¼Œæˆ‘å°†å¸®åŠ©æ‚¨è‡ªåŠ¨è¯†åˆ«é¡µé¢å…ƒç´ ã€‚</p><p class="sub" data-v-0826f096>æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¸‹æ–¹è¾“å…¥æ¡†æè¿°æ‚¨æƒ³è¦é…ç½®çš„é¡µé¢åŠŸèƒ½ã€‚</p></div></div></div>',1)])])):$("",!0),(d(!0),r(Z,null,ae(v.value,(w,te)=>(d(),r("div",{key:te,class:ee(["message",w.role])},[e("div",It,[w.role==="assistant"?(d(),r("div",Dt,[...l[4]||(l[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})],-1)])])):$("",!0),e("div",Vt,[w.image?(d(),r("img",{key:0,src:w.image,class:"chat-image",onClick:F=>J(w.image)},null,8,Nt)):$("",!0),e("span",{innerHTML:Q(w.content)},null,8,Et),w.isStreaming?(d(),r("span",zt,"â–Š")):$("",!0)])]),e("span",Bt,S(ce(w.timestamp)),1)],2))),128)),c.status==="parsing"?(d(),r("div",Ut,[e("div",St,[l[7]||(l[7]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Lt,[c.streamingContent?(d(),r(Z,{key:0},[e("pre",jt,S(c.streamingContent),1),l[5]||(l[5]=e("span",{class:"streaming-cursor"},"â–Š",-1))],64)):(d(),r("div",Ot,[...l[6]||(l[6]=[e("span",{class:"parsing-icon"},"ğŸ”",-1),_(" æ­£åœ¨åˆ†æé¡µé¢æˆªå›¾ï¼Œè¯†åˆ«å¯äº¤äº’å…ƒç´ ... ",-1)])]))])])])):$("",!0),m.value?(d(),r("div",Pt,[...l[8]||(l[8]=[ne('<div class="bubble-wrapper" data-v-0826f096><div class="avatar small" data-v-0826f096><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-0826f096><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z" data-v-0826f096></path></svg></div><div class="bubble loading" data-v-0826f096><span class="dot" data-v-0826f096></span><span class="dot" data-v-0826f096></span><span class="dot" data-v-0826f096></span></div></div>',1)])])):$("",!0),z.value&&a.value?(d(),r("div",Rt,[e("div",Tt,[l[15]||(l[15]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Ht,[l[14]||(l[14]=e("div",{class:"preview-header"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 6L9 17l-5-5"})]),_(" è§£æå®Œæˆï¼ä»¥ä¸‹æ˜¯è¯†åˆ«åˆ°çš„é…ç½®ä¿¡æ¯ï¼š ")],-1)),e("div",Jt,[a.value.page_id?(d(),r("div",qt,[l[9]||(l[9]=e("label",null,"é¡µé¢ IDï¼š",-1)),e("span",Ft,S(a.value.page_id),1)])):$("",!0),a.value.page_name?(d(),r("div",Gt,[l[10]||(l[10]=e("label",null,"é¡µé¢åç§°ï¼š",-1)),e("span",null,S(a.value.page_name["zh-CN"]||""),1)])):$("",!0),(X=a.value.button_list)!=null&&X.length?(d(),r("div",Wt,[e("label",null,"è¯†åˆ«åˆ°çš„æŒ‰é’® ("+S(a.value.button_list.length)+"ä¸ª)ï¼š",1),e("div",Kt,[(d(!0),r(Z,null,ae(a.value.button_list,w=>(d(),r("span",{key:w,class:"config-tag"},S(w),1))),128))])])):$("",!0),(q=a.value.optional_actions)!=null&&q.length?(d(),r("div",Zt,[l[11]||(l[11]=e("label",null,"å¯é€‰æ“ä½œï¼š",-1)),e("div",Qt,[(d(!0),r(Z,null,ae(a.value.optional_actions,w=>(d(),r("span",{key:w,class:"config-tag accent"},S(w),1))),128))])])):$("",!0)]),e("div",{class:"preview-actions"},[e("button",{class:"action-btn secondary",onClick:I},[...l[12]||(l[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})],-1),_(" é‡æ–°è¯†åˆ« ",-1)])]),e("button",{class:"action-btn primary",onClick:C},[...l[13]||(l[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 6L9 17l-5-5"})],-1),_(" ç¡®è®¤åº”ç”¨ ",-1)])])])])])])):$("",!0),n.value&&c.status==="clarifying"?(d(),r("div",Xt,[e("div",Yt,[l[16]||(l[16]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",es,S(n.value.question_text||n.value),1)]),n.value.options?(d(),r("div",ts,[(d(!0),r(Z,null,ae(n.value.options,w=>(d(),r("button",{key:w,class:"option-btn",onClick:te=>D(w)},S(w),9,ss))),128))])):$("",!0)])):$("",!0)],512),H(R,{width:200,style:{display:"none"},preview:{visible:!!j.value,onVisibleChange:w=>{w||(j.value=null)},src:j.value}},null,8,["preview"]),A.value?(d(),r("div",as,[e("img",{src:L.value},null,8,ns),e("button",{class:"remove-btn",onClick:O},[...l[17]||(l[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):$("",!0),e("div",os,[e("div",ls,[e("label",{class:ee(["upload-btn",{disabled:m.value}])},[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",onChange:x,disabled:m.value},null,40,is),l[18]||(l[18]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),e("polyline",{points:"17 8 12 3 7 8"}),e("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1))],2),W(e("textarea",{ref:"inputRef","onUpdate:modelValue":l[0]||(l[0]=w=>E.value=w),placeholder:"è¾“å…¥ä¿®æ”¹å»ºè®®æˆ–é—®é¢˜...",disabled:m.value,onKeydown:b,rows:"1"},null,40,rs),[[K,E.value]]),e("button",{class:"send-btn",disabled:!E.value.trim()&&!A.value||m.value,onClick:P},[...l[19]||(l[19]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"})],-1)])],8,ds)]),l[20]||(l[20]=e("div",{class:"input-hint"}," Enter å‘é€ Â· Shift+Enter æ¢è¡Œ ",-1))])])}}},cs=ue(us,[["__scopeId","data-v-0826f096"]]),vs={class:"page-editor"},ps={class:"editor-header"},fs={class:"header-left"},gs={class:"header-title"},ms={class:"title-icon"},hs={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},bs={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},_s={class:"header-actions"},ys={key:0,class:"unsaved-badge"},ws=["disabled"],ks={key:0,class:"btn-spinner dark"},Cs=["disabled"],xs={key:0,class:"btn-spinner"},$s={class:"editor-body"},Ms={class:"editor-grid"},As={class:"panel panel-left"},Is={class:"panel-card"},Ds={class:"card-body"},Vs=["disabled"],Ns={key:0,class:"btn-spinner"},Es={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},zs={class:"panel-card"},Bs={class:"card-body"},Us={class:"json-preview-container"},Ss={class:"panel panel-center"},Ls={class:"panel-card config-card"},js={class:"card-body"},Os={class:"panel panel-right"},Ps={class:"panel-card ai-card"},Rs={class:"card-body"},Ts={key:0,class:"json-editor-error"},Hs={__name:"PageEditor",setup(c){const N=Ee(),o=ze(),p=je(),v=le(()=>N.name==="PageCreate"),n=g(""),E=g(""),m=g(null),M=g(""),A=g(!1),L=g(!1),j=g(!1),z=g(!1),a=g(null),k=g({}),i=g(""),C=g(!1),I=g(!1),b=g(""),u=g("");let x=null;const O=le(()=>{const s=p.draftConfig,t=(s.button_list||[]).filter(f=>f&&f.trim()),y=(s.optional_actions||[]).filter(f=>f&&f.trim()),V={pages:{[s.page_id||"unnamed"]:{name:s.name,description:s.description,buttonList:t,optionalActions:y}}};return JSON.stringify(V,null,2)}),J=()=>{b.value=O.value,u.value="",I.value=!0},P=s=>s&&typeof s=="object"?{"zh-CN":s["zh-CN"]||"",en:s.en||""}:typeof s=="string"?{"zh-CN":s,en:""}:{"zh-CN":"",en:""},D=s=>Array.isArray(s)?s.map(t=>t==null?"":String(t)).filter(t=>t.trim()):[],B=()=>{u.value="";let s=null;try{s=JSON.parse(b.value)}catch{u.value="JSON æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•";return}if(!s||typeof s!="object"||!s.pages||typeof s.pages!="object"){u.value="JSON ç»“æ„é”™è¯¯ï¼Œéœ€è¦åŒ…å« pages å¯¹è±¡";return}const t=Object.entries(s.pages);if(t.length===0){u.value="pages ä¸èƒ½ä¸ºç©º";return}const[y,V]=t[0];if(!y||typeof y!="string"){u.value="é¡µé¢ ID æ— æ•ˆ";return}const f=V||{};p.applyUserEdit({page_id:y,name:P(f.name),description:P(f.description),button_list:D(f.buttonList||f.button_list),optional_actions:D(f.optionalActions||f.optional_actions)}),I.value=!1,U.success("JSON å·²åº”ç”¨åˆ°è¡¨å•")};re(async()=>{if(p.resetConfig(),!v.value&&N.params.id)try{const s=await se.get(N.params.id);p.setOriginalConfig({page_id:s.page_id,name:s.name,description:s.description,button_list:s.button_list||[],optional_actions:s.optional_actions||[]}),n.value=s.screenshot_url||""}catch(s){console.error("Failed to load page:",s),U.error("åŠ è½½é¡µé¢å¤±è´¥"),o.push("/")}});const Q=s=>{n.value=s.file_url,U.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ")},ce=s=>{U.error(s.message||"ä¸Šä¼ å¤±è´¥")},h=async()=>{var s,t;if(!n.value){U.warning("è¯·å…ˆä¸Šä¼ é¡µé¢æˆªå›¾");return}A.value=!0,z.value=!0,M.value="parsing",i.value="";try{const y=se.parseStream(n.value,V=>{V.type==="content"&&(i.value+=V.content)},V=>{A.value=!1,M.value="completed",m.value=V,i.value="",U.success("AI è§£æå®Œæˆ")},V=>{A.value=!1,M.value="failed",i.value="",U.error(V||"è§£æå¤±è´¥")});window._currentParseStream=y}catch(y){A.value=!1,M.value="failed",U.error(((t=(s=y.response)==null?void 0:s.data)==null?void 0:t.message)||"è§£æå¤±è´¥")}},l=s=>{const{conflict:t}=p.tryApplyAiUpdate(s);t?(a.value=s,he.confirm({title:"é…ç½®å†²çª",icon:H(Se),content:"AI å·²æ›´æ–°é…ç½®ï¼Œä½†æ‚¨æœ‰æœªä¿å­˜çš„ä¿®æ”¹ã€‚æ˜¯å¦åº”ç”¨ AI æ›´æ–°ï¼Ÿ",okText:"åº”ç”¨ AI æ›´æ–°",cancelText:"ä¿ç•™æˆ‘çš„ä¿®æ”¹",onOk(){p.forceApplyAiUpdate(a.value),U.success("å·²åº”ç”¨ AI æ›´æ–°")},onCancel(){p.keepUserEdit()}})):U.success("AI è§£æå®Œæˆï¼Œé…ç½®å·²å¡«å……")},R=s=>{m.value=s},X=s=>{l(s),U.success("é…ç½®å·²åº”ç”¨åˆ°è¡¨å•")},q=()=>{A.value=!1},w=s=>{p.applyUserEdit(s)},te=()=>{he.confirm({title:"ç¡®è®¤é‡ç½®",content:"ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿæ­¤æ“ä½œå°†æ¸…ç©ºå½“å‰æ‰€æœ‰æœªä¿å­˜çš„å†…å®¹ã€‚",onOk(){n.value="",z.value=!1,E.value="",m.value=null,M.value="",A.value=!1,p.resetConfig(),U.success("é…ç½®å·²é‡ç½®")}})},F=()=>{var y,V,f,T,Y;const s={},t=p.draftConfig;return(y=t.page_id)!=null&&y.trim()?/^[a-zA-Z0-9_\.]+$/.test(t.page_id)||(s.page_id="åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹"):s.page_id="é¡µé¢ ID ä¸ºå¿…å¡«é¡¹",(f=(V=t.name)==null?void 0:V["zh-CN"])!=null&&f.trim()||(s.name_zh="ä¸­æ–‡åç§°ä¸ºå¿…å¡«é¡¹"),(Y=(T=t.name)==null?void 0:T.en)!=null&&Y.trim()||(s.name_en="è‹±æ–‡åç§°ä¸ºå¿…å¡«é¡¹"),s},fe=async({redirect:s=!0}={})=>{var y,V;const t=F();if(Object.keys(t).length>0)return k.value=t,U.error("è¯·æ£€æŸ¥è¡¨å•é”™è¯¯"),!1;L.value=!0;try{const f=p.draftConfig,T={page_id:f.page_id,name:f.name,description:f.description,button_list:f.button_list.filter(Y=>Y.trim()),optional_actions:f.optional_actions.filter(Y=>Y.trim()),screenshot_url:n.value};return v.value?await se.create(T):await se.update(N.params.id,T),U.success("ä¿å­˜æˆåŠŸ"),p.isDirty=!1,v.value&&s&&o.push(`/page/${f.page_id}`),!0}catch(f){return U.error(((V=(y=f.response)==null?void 0:y.data)==null?void 0:V.message)||"ä¿å­˜å¤±è´¥"),!1}finally{L.value=!1}},ge=async({redirect:s=!0}={})=>{var y,V,f;const t=(y=p.draftConfig.page_id)==null?void 0:y.trim();if(!t)return U.error("è¯·å…ˆå¡«å†™é¡µé¢ ID"),!1;if(!/^[a-zA-Z0-9_\.]+$/.test(t))return U.error("é¡µé¢ ID åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹"),!1;j.value=!0;try{const T=p.draftConfig,Y={page_id:t,name:T.name,description:T.description,button_list:T.button_list,optional_actions:T.optional_actions,screenshot_url:n.value};return await se.saveDraft(Y),U.success("è‰ç¨¿å·²ä¿å­˜"),p.isDirty=!1,v.value&&s&&o.replace(`/page/${t}`),!0}catch(T){return U.error(((f=(V=T.response)==null?void 0:V.data)==null?void 0:f.message)||"ä¿å­˜è‰ç¨¿å¤±è´¥"),!1}finally{j.value=!1}},ye=async()=>{await fe()},we=async()=>{await ge()},ke=async()=>{try{await navigator.clipboard.writeText(O.value),U.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{U.error("å¤åˆ¶å¤±è´¥")}},Ce=()=>{const s=new Blob([O.value],{type:"application/json"}),t=URL.createObjectURL(s),y=document.createElement("a");y.href=t,y.download=`${p.draftConfig.page_id||"config"}_${Date.now()}.json`,y.click(),URL.revokeObjectURL(t)},ve=()=>{const s=x;x=null,C.value=!1,s&&s()},xe=()=>{p.isDirty=!1,ve()},$e=async()=>{await ge({redirect:!1})&&ve()},Me=async()=>{await fe({redirect:!1})&&ve()};Be((s,t,y)=>{if(p.isDirty){x=y,C.value=!0;return}y()});const me=s=>{p.isDirty&&(s.preventDefault(),s.returnValue="")};return re(()=>{window.addEventListener("beforeunload",me)}),Ue(()=>{window.removeEventListener("beforeunload",me)}),oe(()=>N.path,()=>{}),(s,t)=>{const y=de("a-button"),V=de("a-modal");return d(),r("div",vs,[e("header",ps,[e("div",fs,[e("button",{class:"back-btn",onClick:t[0]||(t[0]=f=>s.$router.push("/"))},[...t[6]||(t[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),_(" è¿”å›åˆ—è¡¨ ",-1)])]),t[9]||(t[9]=e("div",{class:"header-divider"},null,-1)),e("div",gs,[e("span",ms,[v.value?(d(),r("svg",hs,[...t[7]||(t[7]=[e("path",{d:"M12 4v16m-8-8h16"},null,-1)])])):(d(),r("svg",bs,[...t[8]||(t[8]=[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"},null,-1),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"},null,-1)])]))]),_(" "+S(v.value?"æ·»åŠ é¡µé¢é…ç½®":"ç¼–è¾‘é¡µé¢é…ç½®"),1)])]),e("div",_s,[pe(p).isDirty?(d(),r("span",ys,[...t[10]||(t[10]=[e("span",{class:"dot"},null,-1),_(" æœªä¿å­˜ ",-1)])])):$("",!0),e("button",{class:"action-btn secondary",onClick:te}," é‡ç½® "),e("button",{class:"action-btn secondary",onClick:we,disabled:L.value||j.value},[j.value?(d(),r("span",ks)):$("",!0),t[11]||(t[11]=_(" ä¿å­˜è‰ç¨¿ ",-1))],8,ws),e("button",{class:"action-btn primary",onClick:ye,disabled:L.value||j.value},[L.value?(d(),r("span",xs)):$("",!0),t[12]||(t[12]=_(" ä¿å­˜é…ç½® ",-1))],8,Cs)])]),e("div",$s,[e("div",Ms,[e("aside",As,[e("div",Is,[t[14]||(t[14]=ne('<div class="card-header" data-v-44e66f30><h3 data-v-44e66f30><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-44e66f30><rect x="3" y="3" width="18" height="18" rx="2" data-v-44e66f30></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-44e66f30></circle><path d="M21 15l-5-5L5 21" data-v-44e66f30></path></svg> é¡µé¢æˆªå›¾ </h3></div>',1)),e("div",Ds,[H(Ye,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=f=>n.value=f),disabled:A.value,onUploadSuccess:Q,onUploadError:ce},null,8,["modelValue","disabled"]),e("button",{class:"ai-parse-btn",onClick:h,disabled:!n.value||A.value},[A.value?(d(),r("span",Ns)):(d(),r("svg",Es,[...t[13]||(t[13]=[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"},null,-1)])])),_(" "+S(A.value?"æ­£åœ¨åˆ†æ...":"AI è¾…åŠ©å¡«å†™"),1)],8,Vs)])]),e("div",zs,[e("div",{class:"card-header"},[t[18]||(t[18]=e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M16 18l6-6-6-6M8 6l-6 6 6 6"})]),_(" JSON é¢„è§ˆ ")],-1)),e("div",{class:"card-actions"},[e("button",{class:"icon-btn",onClick:J,title:"å±•å¼€ç¼–è¾‘"},[...t[15]||(t[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M8 3H3v5M16 3h5v5M8 21H3v-5M16 21h5v-5"})],-1)])]),e("button",{class:"icon-btn",onClick:ke,title:"å¤åˆ¶"},[...t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"}),e("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})],-1)])]),e("button",{class:"icon-btn",onClick:Ce,title:"ä¸‹è½½"},[...t[17]||(t[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"})],-1)])])])]),e("div",Bs,[e("div",Us,[e("pre",null,[e("code",null,S(O.value),1)])])])])]),e("main",Ss,[e("div",Ls,[t[19]||(t[19]=e("div",{class:"card-header"},[e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),_(" é…ç½®è¯¦æƒ… ")])],-1)),e("div",js,[H(xt,{config:pe(p).draftConfig,"session-id":E.value,errors:k.value,onConfigChanged:w},null,8,["config","session-id","errors"])])])]),e("aside",Os,[e("div",Ps,[t[20]||(t[20]=e("div",{class:"card-header"},[e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})]),_(" UI config å¡«å†™åŠ©æ‰‹ ")])],-1)),e("div",Rs,[H(cs,{"session-id":E.value,"parse-result":m.value,status:M.value,"current-config":pe(p).draftConfig,"image-url":n.value,"streaming-content":i.value,onConfigUpdated:R,onConfigConfirmed:X,onCompleted:q},null,8,["session-id","parse-result","status","current-config","image-url","streaming-content"])])])])])]),H(V,{open:I.value,"onUpdate:open":t[4]||(t[4]=f=>I.value=f),title:"JSON é…ç½®",width:760,maskClosable:!1,wrapClassName:"json-editor-modal"},{footer:G(()=>[H(y,{onClick:t[3]||(t[3]=f=>I.value=!1)},{default:G(()=>[...t[21]||(t[21]=[_("å–æ¶ˆ",-1)])]),_:1}),H(y,{type:"primary",onClick:B},{default:G(()=>[...t[22]||(t[22]=[_("åº”ç”¨",-1)])]),_:1})]),default:G(()=>[W(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=f=>b.value=f),class:"json-editor-textarea",rows:"18",spellcheck:"false"},null,512),[[K,b.value]]),u.value?(d(),r("p",Ts,S(u.value),1)):$("",!0)]),_:1},8,["open"]),H(V,{open:C.value,"onUpdate:open":t[5]||(t[5]=f=>C.value=f),title:"æœªä¿å­˜çš„æ›´æ”¹",maskClosable:!1,closable:!1},{footer:G(()=>[H(y,{disabled:L.value||j.value,onClick:xe},{default:G(()=>[...t[23]||(t[23]=[_("ç›´æ¥é€€å‡º",-1)])]),_:1},8,["disabled"]),H(y,{loading:j.value,onClick:$e},{default:G(()=>[...t[24]||(t[24]=[_("ä¿æŒè‰ç¨¿",-1)])]),_:1},8,["loading"]),H(y,{type:"primary",loading:L.value,onClick:Me},{default:G(()=>[...t[25]||(t[25]=[_("ä¿å­˜é…ç½®",-1)])]),_:1},8,["loading"])]),default:G(()=>[t[26]||(t[26]=e("p",null,"å½“å‰å†…å®¹æœªä¿å­˜ï¼Œæ‚¨è¦ç›´æ¥é€€å‡ºã€ä¿æŒè‰ç¨¿è¿˜æ˜¯ä¿å­˜é…ç½®ï¼Ÿ",-1))]),_:1},8,["open"])])}}},Fs=ue(Hs,[["__scopeId","data-v-44e66f30"]]);export{Fs as default};
