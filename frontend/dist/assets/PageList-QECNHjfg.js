import{r as v,c as st,o as at,a as m,b as n,d as e,e as p,f as R,w as h,g as M,F as B,h as P,i as nt,v as it,t as c,u as rt,j as i,k,n as y,l as D,m as C,p as N,M as q,E as Q}from"./index-VWhHohYx.js";import{_ as dt,p as H,a as z}from"./_plugin-vue_export-helper-CLyVweMD.js";const ct={class:"page-list"},ut={class:"page-header"},vt={class:"page-content"},pt={class:"filter-bar"},ft={class:"filter-left"},mt={class:"project-filter"},ht={class:"project-name"},kt={class:"project-dropdown"},gt={class:"dropdown-header"},_t={class:"dropdown-list"},wt={class:"item-count"},yt={class:"item-count"},Ct=["onClick"],bt={class:"item-count"},xt=["onClick"],Mt=["onClick"],jt={class:"filter-tabs"},$t=["onClick"],Bt={class:"tab-count"},Pt={class:"search-wrapper"},zt={key:0,class:"loading-state"},Vt={key:1,class:"empty-state"},Lt={key:2,class:"page-grid"},Tt=["onClick"],St={class:"card-thumbnail"},It=["src","alt"],Dt={key:1,class:"thumbnail-placeholder"},Nt={class:"card-content"},Ht={class:"card-header"},Ut={class:"card-title"},At={class:"card-id"},Et={class:"card-footer"},Ft={key:1,class:"update-time"},Ot={class:"card-actions"},Rt=["onClick"],qt=["onClick"],Qt={class:"project-form"},Gt={class:"form-group"},Jt={class:"form-group"},Kt={class:"form-group"},Wt={class:"color-picker"},Xt=["onClick"],Yt={class:"form-actions"},Zt={__name:"PageList",setup(te){const V=rt(),g=v([]),f=v([]),U=v(!0),j=v(""),a=v(null),r=v(null),$=v(""),b=v(!1),_=v(null),L=v(!1),u=v({name:"",description:"",color:"#6366f1"}),G=["#6366f1","#8b5cf6","#ec4899","#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#64748b","#1e293b"],J=[{label:"全部",value:""},{label:"已配置",value:"configured"},{label:"草稿",value:"draft"}],A=st(()=>{let l=g.value;if(a.value!==null&&(a.value===0?l=l.filter(t=>!t.project_id):l=l.filter(t=>t.project_id===a.value)),j.value&&(l=l.filter(t=>t.status===j.value)),$.value){const t=$.value.toLowerCase();l=l.filter(s=>s.page_id.toLowerCase().includes(t)||s.name_zh.toLowerCase().includes(t))}return l});at(async()=>{try{const[l,t]=await Promise.all([H.list(),z.list()]);g.value=l,f.value=t}catch(l){console.error("Failed to load data:",l),m.error("加载数据失败")}finally{U.value=!1}});const K=l=>{let t=g.value;return a.value!==null&&(a.value===0?t=t.filter(s=>!s.project_id):t=t.filter(s=>s.project_id===a.value)),l?t.filter(s=>s.status===l).length:t.length},W=l=>g.value.filter(t=>!t.project_id).length,T=l=>{const t=f.value.find(s=>s.id===l);return(t==null?void 0:t.color)||"#6366f1"},S=l=>{l?(a.value=l.id,r.value=l):(a.value=null,r.value=null)},E=(l=null)=>{_.value=l,l?u.value={name:l.name,description:l.description||"",color:l.color||"#6366f1"}:u.value={name:"",description:"",color:"#6366f1"},b.value=!0},X=async()=>{var l,t,s;if(!u.value.name.trim()){m.warning("请输入项目名称");return}L.value=!0;try{if(_.value){const d=await z.update(_.value.id,u.value),x=f.value.findIndex(I=>I.id===_.value.id);x>-1&&(f.value[x]={...f.value[x],...d}),((l=r.value)==null?void 0:l.id)===_.value.id&&(r.value={...r.value,...d}),m.success("项目更新成功")}else{const d=await z.create(u.value);f.value.unshift(d),m.success("项目创建成功")}b.value=!1}catch(d){m.error(((s=(t=d.response)==null?void 0:t.data)==null?void 0:s.detail)||"操作失败")}finally{L.value=!1}},Y=l=>{q.confirm({title:"删除项目",icon:p(Q),content:`确定要删除项目「${l.name}」吗？项目下的页面不会被删除，但会取消关联。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await z.delete(l.id),f.value=f.value.filter(s=>s.id!==l.id),a.value===l.id&&(a.value=null,r.value=null);const t=await H.list();g.value=t,m.success("项目已删除")}catch{m.error("删除失败，请重试")}}})},Z=l=>({configured:"success",draft:"warning",pending:"info"})[l]||"default",tt=l=>({configured:"已配置",draft:"草稿",pending:"待确认"})[l]||l,et=l=>{const t=new Date(l),d=new Date-t;return d<6e4?"刚刚":d<36e5?`${Math.floor(d/6e4)} 分钟前`:d<864e5?`${Math.floor(d/36e5)} 小时前`:t.toLocaleDateString("zh-CN")},F=()=>{a.value&&a.value!==0?V.push(`/page/new?project=${a.value}`):V.push("/page/new")},O=l=>{V.push(`/page/${l}`)},lt=l=>{q.confirm({title:"删除页面配置",icon:p(Q),content:`确定要删除「${l.name_zh}」吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await H.delete(l.page_id),g.value=g.value.filter(t=>t.id!==l.id),m.success("删除成功")}catch{m.error("删除失败，请重试")}}})};return(l,t)=>{const s=M("a-button"),d=M("a-dropdown"),x=M("a-input"),I=M("a-textarea"),ot=M("a-modal");return i(),n("div",ct,[e("header",ut,[t[11]||(t[11]=R('<div class="header-content" data-v-06409560><div class="title-group" data-v-06409560><h1 data-v-06409560><span class="icon-wrapper" data-v-06409560><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-06409560><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-06409560></path></svg></span> 页面配置 </h1><p class="subtitle" data-v-06409560>管理所有页面的 UI 配置，支持 AI 智能解析</p></div></div>',1)),p(s,{type:"primary",size:"large",class:"add-btn",onClick:F},{icon:h(()=>[...t[9]||(t[9]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5",class:"btn-icon"},[e("path",{d:"M12 4v16m-8-8h16"})],-1)])]),default:h(()=>[t[10]||(t[10]=k(" 添加页面 ",-1))]),_:1})]),e("div",vt,[e("div",pt,[e("div",ft,[e("div",mt,[p(d,{trigger:["click"],placement:"bottomLeft"},{overlay:h(()=>[e("div",kt,[e("div",gt,[t[14]||(t[14]=e("span",null,"选择项目",-1)),e("button",{class:"add-project-btn",onClick:t[0]||(t[0]=o=>E())},[...t[13]||(t[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 4v16m-8-8h16"})],-1),k(" 新建 ",-1)])])]),e("div",_t,[e("div",{class:C(["dropdown-item",{active:!a.value}]),onClick:t[1]||(t[1]=o=>S(null))},[t[15]||(t[15]=e("span",{class:"project-dot all"},null,-1)),t[16]||(t[16]=e("span",null,"全部项目",-1)),e("span",wt,c(g.value.length),1)],2),e("div",{class:C(["dropdown-item",{active:a.value===0}]),onClick:t[2]||(t[2]=o=>S({id:0,name:"未分配",color:"#9ca3af"}))},[t[17]||(t[17]=e("span",{class:"project-dot",style:{background:"#9ca3af"}},null,-1)),t[18]||(t[18]=e("span",null,"未分配",-1)),e("span",yt,c(W(0)),1)],2),(i(!0),n(B,null,P(f.value,o=>(i(),n("div",{key:o.id,class:C(["dropdown-item",{active:a.value===o.id}]),onClick:w=>S(o)},[e("span",{class:"project-dot",style:y({background:o.color})},null,4),e("span",null,c(o.name),1),e("span",bt,c(o.page_count),1),e("div",{class:"item-actions",onClick:t[3]||(t[3]=N(()=>{},["stop"]))},[e("button",{class:"item-action-btn",onClick:w=>E(o),title:"编辑"},[...t[19]||(t[19]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,xt),e("button",{class:"item-action-btn delete",onClick:w=>Y(o),title:"删除"},[...t[20]||(t[20]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,Mt)])],10,Ct))),128))])])]),default:h(()=>[e("button",{class:"project-select-btn",style:y(r.value?{borderColor:r.value.color}:{})},[r.value?(i(),n("span",{key:0,class:"project-dot",style:y({background:r.value.color})},null,4)):D("",!0),e("span",ht,c(r.value?r.value.name:"全部项目"),1),t[12]||(t[12]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"arrow-icon"},[e("path",{d:"M6 9l6 6 6-6"})],-1))],4)]),_:1})]),e("div",jt,[(i(),n(B,null,P(J,o=>e("button",{key:o.value,class:C(["filter-tab",{active:j.value===o.value}]),onClick:w=>j.value=o.value},[k(c(o.label)+" ",1),e("span",Bt,c(K(o.value)),1)],10,$t)),64))])]),e("div",Pt,[t[21]||(t[21]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"search-icon"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"M21 21l-4.35-4.35"})],-1)),nt(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>$.value=o),type:"text",placeholder:"搜索页面...",class:"search-input"},null,512),[[it,$.value]])])]),U.value?(i(),n("div",zt,[...t[22]||(t[22]=[e("div",{class:"loading-spinner"},[e("div",{class:"spinner"})],-1),e("p",null,"加载中...",-1)])])):A.value.length===0?(i(),n("div",Vt,[t[25]||(t[25]=R('<div class="empty-illustration" data-v-06409560><svg viewBox="0 0 200 200" fill="none" data-v-06409560><circle cx="100" cy="100" r="80" fill="#f1f5f9" data-v-06409560></circle><rect x="60" y="50" width="80" height="100" rx="8" fill="#e2e8f0" data-v-06409560></rect><rect x="70" y="65" width="40" height="6" rx="3" fill="#cbd5e1" data-v-06409560></rect><rect x="70" y="80" width="60" height="6" rx="3" fill="#cbd5e1" data-v-06409560></rect><rect x="70" y="95" width="50" height="6" rx="3" fill="#cbd5e1" data-v-06409560></rect><circle cx="100" cy="130" r="15" fill="#6366f1" opacity="0.2" data-v-06409560></circle><path d="M95 130h10M100 125v10" stroke="#6366f1" stroke-width="2" stroke-linecap="round" data-v-06409560></path></svg></div><h3 data-v-06409560>暂无页面配置</h3>',2)),e("p",null,c(r.value?`项目「${r.value.name}」下还没有页面`:"创建您的第一个页面配置，开始使用 AI 辅助解析功能"),1),p(s,{type:"primary",size:"large",onClick:F},{icon:h(()=>[...t[23]||(t[23]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5",class:"btn-icon"},[e("path",{d:"M12 4v16m-8-8h16"})],-1)])]),default:h(()=>[t[24]||(t[24]=k(" 开始创建 ",-1))]),_:1})])):(i(),n("div",Lt,[(i(!0),n(B,null,P(A.value,o=>(i(),n("article",{key:o.id,class:"page-card",onClick:w=>O(o.page_id)},[e("div",St,[o.screenshot_url?(i(),n("img",{key:0,src:o.screenshot_url,alt:o.name_zh,loading:"lazy"},null,8,It)):(i(),n("div",Dt,[...t[26]||(t[26]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),e("path",{d:"M8 21h8M12 17v4"})],-1)])]))]),e("div",Nt,[e("div",Ht,[e("h3",Ut,c(o.name_zh),1),e("span",{class:C(["status-badge",Z(o.status)])},c(tt(o.status)),3)]),e("p",At,c(o.page_id),1),e("div",Et,[o.project_name?(i(),n("span",{key:0,class:"project-tag",style:y({background:T(o.project_id)+"20",color:T(o.project_id)})},[e("span",{class:"tag-dot",style:y({background:T(o.project_id)})},null,4),k(" "+c(o.project_name),1)],4)):D("",!0),o.updated_at?(i(),n("span",Ft,[t[27]||(t[27]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 6v6l4 2"})],-1)),k(" "+c(et(o.updated_at)),1)])):D("",!0)])]),e("div",Ot,[e("button",{class:"action-btn edit",onClick:N(w=>O(o.page_id),["stop"]),title:"编辑"},[...t[28]||(t[28]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Rt),e("button",{class:"action-btn delete",onClick:N(w=>lt(o),["stop"]),title:"删除"},[...t[29]||(t[29]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,qt)])],8,Tt))),128))]))]),p(ot,{open:b.value,"onUpdate:open":t[8]||(t[8]=o=>b.value=o),title:_.value?"编辑项目":"新建项目",width:480,footer:null,destroyOnClose:!0,class:"project-modal"},{default:h(()=>[e("div",Qt,[e("div",Gt,[t[30]||(t[30]=e("label",null,[k("项目名称 "),e("span",{class:"required"},"*")],-1)),p(x,{value:u.value.name,"onUpdate:value":t[5]||(t[5]=o=>u.value.name=o),placeholder:"请输入项目名称",maxlength:100},null,8,["value"])]),e("div",Jt,[t[31]||(t[31]=e("label",null,"项目描述",-1)),p(I,{value:u.value.description,"onUpdate:value":t[6]||(t[6]=o=>u.value.description=o),placeholder:"请输入项目描述（可选）",rows:3,maxlength:500},null,8,["value"])]),e("div",Kt,[t[32]||(t[32]=e("label",null,"项目颜色",-1)),e("div",Wt,[(i(),n(B,null,P(G,o=>e("button",{key:o,class:C(["color-option",{active:u.value.color===o}]),style:y({background:o}),onClick:w=>u.value.color=o},null,14,Xt)),64))])]),e("div",Yt,[p(s,{onClick:t[7]||(t[7]=o=>b.value=!1)},{default:h(()=>[...t[33]||(t[33]=[k("取消",-1)])]),_:1}),p(s,{type:"primary",loading:L.value,onClick:X},{default:h(()=>[k(c(_.value?"保存":"创建"),1)]),_:1},8,["loading"])])])]),_:1},8,["open","title"])])}}},oe=dt(Zt,[["__scopeId","data-v-06409560"]]);export{oe as default};
