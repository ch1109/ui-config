import{r as v,c as se,o as ae,a as b,b as n,d as t,e as p,f as R,w as m,g as M,F as B,h as P,i as ne,v as ie,t as c,u as re,j as i,k as h,n as w,l as D,m as y,p as N,M as q,E as Q}from"./index-Dp0wXQeI.js";import{_ as de,p as H,a as z}from"./_plugin-vue_export-helper-DINGzuyA.js";const ce={class:"page-list"},ue={class:"page-header"},ve={class:"page-content"},pe={class:"filter-bar"},fe={class:"filter-left"},be={class:"project-filter"},me={class:"project-name"},he={class:"project-dropdown"},ke={class:"dropdown-header"},ge={class:"dropdown-list"},_e={class:"item-count"},we={class:"item-count"},ye=["onClick"],Ce={class:"item-count"},xe=["onClick"],Me=["onClick"],je={class:"filter-tabs"},$e=["onClick"],Be={class:"tab-count"},Pe={class:"search-wrapper"},ze={key:0,class:"loading-state"},Ve={key:1,class:"empty-state"},Le={key:2,class:"page-grid"},Te=["onClick"],Se={class:"card-thumbnail"},Ie=["src","alt"],De={key:1,class:"thumbnail-placeholder"},Ne={class:"card-content"},He={class:"card-header"},Ue={class:"card-title"},Ae={class:"card-id"},Ee={class:"card-footer"},Fe={key:1,class:"update-time"},Oe={class:"card-actions"},Re=["onClick"],qe=["onClick"],Qe={class:"project-form"},Ge={class:"form-group"},Je={class:"form-group"},Ke={class:"form-group"},We={class:"color-picker"},Xe=["onClick"],Ye={class:"form-actions"},Ze={__name:"PageList",setup(et){const V=re(),k=v([]),f=v([]),U=v(!0),j=v(""),a=v(null),r=v(null),$=v(""),C=v(!1),g=v(null),L=v(!1),u=v({name:"",description:"",color:"#6366f1"}),G=["#6366f1","#8b5cf6","#ec4899","#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#64748b","#1e293b"],J=[{label:"全部",value:""},{label:"已配置",value:"configured"},{label:"草稿",value:"draft"},{label:"待确认",value:"pending"}],A=se(()=>{let l=k.value;if(a.value!==null&&(a.value===0?l=l.filter(e=>!e.project_id):l=l.filter(e=>e.project_id===a.value)),j.value&&(l=l.filter(e=>e.status===j.value)),$.value){const e=$.value.toLowerCase();l=l.filter(s=>s.page_id.toLowerCase().includes(e)||s.name_zh.toLowerCase().includes(e))}return l});ae(async()=>{try{const[l,e]=await Promise.all([H.list(),z.list()]);k.value=l,f.value=e}catch(l){console.error("Failed to load data:",l),b.error("加载数据失败")}finally{U.value=!1}});const K=l=>{let e=k.value;return a.value!==null&&(a.value===0?e=e.filter(s=>!s.project_id):e=e.filter(s=>s.project_id===a.value)),l?e.filter(s=>s.status===l).length:e.length},W=l=>k.value.filter(e=>!e.project_id).length,T=l=>{const e=f.value.find(s=>s.id===l);return(e==null?void 0:e.color)||"#6366f1"},S=l=>{l?(a.value=l.id,r.value=l):(a.value=null,r.value=null)},E=(l=null)=>{g.value=l,l?u.value={name:l.name,description:l.description||"",color:l.color||"#6366f1"}:u.value={name:"",description:"",color:"#6366f1"},C.value=!0},X=async()=>{var l,e,s;if(!u.value.name.trim()){b.warning("请输入项目名称");return}L.value=!0;try{if(g.value){const d=await z.update(g.value.id,u.value),x=f.value.findIndex(I=>I.id===g.value.id);x>-1&&(f.value[x]={...f.value[x],...d}),((l=r.value)==null?void 0:l.id)===g.value.id&&(r.value={...r.value,...d}),b.success("项目更新成功")}else{const d=await z.create(u.value);f.value.unshift(d),b.success("项目创建成功")}C.value=!1}catch(d){b.error(((s=(e=d.response)==null?void 0:e.data)==null?void 0:s.detail)||"操作失败")}finally{L.value=!1}},Y=l=>{q.confirm({title:"删除项目",icon:p(Q),content:`确定要删除项目「${l.name}」吗？项目下的页面不会被删除，但会取消关联。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await z.delete(l.id),f.value=f.value.filter(s=>s.id!==l.id),a.value===l.id&&(a.value=null,r.value=null);const e=await H.list();k.value=e,b.success("项目已删除")}catch{b.error("删除失败，请重试")}}})},Z=l=>({configured:"success",draft:"warning",pending:"info"})[l]||"default",ee=l=>({configured:"已配置",draft:"草稿",pending:"待确认"})[l]||l,te=l=>{const e=new Date(l),d=new Date-e;return d<6e4?"刚刚":d<36e5?`${Math.floor(d/6e4)} 分钟前`:d<864e5?`${Math.floor(d/36e5)} 小时前`:e.toLocaleDateString("zh-CN")},F=()=>{a.value&&a.value!==0?V.push(`/page/new?project=${a.value}`):V.push("/page/new")},O=l=>{V.push(`/page/${l}`)},le=l=>{q.confirm({title:"删除页面配置",icon:p(Q),content:`确定要删除「${l.name_zh}」吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await H.delete(l.page_id),k.value=k.value.filter(e=>e.id!==l.id),b.success("删除成功")}catch{b.error("删除失败，请重试")}}})};return(l,e)=>{const s=M("a-button"),d=M("a-dropdown"),x=M("a-input"),I=M("a-textarea"),oe=M("a-modal");return i(),n("div",ce,[t("header",ue,[e[11]||(e[11]=R('<div class="header-content" data-v-bed6b51e><div class="title-group" data-v-bed6b51e><h1 data-v-bed6b51e><span class="icon-wrapper" data-v-bed6b51e><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-bed6b51e><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-bed6b51e></path></svg></span> 页面配置 </h1><p class="subtitle" data-v-bed6b51e>管理所有页面的 UI 配置，支持 AI 智能解析</p></div></div>',1)),p(s,{type:"primary",size:"large",class:"add-btn",onClick:F},{icon:m(()=>[...e[9]||(e[9]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5",class:"btn-icon"},[t("path",{d:"M12 4v16m-8-8h16"})],-1)])]),default:m(()=>[e[10]||(e[10]=h(" 添加页面 ",-1))]),_:1})]),t("div",ve,[t("div",pe,[t("div",fe,[t("div",be,[p(d,{trigger:["click"],placement:"bottomLeft"},{overlay:m(()=>[t("div",he,[t("div",ke,[e[14]||(e[14]=t("span",null,"选择项目",-1)),t("button",{class:"add-project-btn",onClick:e[0]||(e[0]=o=>E())},[...e[13]||(e[13]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 4v16m-8-8h16"})],-1),h(" 新建 ",-1)])])]),t("div",ge,[t("div",{class:y(["dropdown-item",{active:!a.value}]),onClick:e[1]||(e[1]=o=>S(null))},[e[15]||(e[15]=t("span",{class:"project-dot all"},null,-1)),e[16]||(e[16]=t("span",null,"全部项目",-1)),t("span",_e,c(k.value.length),1)],2),t("div",{class:y(["dropdown-item",{active:a.value===0}]),onClick:e[2]||(e[2]=o=>S({id:0,name:"未分配",color:"#9ca3af"}))},[e[17]||(e[17]=t("span",{class:"project-dot",style:{background:"#9ca3af"}},null,-1)),e[18]||(e[18]=t("span",null,"未分配",-1)),t("span",we,c(W(0)),1)],2),(i(!0),n(B,null,P(f.value,o=>(i(),n("div",{key:o.id,class:y(["dropdown-item",{active:a.value===o.id}]),onClick:_=>S(o)},[t("span",{class:"project-dot",style:w({background:o.color})},null,4),t("span",null,c(o.name),1),t("span",Ce,c(o.page_count),1),t("div",{class:"item-actions",onClick:e[3]||(e[3]=N(()=>{},["stop"]))},[t("button",{class:"item-action-btn",onClick:_=>E(o),title:"编辑"},[...e[19]||(e[19]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,xe),t("button",{class:"item-action-btn delete",onClick:_=>Y(o),title:"删除"},[...e[20]||(e[20]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,Me)])],10,ye))),128))])])]),default:m(()=>[t("button",{class:"project-select-btn",style:w(r.value?{borderColor:r.value.color}:{})},[r.value?(i(),n("span",{key:0,class:"project-dot",style:w({background:r.value.color})},null,4)):D("",!0),t("span",me,c(r.value?r.value.name:"全部项目"),1),e[12]||(e[12]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"arrow-icon"},[t("path",{d:"M6 9l6 6 6-6"})],-1))],4)]),_:1})]),t("div",je,[(i(),n(B,null,P(J,o=>t("button",{key:o.value,class:y(["filter-tab",{active:j.value===o.value}]),onClick:_=>j.value=o.value},[h(c(o.label)+" ",1),t("span",Be,c(K(o.value)),1)],10,$e)),64))])]),t("div",Pe,[e[21]||(e[21]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"search-icon"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"M21 21l-4.35-4.35"})],-1)),ne(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>$.value=o),type:"text",placeholder:"搜索页面...",class:"search-input"},null,512),[[ie,$.value]])])]),U.value?(i(),n("div",ze,[...e[22]||(e[22]=[t("div",{class:"loading-spinner"},[t("div",{class:"spinner"})],-1),t("p",null,"加载中...",-1)])])):A.value.length===0?(i(),n("div",Ve,[e[25]||(e[25]=R('<div class="empty-illustration" data-v-bed6b51e><svg viewBox="0 0 200 200" fill="none" data-v-bed6b51e><circle cx="100" cy="100" r="80" fill="#f1f5f9" data-v-bed6b51e></circle><rect x="60" y="50" width="80" height="100" rx="8" fill="#e2e8f0" data-v-bed6b51e></rect><rect x="70" y="65" width="40" height="6" rx="3" fill="#cbd5e1" data-v-bed6b51e></rect><rect x="70" y="80" width="60" height="6" rx="3" fill="#cbd5e1" data-v-bed6b51e></rect><rect x="70" y="95" width="50" height="6" rx="3" fill="#cbd5e1" data-v-bed6b51e></rect><circle cx="100" cy="130" r="15" fill="#6366f1" opacity="0.2" data-v-bed6b51e></circle><path d="M95 130h10M100 125v10" stroke="#6366f1" stroke-width="2" stroke-linecap="round" data-v-bed6b51e></path></svg></div><h3 data-v-bed6b51e>暂无页面配置</h3>',2)),t("p",null,c(r.value?`项目「${r.value.name}」下还没有页面`:"创建您的第一个页面配置，开始使用 AI 辅助解析功能"),1),p(s,{type:"primary",size:"large",onClick:F},{icon:m(()=>[...e[23]||(e[23]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5",class:"btn-icon"},[t("path",{d:"M12 4v16m-8-8h16"})],-1)])]),default:m(()=>[e[24]||(e[24]=h(" 开始创建 ",-1))]),_:1})])):(i(),n("div",Le,[(i(!0),n(B,null,P(A.value,o=>(i(),n("article",{key:o.id,class:"page-card",onClick:_=>O(o.page_id)},[t("div",Se,[o.screenshot_url?(i(),n("img",{key:0,src:o.screenshot_url,alt:o.name_zh,loading:"lazy"},null,8,Ie)):(i(),n("div",De,[...e[26]||(e[26]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})],-1)])]))]),t("div",Ne,[t("div",He,[t("h3",Ue,c(o.name_zh),1),t("span",{class:y(["status-badge",Z(o.status)])},c(ee(o.status)),3)]),t("p",Ae,c(o.page_id),1),t("div",Ee,[o.project_name?(i(),n("span",{key:0,class:"project-tag",style:w({background:T(o.project_id)+"20",color:T(o.project_id)})},[t("span",{class:"tag-dot",style:w({background:T(o.project_id)})},null,4),h(" "+c(o.project_name),1)],4)):D("",!0),o.updated_at?(i(),n("span",Fe,[e[27]||(e[27]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M12 6v6l4 2"})],-1)),h(" "+c(te(o.updated_at)),1)])):D("",!0)])]),t("div",Oe,[t("button",{class:"action-btn edit",onClick:N(_=>O(o.page_id),["stop"]),title:"编辑"},[...e[28]||(e[28]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Re),t("button",{class:"action-btn delete",onClick:N(_=>le(o),["stop"]),title:"删除"},[...e[29]||(e[29]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,qe)])],8,Te))),128))]))]),p(oe,{open:C.value,"onUpdate:open":e[8]||(e[8]=o=>C.value=o),title:g.value?"编辑项目":"新建项目",width:480,footer:null,destroyOnClose:!0,class:"project-modal"},{default:m(()=>[t("div",Qe,[t("div",Ge,[e[30]||(e[30]=t("label",null,[h("项目名称 "),t("span",{class:"required"},"*")],-1)),p(x,{value:u.value.name,"onUpdate:value":e[5]||(e[5]=o=>u.value.name=o),placeholder:"请输入项目名称",maxlength:100},null,8,["value"])]),t("div",Je,[e[31]||(e[31]=t("label",null,"项目描述",-1)),p(I,{value:u.value.description,"onUpdate:value":e[6]||(e[6]=o=>u.value.description=o),placeholder:"请输入项目描述（可选）",rows:3,maxlength:500},null,8,["value"])]),t("div",Ke,[e[32]||(e[32]=t("label",null,"项目颜色",-1)),t("div",We,[(i(),n(B,null,P(G,o=>t("button",{key:o,class:y(["color-option",{active:u.value.color===o}]),style:w({background:o}),onClick:_=>u.value.color=o},null,14,Xe)),64))])]),t("div",Ye,[p(s,{onClick:e[7]||(e[7]=o=>C.value=!1)},{default:m(()=>[...e[33]||(e[33]=[h("取消",-1)])]),_:1}),p(s,{type:"primary",loading:L.value,onClick:X},{default:m(()=>[h(c(g.value?"保存":"创建"),1)]),_:1},8,["loading"])])])]),_:1},8,["open","title"])])}}},ot=de(Ze,[["__scopeId","data-v-bed6b51e"]]);export{ot as default};
