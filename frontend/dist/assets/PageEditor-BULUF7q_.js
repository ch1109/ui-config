import{q as ye,r as m,c as ne,o as oe,s as Ce,b as d,j as u,F as Z,d as e,k as y,p as ue,t as U,f as te,m as Q,x as we,y as ae,i as W,v as K,l as A,h as ee,e as q,g as ve,z as ke,A as $e,a as V,u as xe,B as Ae,C as Ie,D as ce,w as se,M as fe,E as Me}from"./index-C9Ky3jQK.js";import{_ as le,p as Y,c as De}from"./_plugin-vue_export-helper-BQ15yOP5.js";function ge(c,I){if(!I)return c;let l=c||"";const{behavior_rules:v,page_goal:p}=I;return v&&!l.includes("## è¡Œä¸ºè§„åˆ™")&&(l+=`

## è¡Œä¸ºè§„åˆ™
${v}`),p&&!l.includes("## é¡µé¢ç›®æ ‡")&&(l+=`

## é¡µé¢ç›®æ ‡
${p}`),l.trim()}function me(c,I){if(!I)return c;let l=c||"";const{behavior_rules:v,page_goal:p}=I;return v&&!l.includes("## Behavior Rules")&&(l+=`

## Behavior Rules
${v}`),p&&!l.includes("## Page Goal")&&(l+=`

## Page Goal
${p}`),l.trim()}const Ee=ye("uiConfig",()=>{const c=m({page_id:"",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},button_list:[],optional_actions:[]}),I=m(null),l=m(!1),v=m(null),p=m(null),a=ne(()=>l.value);function M(t){Object.assign(c.value,t),l.value=!0}function g(t){return l.value?{conflict:!0}:($(t),{conflict:!1})}function z(t){$(t),l.value=!1}function $(t){if(t.page_id&&(c.value.page_id=t.page_id),t.page_name&&(c.value.name={"zh-CN":t.page_name["zh-CN"]||"",en:t.page_name.en||""}),t.page_description){let i=t.page_description["zh-CN"]||"",h=t.page_description.en||"";t.ai_context&&(i=ge(i,t.ai_context),h=me(h,t.ai_context)),c.value.description={"zh-CN":i,en:h}}t.button_list&&(c.value.button_list=t.button_list),t.optional_actions&&(c.value.optional_actions=t.optional_actions)}function B(){}function D(){c.value={page_id:"",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},button_list:[],optional_actions:[]},I.value=null,l.value=!1,v.value=null}function E(t){const i={...t};t.ai_context&&t.description&&(i.description={"zh-CN":ge(t.description["zh-CN"]||"",t.ai_context),en:me(t.description.en||"",t.ai_context)}),delete i.ai_context,I.value=JSON.parse(JSON.stringify(i)),c.value=JSON.parse(JSON.stringify(i)),l.value=!1}function s(t){v.value=t}function _(t,i="success",h=3e3){p.value={message:t,type:i},setTimeout(()=>{p.value=null},h)}return{draftConfig:c,originalConfig:I,isDirty:l,currentSession:v,toast:p,hasChanges:a,applyUserEdit:M,tryApplyAiUpdate:g,forceApplyAiUpdate:z,keepUserEdit:B,resetConfig:D,setOriginalConfig:E,setCurrentSession:s,showToast:_}}),Ve=["src"],Be={class:"overlay"},Ne={class:"btn-action"},Ue=["disabled"],ze={key:1,class:"upload-progress"},Le={class:"progress-ring"},Re={viewBox:"0 0 100 100"},Pe=["stroke-dasharray"],Se={class:"percent"},Oe={key:2,class:"upload-placeholder-wrapper"},Te={class:"upload-placeholder"},je=["disabled"],He={class:"upload-actions"},Fe=["disabled"],qe={__name:"ImageUploader",props:{modelValue:String,disabled:Boolean},emits:["update:modelValue","upload-success","upload-error"],setup(c,{emit:I}){const l=c,v=I,p=m(!1),a=m(!1),M=m(0),g=()=>{l.disabled||(p.value=!0)},z=()=>{p.value=!1},$=t=>{if(p.value=!1,l.disabled||a.value)return;const i=t.dataTransfer.files;i.length>0&&D(i[0])},B=async t=>{const i=t.target,h=i.files;try{h&&h.length>0&&await D(h[0])}finally{i.value=""}},D=async t=>{var x,L,R;if(!t)return;if(!["image/png","image/jpeg","image/jpg"].includes(t.type)){v("upload-error",{code:"INVALID_FILE_TYPE",message:"ä»…æ”¯æŒ PNGã€JPG æ ¼å¼çš„å›¾ç‰‡"});return}const h=10*1024*1024;if(t.size>h){v("upload-error",{code:"FILE_TOO_LARGE",message:"å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MB"});return}a.value=!0,M.value=0;try{const k=await Y.uploadImage(t,S=>{M.value=S});v("update:modelValue",k.file_url),v("upload-success",k)}catch(k){console.error("Upload error:",k);let S="ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",H="UPLOAD_FAILED";k.code==="UPLOAD_FAILED"||k.name==="NotReadableError"?(S=k.message,H="FILE_READ_ERROR"):(x=k.message)!=null&&x.includes("Network Error")||k.code==="ERR_NETWORK"?(S="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ",H="NETWORK_ERROR"):(R=(L=k.response)==null?void 0:L.data)!=null&&R.message?(S=k.response.data.message,H=k.response.data.error||"SERVER_ERROR"):k.message&&(S=k.message),v("upload-error",{code:H,message:S})}finally{a.value=!1}},E=()=>{v("update:modelValue",null)},s=async()=>{if(!(l.disabled||a.value))try{if(!navigator.clipboard||!navigator.clipboard.read){v("upload-error",{code:"CLIPBOARD_API_UNAVAILABLE",message:"è¯·å…ˆå¤åˆ¶å›¾ç‰‡ï¼Œç„¶åæŒ‰ Ctrl+V (Windows) æˆ– Cmd+V (Mac) ç²˜è´´"});return}const t=await navigator.clipboard.read();let i=!1;for(const h of t)for(const x of h.types)if(x.startsWith("image/")){i=!0;const L=await h.getType(x),R=x==="image/jpeg"?"jpg":x.split("/")[1],k=`pasted-image-${Date.now()}.${R}`,S=new File([L],k,{type:x});await D(S);return}i||v("upload-error",{code:"NO_IMAGE_IN_CLIPBOARD",message:"å‰ªè´´æ¿ä¸­æ²¡æœ‰å›¾ç‰‡ï¼Œè¯·å…ˆå¤åˆ¶å›¾ç‰‡åå†è¯•"})}catch(t){console.error("Paste from clipboard error:",t),t.name==="NotAllowedError"?v("upload-error",{code:"CLIPBOARD_PERMISSION_DENIED",message:"è¯·å…è®¸æµè§ˆå™¨è®¿é—®å‰ªè´´æ¿ï¼Œæˆ–ä½¿ç”¨ Ctrl+V (Windows) / Cmd+V (Mac) ç²˜è´´"}):t.name==="NotFoundError"?v("upload-error",{code:"NO_IMAGE_IN_CLIPBOARD",message:"å‰ªè´´æ¿ä¸­æ²¡æœ‰å›¾ç‰‡ï¼Œè¯·å…ˆå¤åˆ¶å›¾ç‰‡åå†è¯•"}):v("upload-error",{code:"CLIPBOARD_READ_ERROR",message:"è¯»å–å‰ªè´´æ¿å¤±è´¥ï¼Œè¯·å°è¯•ä½¿ç”¨ Ctrl+V (Windows) æˆ– Cmd+V (Mac) ç²˜è´´"})}},_=async t=>{var x;const i=document.activeElement;if(i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)||l.disabled||a.value)return;const h=(x=t.clipboardData)==null?void 0:x.items;if(!(!h||h.length===0))for(let L=0;L<h.length;L++){const R=h[L];if(R.type.startsWith("image/")){t.preventDefault();const k=R.getAsFile();if(k){await D(k);return}}}};return oe(()=>{document.addEventListener("paste",_)}),Ce(()=>{document.removeEventListener("paste",_)}),(t,i)=>(u(),d("div",{class:Q(["image-uploader",{"is-dragover":p.value,"has-image":c.modelValue,"is-disabled":c.disabled||a.value}]),onDragover:ue(g,["prevent"]),onDragleave:z,onDrop:ue($,["prevent"])},[c.modelValue?(u(),d(Z,{key:0},[e("img",{src:c.modelValue,alt:"é¡µé¢æˆªå›¾",class:"preview-image"},null,8,Ve),e("div",Be,[e("label",Ne,[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",disabled:c.disabled||a.value,onChange:B,class:"hidden-input"},null,40,Ue),i[0]||(i[0]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})],-1)),i[1]||(i[1]=y(" æ›´æ¢ ",-1))]),e("button",{class:"btn-action danger",type:"button",onClick:ue(E,["stop"])},[...i[2]||(i[2]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1),y(" ç§»é™¤ ",-1)])])])],64)):a.value?(u(),d("div",ze,[e("div",Le,[(u(),d("svg",Re,[i[3]||(i[3]=e("circle",{class:"bg",cx:"50",cy:"50",r:"45"},null,-1)),e("circle",{class:"progress",cx:"50",cy:"50",r:"45","stroke-dasharray":`${M.value*283} 283`},null,8,Pe)])),e("span",Se,U(Math.round(M.value*100))+"%",1)]),i[4]||(i[4]=e("p",null,"ä¸Šä¼ ä¸­...",-1))])):(u(),d("div",Oe,[e("label",Te,[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",disabled:c.disabled||a.value,onChange:B,class:"hidden-input"},null,40,je),i[5]||(i[5]=te('<div class="upload-icon" data-v-da037bf5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-da037bf5><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-da037bf5></path></svg></div><p class="upload-text" data-v-da037bf5>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p><p class="upload-hint" data-v-da037bf5>æˆ–ç‚¹å‡»ä¸Šä¼ </p><p class="upload-formats" data-v-da037bf5>æ”¯æŒ PNG, JPG (æœ€å¤§ 10MB)</p>',4))]),e("div",He,[e("button",{class:"paste-btn",type:"button",disabled:c.disabled||a.value,onClick:s,title:"ä»å‰ªè´´æ¿ç²˜è´´å›¾ç‰‡ (Ctrl/Cmd + V)"},[...i[6]||(i[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),y(" ç²˜è´´å›¾ç‰‡ ",-1)])],8,Fe)])]))],34))}},Ge=le(qe,[["__scopeId","data-v-da037bf5"]]),Je={class:"config-editor"},We={class:"section"},Ke={class:"form-grid"},Ze={class:"form-field full-width"},Qe={class:"form-field"},Xe={key:0,class:"field-hint error"},Ye={class:"form-field"},et={key:0,class:"field-hint error"},tt={class:"form-field full-width"},st={class:"field-help"},at={key:0,class:"help-content"},nt={class:"form-field full-width"},ot={class:"section"},lt={class:"form-field"},it={class:"list-editor"},rt=["onUpdate:modelValue"],dt=["onClick"],ut={key:0,class:"field-hint error"},ct={class:"form-field"},vt={class:"list-editor"},pt=["onUpdate:modelValue"],ft=["onClick"],gt=`æè¿°æ­¤é¡µé¢çš„åŠŸèƒ½å’Œç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œ...

ç¤ºä¾‹æ ¼å¼ï¼š
ç”¨æˆ·ä¸­å¿ƒæ˜¯ç®¡ç†ä¸ªäººä¿¡æ¯çš„æ ¸å¿ƒé¡µé¢ã€‚

ç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œï¼š
- ä¿®æ”¹å¤´åƒå’Œæ˜µç§°
- æ›´æ–°è”ç³»æ–¹å¼
- ä¿®æ”¹å¯†ç 

## è¡Œä¸ºè§„åˆ™
- å¼•å¯¼ç”¨æˆ·å®Œå–„å¿…å¡«ä¿¡æ¯
- æ•æ„Ÿæ“ä½œéœ€äºŒæ¬¡ç¡®è®¤

## é¡µé¢ç›®æ ‡
å¸®åŠ©ç”¨æˆ·ç»´æŠ¤ä¸ªäººä¿¡æ¯ï¼Œç¡®ä¿è´¦æˆ·å®‰å…¨`,mt={__name:"ConfigEditor",props:{config:{type:Object,required:!0},sessionId:String,errors:{type:Object,default:()=>({})}},emits:["config-changed"],setup(c,{emit:I}){const l=c,v=I,p=m(!1),a=we({page_id:"",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},button_list:[""],optional_actions:[]});oe(()=>{M()}),ae(()=>l.config,()=>{M()},{deep:!0});const M=()=>{var E,s,_,t,i;if(l.config){a.page_id=l.config.page_id||"",a.name={"zh-CN":((E=l.config.name)==null?void 0:E["zh-CN"])||"",en:((s=l.config.name)==null?void 0:s.en)||""};let h=((_=l.config.description)==null?void 0:_["zh-CN"])||"",x=((t=l.config.description)==null?void 0:t.en)||"";if(l.config.ai_context){const{behavior_rules:L,page_goal:R}=l.config.ai_context;L&&!h.includes("## è¡Œä¸ºè§„åˆ™")&&(h+=`

## è¡Œä¸ºè§„åˆ™
${L}`),R&&!h.includes("## é¡µé¢ç›®æ ‡")&&(h+=`

## é¡µé¢ç›®æ ‡
${R}`),L&&!x.includes("## Behavior Rules")&&(x+=`

## Behavior Rules
${L}`),R&&!x.includes("## Page Goal")&&(x+=`

## Page Goal
${R}`)}a.description={"zh-CN":h.trim(),en:x.trim()},a.button_list=(i=l.config.button_list)!=null&&i.length?[...l.config.button_list]:[""],a.optional_actions=l.config.optional_actions?[...l.config.optional_actions]:[]}},g=()=>{v("config-changed",{page_id:a.page_id,name:{...a.name},description:{...a.description},button_list:[...a.button_list],optional_actions:[...a.optional_actions]})},z=()=>{a.button_list.push(""),g()},$=E=>{a.button_list.length<=1||(a.button_list.splice(E,1),g())},B=()=>{a.optional_actions.push(""),g()},D=E=>{a.optional_actions.splice(E,1),g()};return(E,s)=>(u(),d("div",Je,[e("section",We,[s[13]||(s[13]=e("div",{class:"section-header"},[e("div",{class:"section-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("h3",null,"åŸºæœ¬ä¿¡æ¯")],-1)),e("div",Ke,[e("div",Ze,[s[6]||(s[6]=e("label",null,[y(" é¡µé¢ ID (è‹±æ–‡æ ‡è¯†) "),e("span",{class:"required"},"*")],-1)),W(e("input",{"onUpdate:modelValue":s[0]||(s[0]=_=>a.page_id=_),type:"text",class:Q(["form-input",{error:c.errors.page_id}]),placeholder:"ä¾‹å¦‚: 1.0home_page, 4.1face_authorization_page",onInput:g},null,34),[[K,a.page_id]]),e("span",{class:Q(["field-hint",{error:c.errors.page_id}])},U(c.errors.page_id||"æ ¼å¼: {é¡µé¢ç¼–å·}{è‹±æ–‡åç§°}ï¼Œå¦‚ 4.1face_authorization_pageï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”"),3)]),e("div",Qe,[s[7]||(s[7]=e("label",null,[y(" é¡µé¢åç§° (ä¸­æ–‡) "),e("span",{class:"required"},"*")],-1)),W(e("input",{"onUpdate:modelValue":s[1]||(s[1]=_=>a.name["zh-CN"]=_),type:"text",class:Q(["form-input",{error:c.errors.name_zh}]),placeholder:"ä¾‹å¦‚: é¦–é¡µã€ç”¨æˆ·ä¸­å¿ƒ",onInput:g},null,34),[[K,a.name["zh-CN"]]]),c.errors.name_zh?(u(),d("span",Xe,U(c.errors.name_zh),1)):A("",!0)]),e("div",Ye,[s[8]||(s[8]=e("label",null,[y(" Page Name (EN) "),e("span",{class:"required"},"*")],-1)),W(e("input",{"onUpdate:modelValue":s[2]||(s[2]=_=>a.name.en=_),type:"text",class:Q(["form-input",{error:c.errors.name_en}]),placeholder:"e.g. Home Page, User Profile",onInput:g},null,34),[[K,a.name.en]]),c.errors.name_en?(u(),d("span",et,U(c.errors.name_en),1)):A("",!0)]),e("div",tt,[s[11]||(s[11]=e("label",null,[y(" é¡µé¢æè¿° (ä¸­æ–‡) "),e("span",{class:"label-hint"},"åŒ…å«åŠŸèƒ½è¯´æ˜ã€è¡Œä¸ºè§„åˆ™å’Œé¡µé¢ç›®æ ‡")],-1)),W(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=_=>a.description["zh-CN"]=_),class:"form-textarea description-textarea",rows:"8",placeholder:gt,onInput:g},null,544),[[K,a.description["zh-CN"]]]),e("div",st,[e("button",{type:"button",class:"help-toggle",onClick:s[4]||(s[4]=_=>p.value=!p.value)},[s[9]||(s[9]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)),y(" "+U(p.value?"æ”¶èµ·æ ¼å¼è¯´æ˜":"æŸ¥çœ‹æ ¼å¼è¯´æ˜"),1)]),p.value?(u(),d("div",at,[...s[10]||(s[10]=[e("p",null,[e("strong",null,"æ¨èæ ¼å¼ï¼š")],-1),e("pre",null,`é¡µé¢åŠŸèƒ½æ¦‚è¿°...

ç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œï¼š
- æ“ä½œ1
- æ“ä½œ2

## è¡Œä¸ºè§„åˆ™
AI åœ¨æ­¤é¡µé¢åº”éµå¾ªçš„çº¦æŸ...

## é¡µé¢ç›®æ ‡
ç”¨æˆ·åœ¨æ­¤é¡µé¢çš„ä¸»è¦ç›®æ ‡...`,-1)])])):A("",!0)])]),e("div",nt,[s[12]||(s[12]=e("label",null,[y(" Page Description (EN) "),e("span",{class:"label-hint"},"Optional")],-1)),W(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=_=>a.description.en=_),class:"form-textarea",rows:"4",placeholder:"Describe the page features and available user actions...",onInput:g},null,544),[[K,a.description.en]])])])]),e("section",ot,[s[20]||(s[20]=te('<div class="section-header" data-v-57d8bbe6><div class="section-icon accent" data-v-57d8bbe6><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-57d8bbe6><rect x="3" y="3" width="7" height="7" data-v-57d8bbe6></rect><rect x="14" y="3" width="7" height="7" data-v-57d8bbe6></rect><rect x="14" y="14" width="7" height="7" data-v-57d8bbe6></rect><rect x="3" y="14" width="7" height="7" data-v-57d8bbe6></rect></svg></div><h3 data-v-57d8bbe6>é¡µé¢èƒ½åŠ›</h3></div>',1)),e("div",lt,[s[16]||(s[16]=e("label",null," å¯ç‚¹å‡»æŒ‰é’® ",-1)),e("div",it,[(u(!0),d(Z,null,ee(a.button_list,(_,t)=>(u(),d("div",{key:t,class:"list-item"},[W(e("input",{"onUpdate:modelValue":i=>a.button_list[t]=i,type:"text",class:"form-input",placeholder:"æŒ‰é’® ID (snake_case)",onInput:g},null,40,rt),[[K,a.button_list[t]]]),a.button_list.length>1?(u(),d("button",{key:0,class:"remove-btn",onClick:i=>$(t),type:"button"},[...s[14]||(s[14]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M15 9l-6 6M9 9l6 6"})],-1)])],8,dt)):A("",!0)]))),128)),e("button",{class:"add-btn",onClick:z,type:"button"},[...s[15]||(s[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v8M8 12h8"})],-1),y(" æ·»åŠ æŒ‰é’® ",-1)])])]),c.errors.button_list?(u(),d("span",ut,U(c.errors.button_list),1)):A("",!0)]),e("div",ct,[s[19]||(s[19]=e("label",null,"å¯é€‰æ“ä½œ",-1)),e("div",vt,[(u(!0),d(Z,null,ee(a.optional_actions,(_,t)=>(u(),d("div",{key:t,class:"list-item"},[W(e("input",{"onUpdate:modelValue":i=>a.optional_actions[t]=i,type:"text",class:"form-input",placeholder:"æ“ä½œ ID",onInput:g},null,40,pt),[[K,a.optional_actions[t]]]),e("button",{class:"remove-btn",onClick:i=>D(t),type:"button"},[...s[17]||(s[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M15 9l-6 6M9 9l6 6"})],-1)])],8,ft)]))),128)),e("button",{class:"add-btn",onClick:B,type:"button"},[...s[18]||(s[18]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v8M8 12h8"})],-1),y(" æ·»åŠ æ“ä½œ ",-1)])])])])])]))}},ht=le(mt,[["__scopeId","data-v-57d8bbe6"]]),bt={class:"clarify-panel"},_t={class:"panel-header"},yt={key:0,class:"message assistant"},Ct={class:"bubble-wrapper"},wt={key:0,class:"avatar small"},kt={class:"bubble"},$t=["src","onClick"],xt=["innerHTML"],At={key:1,class:"streaming-cursor"},It={class:"timestamp"},Mt={key:1,class:"message assistant"},Dt={class:"bubble-wrapper"},Et={class:"bubble"},Vt={class:"streaming-output"},Bt={key:1,class:"parsing-message"},Nt={key:2,class:"message assistant"},Ut={key:3,class:"message assistant"},zt={class:"bubble-wrapper"},Lt={class:"bubble config-preview"},Rt={class:"config-summary"},Pt={key:0,class:"config-item"},St={class:"page-id-value"},Ot={key:1,class:"config-item"},Tt={key:2,class:"config-item"},jt={class:"tag-list"},Ht={key:3,class:"config-item"},Ft={class:"tag-list"},qt={key:4,class:"message assistant"},Gt={class:"bubble-wrapper"},Jt={class:"bubble"},Wt={key:0,class:"quick-options"},Kt=["onClick"],Zt={key:0,class:"pending-image"},Qt=["src"],Xt={class:"input-area"},Yt={class:"input-wrapper"},es=["disabled"],ts=["disabled"],ss=["disabled"],as={__name:"ClarifyPanel",props:{sessionId:String,parseResult:Object,status:String,currentConfig:Object,imageUrl:String,streamingContent:String},emits:["config-updated","config-confirmed","completed"],setup(c,{emit:I}){const l=c,v=I,p=m([]),a=m(null),M=m(""),g=m(!1),z=m(null),$=m(null),B=m(null),D=m(null),E=m(!1),s=m(null),_=m(!1),t=ne(()=>({pending:"ç­‰å¾…ä¸­",parsing:"åˆ†æä¸­...",clarifying:"å¯¹è¯ä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"})[l.status]||"");ae(()=>l.parseResult,f=>{var o;f&&l.status==="completed"&&!_.value&&(s.value=f,E.value=!0,O()),((o=f==null?void 0:f.clarification_questions)==null?void 0:o.length)>0?a.value=f.clarification_questions[0]:a.value=null},{immediate:!0}),ae(()=>l.status,(f,o)=>{var P;f==="parsing"&&o!=="parsing"&&(p.value.push({role:"assistant",content:"æ­£åœ¨åˆ†æé¡µé¢æˆªå›¾ï¼Œè¯·ç¨å€™...",timestamp:new Date}),_.value=!1,E.value=!1,O()),f==="clarifying"&&l.parseResult&&(p.value.push({role:"assistant",content:"æˆ‘å·²å®Œæˆåˆæ­¥åˆ†æï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è¦ç¡®è®¤ï¼š",timestamp:new Date}),((P=l.parseResult.clarification_questions)==null?void 0:P.length)>0&&(a.value=l.parseResult.clarification_questions[0]),O())}),ae(()=>l.streamingContent,()=>{l.streamingContent&&O()});const i=()=>{s.value&&(v("config-confirmed",s.value),_.value=!0,E.value=!1,p.value.push({role:"user",content:"ç¡®è®¤åº”ç”¨æ­¤é…ç½®",timestamp:new Date}),O())},h=()=>{E.value=!1,p.value.push({role:"user",content:"éœ€è¦é‡æ–°è¯†åˆ«",timestamp:new Date}),p.value.push({role:"assistant",content:"å¥½çš„ï¼Œè¯·é‡æ–°ä¸Šä¼ å›¾ç‰‡æˆ–æè¿°æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¼šé‡æ–°åˆ†æã€‚",timestamp:new Date}),O()},x=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),H())},L=f=>{$.value=f;const o=new FileReader;return o.onload=P=>{B.value=P.target.result},o.readAsDataURL(f),!1},R=f=>{var P;const o=(P=f.target.files)==null?void 0:P[0];if(o){if(!["image/png","image/jpeg","image/jpg"].includes(o.type))return;L(o)}f.target.value=""},k=()=>{$.value=null,B.value=null},S=f=>{D.value=f},H=async()=>{var P,G;if(!M.value.trim()&&!$.value||g.value)return;const f=M.value.trim(),o=B.value;M.value="",k(),p.value.push({role:"user",content:f||"(ä¸Šä¼ äº†å›¾ç‰‡)",image:o,timestamp:new Date}),O(),g.value=!0;try{if(l.sessionId&&(l.status==="clarifying"||l.status==="completed")){let F="";const b=p.value.length;p.value.push({role:"assistant",content:"",timestamp:new Date,isStreaming:!0});const X=De.chatStream(l.sessionId,f,l.currentConfig,T=>{T.type==="content"&&(F+=T.content,p.value[b].content=F,O())},T=>{p.value[b].isStreaming=!1,p.value[b].content=F||"å¥½çš„ï¼Œæˆ‘å·²æ ¹æ®æ‚¨çš„å»ºè®®æ›´æ–°äº†é…ç½®ã€‚",T&&(s.value=T,E.value=!0,_.value=!1),g.value=!1,O()},T=>{p.value[b].isStreaming=!1,p.value[b].content=`âŒ ${T||"è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•"}`,g.value=!1,O()});window._currentChatStream=X}else p.value.push({role:"assistant",content:'è¯·å…ˆä¸Šä¼ é¡µé¢æˆªå›¾å¹¶ç‚¹å‡»"AI è¾…åŠ©å¡«å†™"ï¼Œæˆ‘ä¼šå¸®æ‚¨è¯†åˆ«é¡µé¢å…ƒç´ ã€‚',timestamp:new Date}),g.value=!1}catch(F){p.value.push({role:"assistant",content:`âŒ ${((G=(P=F.response)==null?void 0:P.data)==null?void 0:G.message)||"è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•"}`,timestamp:new Date}),g.value=!1}finally{O()}},ie=f=>{M.value=f,H()},O=()=>{ke(()=>{z.value&&(z.value.scrollTop=z.value.scrollHeight)})},re=f=>f?f.replace(/\n/g,"<br>"):"",de=f=>new Date(f).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(f,o)=>{var G,F;const P=ve("a-image");return u(),d("div",bt,[e("div",_t,[o[2]||(o[2]=te('<div class="assistant-info" data-v-0826f096><div class="avatar" data-v-0826f096><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-0826f096><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z" data-v-0826f096></path></svg></div><span class="name" data-v-0826f096>UI config å¡«å†™åŠ©æ‰‹</span></div>',1)),c.status?(u(),d("span",{key:0,class:Q(["status-badge",c.status])},[o[1]||(o[1]=e("span",{class:"status-dot"},null,-1)),y(" "+U(t.value),1)],2)):A("",!0)]),e("div",{class:"chat-container",ref_key:"chatContainer",ref:z},[p.value.length===0&&!c.status?(u(),d("div",yt,[...o[3]||(o[3]=[te('<div class="bubble" data-v-0826f096><div class="welcome-content" data-v-0826f096><div class="welcome-icon" data-v-0826f096>ğŸ‘‹</div><div class="welcome-text" data-v-0826f096><p data-v-0826f096>ä½ å¥½ï¼ä¸Šä¼ é¡µé¢æˆªå›¾å¹¶ç‚¹å‡»&quot;AI è¾…åŠ©å¡«å†™&quot;ï¼Œæˆ‘å°†å¸®åŠ©æ‚¨è‡ªåŠ¨è¯†åˆ«é¡µé¢å…ƒç´ ã€‚</p><p class="sub" data-v-0826f096>æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¸‹æ–¹è¾“å…¥æ¡†æè¿°æ‚¨æƒ³è¦é…ç½®çš„é¡µé¢åŠŸèƒ½ã€‚</p></div></div></div>',1)])])):A("",!0),(u(!0),d(Z,null,ee(p.value,(b,X)=>(u(),d("div",{key:X,class:Q(["message",b.role])},[e("div",Ct,[b.role==="assistant"?(u(),d("div",wt,[...o[4]||(o[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})],-1)])])):A("",!0),e("div",kt,[b.image?(u(),d("img",{key:0,src:b.image,class:"chat-image",onClick:T=>S(b.image)},null,8,$t)):A("",!0),e("span",{innerHTML:re(b.content)},null,8,xt),b.isStreaming?(u(),d("span",At,"â–Š")):A("",!0)])]),e("span",It,U(de(b.timestamp)),1)],2))),128)),c.status==="parsing"?(u(),d("div",Mt,[e("div",Dt,[o[7]||(o[7]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Et,[c.streamingContent?(u(),d(Z,{key:0},[e("pre",Vt,U(c.streamingContent),1),o[5]||(o[5]=e("span",{class:"streaming-cursor"},"â–Š",-1))],64)):(u(),d("div",Bt,[...o[6]||(o[6]=[e("span",{class:"parsing-icon"},"ğŸ”",-1),y(" æ­£åœ¨åˆ†æé¡µé¢æˆªå›¾ï¼Œè¯†åˆ«å¯äº¤äº’å…ƒç´ ... ",-1)])]))])])])):A("",!0),g.value?(u(),d("div",Nt,[...o[8]||(o[8]=[te('<div class="bubble-wrapper" data-v-0826f096><div class="avatar small" data-v-0826f096><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-0826f096><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z" data-v-0826f096></path></svg></div><div class="bubble loading" data-v-0826f096><span class="dot" data-v-0826f096></span><span class="dot" data-v-0826f096></span><span class="dot" data-v-0826f096></span></div></div>',1)])])):A("",!0),E.value&&s.value?(u(),d("div",Ut,[e("div",zt,[o[15]||(o[15]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Lt,[o[14]||(o[14]=e("div",{class:"preview-header"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 6L9 17l-5-5"})]),y(" è§£æå®Œæˆï¼ä»¥ä¸‹æ˜¯è¯†åˆ«åˆ°çš„é…ç½®ä¿¡æ¯ï¼š ")],-1)),e("div",Rt,[s.value.page_id?(u(),d("div",Pt,[o[9]||(o[9]=e("label",null,"é¡µé¢ IDï¼š",-1)),e("span",St,U(s.value.page_id),1)])):A("",!0),s.value.page_name?(u(),d("div",Ot,[o[10]||(o[10]=e("label",null,"é¡µé¢åç§°ï¼š",-1)),e("span",null,U(s.value.page_name["zh-CN"]||""),1)])):A("",!0),(G=s.value.button_list)!=null&&G.length?(u(),d("div",Tt,[e("label",null,"è¯†åˆ«åˆ°çš„æŒ‰é’® ("+U(s.value.button_list.length)+"ä¸ª)ï¼š",1),e("div",jt,[(u(!0),d(Z,null,ee(s.value.button_list,b=>(u(),d("span",{key:b,class:"config-tag"},U(b),1))),128))])])):A("",!0),(F=s.value.optional_actions)!=null&&F.length?(u(),d("div",Ht,[o[11]||(o[11]=e("label",null,"å¯é€‰æ“ä½œï¼š",-1)),e("div",Ft,[(u(!0),d(Z,null,ee(s.value.optional_actions,b=>(u(),d("span",{key:b,class:"config-tag accent"},U(b),1))),128))])])):A("",!0)]),e("div",{class:"preview-actions"},[e("button",{class:"action-btn secondary",onClick:h},[...o[12]||(o[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})],-1),y(" é‡æ–°è¯†åˆ« ",-1)])]),e("button",{class:"action-btn primary",onClick:i},[...o[13]||(o[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 6L9 17l-5-5"})],-1),y(" ç¡®è®¤åº”ç”¨ ",-1)])])])])])])):A("",!0),a.value&&c.status==="clarifying"?(u(),d("div",qt,[e("div",Gt,[o[16]||(o[16]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Jt,U(a.value.question_text||a.value),1)]),a.value.options?(u(),d("div",Wt,[(u(!0),d(Z,null,ee(a.value.options,b=>(u(),d("button",{key:b,class:"option-btn",onClick:X=>ie(b)},U(b),9,Kt))),128))])):A("",!0)])):A("",!0)],512),q(P,{width:200,style:{display:"none"},preview:{visible:!!D.value,onVisibleChange:b=>{b||(D.value=null)},src:D.value}},null,8,["preview"]),$.value?(u(),d("div",Zt,[e("img",{src:B.value},null,8,Qt),e("button",{class:"remove-btn",onClick:k},[...o[17]||(o[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):A("",!0),e("div",Xt,[e("div",Yt,[e("label",{class:Q(["upload-btn",{disabled:g.value}])},[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",onChange:R,disabled:g.value},null,40,es),o[18]||(o[18]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),e("polyline",{points:"17 8 12 3 7 8"}),e("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1))],2),W(e("textarea",{ref:"inputRef","onUpdate:modelValue":o[0]||(o[0]=b=>M.value=b),placeholder:"è¾“å…¥ä¿®æ”¹å»ºè®®æˆ–é—®é¢˜...",disabled:g.value,onKeydown:x,rows:"1"},null,40,ts),[[K,M.value]]),e("button",{class:"send-btn",disabled:!M.value.trim()&&!$.value||g.value,onClick:H},[...o[19]||(o[19]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"})],-1)])],8,ss)]),o[20]||(o[20]=e("div",{class:"input-hint"}," Enter å‘é€ Â· Shift+Enter æ¢è¡Œ ",-1))])])}}},ns=le(as,[["__scopeId","data-v-0826f096"]]),os={class:"page-editor"},ls={class:"editor-header"},is={class:"header-left"},rs={class:"header-title"},ds={class:"title-icon"},us={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},cs={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},vs={class:"header-actions"},ps={key:0,class:"unsaved-badge"},fs=["disabled"],gs={key:0,class:"btn-spinner dark"},ms=["disabled"],hs={key:0,class:"btn-spinner"},bs={class:"editor-body"},_s={class:"editor-grid"},ys={class:"panel panel-left"},Cs={class:"panel-card"},ws={class:"card-body"},ks=["disabled"],$s={key:0,class:"btn-spinner"},xs={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},As={class:"panel-card"},Is={class:"card-body"},Ms={class:"json-preview-container"},Ds={class:"panel panel-center"},Es={class:"panel-card config-card"},Vs={class:"card-body"},Bs={class:"panel panel-right"},Ns={class:"panel-card ai-card"},Us={class:"card-body"},zs={__name:"PageEditor",setup(c){const I=$e(),l=xe(),v=Ee(),p=ne(()=>I.name==="PageCreate"),a=m(""),M=m(""),g=m(null),z=m(""),$=m(!1),B=m(!1),D=m(!1),E=m(!1),s=m(null),_=m({}),t=m(""),i=m(!1);let h=null;const x=ne(()=>{const r=v.draftConfig,n=(r.button_list||[]).filter(w=>w&&w.trim()),C=(r.optional_actions||[]).filter(w=>w&&w.trim()),N={pages:{[r.page_id||"unnamed"]:{name:r.name,description:r.description,buttonList:n,optionalActions:C}}};return JSON.stringify(N,null,2)});oe(async()=>{if(v.resetConfig(),!p.value&&I.params.id)try{const r=await Y.get(I.params.id);v.setOriginalConfig({page_id:r.page_id,name:r.name,description:r.description,button_list:r.button_list||[],optional_actions:r.optional_actions||[]}),a.value=r.screenshot_url||""}catch(r){console.error("Failed to load page:",r),V.error("åŠ è½½é¡µé¢å¤±è´¥"),l.push("/")}});const L=r=>{a.value=r.file_url,V.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ")},R=r=>{V.error(r.message||"ä¸Šä¼ å¤±è´¥")},k=async()=>{var r,n;if(!a.value){V.warning("è¯·å…ˆä¸Šä¼ é¡µé¢æˆªå›¾");return}$.value=!0,E.value=!0,z.value="parsing",t.value="";try{const C=Y.parseStream(a.value,N=>{N.type==="content"&&(t.value+=N.content)},N=>{$.value=!1,z.value="completed",g.value=N,t.value="",V.success("AI è§£æå®Œæˆ")},N=>{$.value=!1,z.value="failed",t.value="",V.error(N||"è§£æå¤±è´¥")});window._currentParseStream=C}catch(C){$.value=!1,z.value="failed",V.error(((n=(r=C.response)==null?void 0:r.data)==null?void 0:n.message)||"è§£æå¤±è´¥")}},S=r=>{const{conflict:n}=v.tryApplyAiUpdate(r);n?(s.value=r,fe.confirm({title:"é…ç½®å†²çª",icon:q(Me),content:"AI å·²æ›´æ–°é…ç½®ï¼Œä½†æ‚¨æœ‰æœªä¿å­˜çš„ä¿®æ”¹ã€‚æ˜¯å¦åº”ç”¨ AI æ›´æ–°ï¼Ÿ",okText:"åº”ç”¨ AI æ›´æ–°",cancelText:"ä¿ç•™æˆ‘çš„ä¿®æ”¹",onOk(){v.forceApplyAiUpdate(s.value),V.success("å·²åº”ç”¨ AI æ›´æ–°")},onCancel(){v.keepUserEdit()}})):V.success("AI è§£æå®Œæˆï¼Œé…ç½®å·²å¡«å……")},H=r=>{g.value=r},ie=r=>{S(r),V.success("é…ç½®å·²åº”ç”¨åˆ°è¡¨å•")},O=()=>{$.value=!1},re=r=>{v.applyUserEdit(r)},de=()=>{fe.confirm({title:"ç¡®è®¤é‡ç½®",content:"ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿæ­¤æ“ä½œå°†æ¸…ç©ºå½“å‰æ‰€æœ‰æœªä¿å­˜çš„å†…å®¹ã€‚",onOk(){a.value="",E.value=!1,M.value="",g.value=null,z.value="",$.value=!1,v.resetConfig(),V.success("é…ç½®å·²é‡ç½®")}})},f=()=>{var C,N,w,j,J;const r={},n=v.draftConfig;return(C=n.page_id)!=null&&C.trim()?/^[a-zA-Z0-9_\.]+$/.test(n.page_id)||(r.page_id="åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹"):r.page_id="é¡µé¢ ID ä¸ºå¿…å¡«é¡¹",(w=(N=n.name)==null?void 0:N["zh-CN"])!=null&&w.trim()||(r.name_zh="ä¸­æ–‡åç§°ä¸ºå¿…å¡«é¡¹"),(J=(j=n.name)==null?void 0:j.en)!=null&&J.trim()||(r.name_en="è‹±æ–‡åç§°ä¸ºå¿…å¡«é¡¹"),r},o=async({redirect:r=!0}={})=>{var C,N;const n=f();if(Object.keys(n).length>0)return _.value=n,V.error("è¯·æ£€æŸ¥è¡¨å•é”™è¯¯"),!1;B.value=!0;try{const w=v.draftConfig,j={page_id:w.page_id,name:w.name,description:w.description,button_list:w.button_list.filter(J=>J.trim()),optional_actions:w.optional_actions.filter(J=>J.trim()),screenshot_url:a.value};return p.value?await Y.create(j):await Y.update(I.params.id,j),V.success("ä¿å­˜æˆåŠŸ"),v.isDirty=!1,p.value&&r&&l.push(`/page/${w.page_id}`),!0}catch(w){return V.error(((N=(C=w.response)==null?void 0:C.data)==null?void 0:N.message)||"ä¿å­˜å¤±è´¥"),!1}finally{B.value=!1}},P=async({redirect:r=!0}={})=>{var C,N,w;const n=(C=v.draftConfig.page_id)==null?void 0:C.trim();if(!n)return V.error("è¯·å…ˆå¡«å†™é¡µé¢ ID"),!1;if(!/^[a-zA-Z0-9_\.]+$/.test(n))return V.error("é¡µé¢ ID åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹"),!1;D.value=!0;try{const j=v.draftConfig,J={page_id:n,name:j.name,description:j.description,button_list:j.button_list,optional_actions:j.optional_actions,screenshot_url:a.value};return await Y.saveDraft(J),V.success("è‰ç¨¿å·²ä¿å­˜"),v.isDirty=!1,p.value&&r&&l.replace(`/page/${n}`),!0}catch(j){return V.error(((w=(N=j.response)==null?void 0:N.data)==null?void 0:w.message)||"ä¿å­˜è‰ç¨¿å¤±è´¥"),!1}finally{D.value=!1}},G=async()=>{await o()},F=async()=>{await P()},b=async()=>{try{await navigator.clipboard.writeText(x.value),V.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{V.error("å¤åˆ¶å¤±è´¥")}},X=()=>{const r=new Blob([x.value],{type:"application/json"}),n=URL.createObjectURL(r),C=document.createElement("a");C.href=n,C.download=`${v.draftConfig.page_id||"config"}_${Date.now()}.json`,C.click(),URL.revokeObjectURL(n)},T=()=>{const r=h;h=null,i.value=!1,r&&r()},he=()=>{v.isDirty=!1,T()},be=async()=>{await P({redirect:!1})&&T()},_e=async()=>{await o({redirect:!1})&&T()};Ae((r,n,C)=>{if(v.isDirty){h=C,i.value=!0;return}C()});const pe=r=>{v.isDirty&&(r.preventDefault(),r.returnValue="")};return oe(()=>{window.addEventListener("beforeunload",pe)}),Ie(()=>{window.removeEventListener("beforeunload",pe)}),ae(()=>I.path,()=>{}),(r,n)=>{const C=ve("a-button"),N=ve("a-modal");return u(),d("div",os,[e("header",ls,[e("div",is,[e("button",{class:"back-btn",onClick:n[0]||(n[0]=w=>r.$router.push("/"))},[...n[3]||(n[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),y(" è¿”å›åˆ—è¡¨ ",-1)])]),n[6]||(n[6]=e("div",{class:"header-divider"},null,-1)),e("div",rs,[e("span",ds,[p.value?(u(),d("svg",us,[...n[4]||(n[4]=[e("path",{d:"M12 4v16m-8-8h16"},null,-1)])])):(u(),d("svg",cs,[...n[5]||(n[5]=[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"},null,-1),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"},null,-1)])]))]),y(" "+U(p.value?"æ·»åŠ é¡µé¢é…ç½®":"ç¼–è¾‘é¡µé¢é…ç½®"),1)])]),e("div",vs,[ce(v).isDirty?(u(),d("span",ps,[...n[7]||(n[7]=[e("span",{class:"dot"},null,-1),y(" æœªä¿å­˜ ",-1)])])):A("",!0),e("button",{class:"action-btn secondary",onClick:de}," é‡ç½® "),e("button",{class:"action-btn secondary",onClick:F,disabled:B.value||D.value},[D.value?(u(),d("span",gs)):A("",!0),n[8]||(n[8]=y(" ä¿å­˜è‰ç¨¿ ",-1))],8,fs),e("button",{class:"action-btn primary",onClick:G,disabled:B.value||D.value},[B.value?(u(),d("span",hs)):A("",!0),n[9]||(n[9]=y(" ä¿å­˜é…ç½® ",-1))],8,ms)])]),e("div",bs,[e("div",_s,[e("aside",ys,[e("div",Cs,[n[11]||(n[11]=te('<div class="card-header" data-v-fdae85a1><h3 data-v-fdae85a1><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-fdae85a1><rect x="3" y="3" width="18" height="18" rx="2" data-v-fdae85a1></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-fdae85a1></circle><path d="M21 15l-5-5L5 21" data-v-fdae85a1></path></svg> é¡µé¢æˆªå›¾ </h3></div>',1)),e("div",ws,[q(Ge,{modelValue:a.value,"onUpdate:modelValue":n[1]||(n[1]=w=>a.value=w),disabled:$.value,onUploadSuccess:L,onUploadError:R},null,8,["modelValue","disabled"]),e("button",{class:"ai-parse-btn",onClick:k,disabled:!a.value||$.value},[$.value?(u(),d("span",$s)):(u(),d("svg",xs,[...n[10]||(n[10]=[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"},null,-1)])])),y(" "+U($.value?"æ­£åœ¨åˆ†æ...":"AI è¾…åŠ©å¡«å†™"),1)],8,ks)])]),e("div",As,[e("div",{class:"card-header"},[n[14]||(n[14]=e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M16 18l6-6-6-6M8 6l-6 6 6 6"})]),y(" JSON é¢„è§ˆ ")],-1)),e("div",{class:"card-actions"},[e("button",{class:"icon-btn",onClick:b,title:"å¤åˆ¶"},[...n[12]||(n[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"}),e("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})],-1)])]),e("button",{class:"icon-btn",onClick:X,title:"ä¸‹è½½"},[...n[13]||(n[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"})],-1)])])])]),e("div",Is,[e("div",Ms,[e("pre",null,[e("code",null,U(x.value),1)])])])])]),e("main",Ds,[e("div",Es,[n[15]||(n[15]=e("div",{class:"card-header"},[e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),y(" é…ç½®è¯¦æƒ… ")])],-1)),e("div",Vs,[q(ht,{config:ce(v).draftConfig,"session-id":M.value,errors:_.value,onConfigChanged:re},null,8,["config","session-id","errors"])])])]),e("aside",Bs,[e("div",Ns,[n[16]||(n[16]=e("div",{class:"card-header"},[e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})]),y(" UI config å¡«å†™åŠ©æ‰‹ ")])],-1)),e("div",Us,[q(ns,{"session-id":M.value,"parse-result":g.value,status:z.value,"current-config":ce(v).draftConfig,"image-url":a.value,"streaming-content":t.value,onConfigUpdated:H,onConfigConfirmed:ie,onCompleted:O},null,8,["session-id","parse-result","status","current-config","image-url","streaming-content"])])])])])]),q(N,{open:i.value,"onUpdate:open":n[2]||(n[2]=w=>i.value=w),title:"æœªä¿å­˜çš„æ›´æ”¹",maskClosable:!1,closable:!1},{footer:se(()=>[q(C,{disabled:B.value||D.value,onClick:he},{default:se(()=>[...n[17]||(n[17]=[y("ç›´æ¥é€€å‡º",-1)])]),_:1},8,["disabled"]),q(C,{loading:D.value,onClick:be},{default:se(()=>[...n[18]||(n[18]=[y("ä¿æŒè‰ç¨¿",-1)])]),_:1},8,["loading"]),q(C,{type:"primary",loading:B.value,onClick:_e},{default:se(()=>[...n[19]||(n[19]=[y("ä¿å­˜é…ç½®",-1)])]),_:1},8,["loading"])]),default:se(()=>[n[20]||(n[20]=e("p",null,"å½“å‰å†…å®¹æœªä¿å­˜ï¼Œæ‚¨è¦ç›´æ¥é€€å‡ºã€ä¿æŒè‰ç¨¿è¿˜æ˜¯ä¿å­˜é…ç½®ï¼Ÿ",-1))]),_:1},8,["open"])])}}},Ps=le(zs,[["__scopeId","data-v-fdae85a1"]]);export{Ps as default};
