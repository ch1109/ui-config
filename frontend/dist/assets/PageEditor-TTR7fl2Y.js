import{q as Re,d as ue,r as g,l as Ae,s as He,c as f,o as d,a as e,b as R,F as pe,j as xe,e as x,t as z,m as me,n as he,g as O,p as Oe,h as de,x as _e,y as Ue,k as j,w as oe,v as le,z as De,A as We,f as ke,i as L,B as Fe,C as qe,u as Je,D as Ge,G as Ze,H as Ne,M as Ie,E as Ke}from"./index-BFmn7c9g.js";import{p as fe,b as $e,c as Qe}from"./index-63V-2pEO.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Ve(u,H){if(!H)return u;let _=u||"";const{behavior_rules:o,page_goal:c}=H;return o&&!_.includes("## è¡Œä¸ºè§„åˆ™")&&(_+=`

## è¡Œä¸ºè§„åˆ™
${o}`),c&&!_.includes("## é¡µé¢ç›®æ ‡")&&(_+=`

## é¡µé¢ç›®æ ‡
${c}`),_.trim()}function je(u,H){if(!H)return u;let _=u||"";const{behavior_rules:o,page_goal:c}=H;return o&&!_.includes("## Behavior Rules")&&(_+=`

## Behavior Rules
${o}`),c&&!_.includes("## Page Goal")&&(_+=`

## Page Goal
${c}`),_.trim()}const Xe=Re("uiConfig",()=>{const u=g({page_id:"",name:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},description:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},button_list:[],optional_actions:[]}),H=g(null),_=g(!1),o=g(null),c=g(null),$=ue(()=>_.value);function B(l){Object.assign(u.value,l),_.value=!0}function k(l){return _.value?{conflict:!0}:(C(l),{conflict:!1})}function E(l){C(l),_.value=!1}function C(l){if(l.page_id&&(u.value.page_id=l.page_id),l.page_name&&(u.value.name={"zh-CN":l.page_name["zh-CN"]||"",en:l.page_name.en||"",ja:l.page_name.ja||"",ms:l.page_name.ms||"","zh-TW":l.page_name["zh-TW"]||""}),l.page_description){let A=l.page_description["zh-CN"]||"",T=l.page_description.en||"";l.ai_context&&(A=Ve(A,l.ai_context),T=je(T,l.ai_context)),u.value.description={"zh-CN":A,en:T,ja:l.page_description.ja||"",ms:l.page_description.ms||"","zh-TW":l.page_description["zh-TW"]||""}}l.button_list&&(u.value.button_list=l.button_list),l.optional_actions&&(u.value.optional_actions=l.optional_actions)}function Z(){}function S(){u.value={page_id:"",name:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},description:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},button_list:[],optional_actions:[]},H.value=null,_.value=!1,o.value=null}function r(l){var T,N,p,w,P,J,G,U,I,te;const A={...l};A.name={"zh-CN":((T=l.name)==null?void 0:T["zh-CN"])||"",en:((N=l.name)==null?void 0:N.en)||"",ja:((p=l.name)==null?void 0:p.ja)||"",ms:((w=l.name)==null?void 0:w.ms)||"","zh-TW":((P=l.name)==null?void 0:P["zh-TW"])||""},A.description={"zh-CN":((J=l.description)==null?void 0:J["zh-CN"])||"",en:((G=l.description)==null?void 0:G.en)||"",ja:((U=l.description)==null?void 0:U.ja)||"",ms:((I=l.description)==null?void 0:I.ms)||"","zh-TW":((te=l.description)==null?void 0:te["zh-TW"])||""},l.ai_context&&(A.description["zh-CN"]=Ve(A.description["zh-CN"],l.ai_context),A.description.en=je(A.description.en,l.ai_context)),delete A.ai_context,H.value=JSON.parse(JSON.stringify(A)),u.value=JSON.parse(JSON.stringify(A)),_.value=!1}function b(l){o.value=l}function q(l,A="success",T=3e3){c.value={message:l,type:A},setTimeout(()=>{c.value=null},T)}return{draftConfig:u,originalConfig:H,isDirty:_,currentSession:o,toast:c,hasChanges:$,applyUserEdit:B,tryApplyAiUpdate:k,forceApplyAiUpdate:E,keepUserEdit:Z,resetConfig:S,setOriginalConfig:r,setCurrentSession:b,showToast:q}}),Ye=["src"],et={class:"overlay"},tt={class:"btn-action"},at=["disabled"],st={key:1,class:"upload-progress"},nt={class:"progress-ring"},ot={viewBox:"0 0 100 100"},lt=["stroke-dasharray"],it={class:"percent"},rt={key:2,class:"upload-placeholder-wrapper"},dt={class:"upload-placeholder"},ut=["disabled"],ct=["src"],vt={__name:"ImageUploader",props:{modelValue:String,disabled:Boolean},emits:["update:modelValue","upload-success","upload-error"],setup(u,{emit:H}){const _=u,o=H,c=g(!1),$=g(!1),B=g(0),k=g(!1),E=g({width:0,height:0}),C=ue(()=>E.value.width||520),Z=()=>{_.disabled||(c.value=!0)},S=()=>{c.value=!1},r=N=>{if(c.value=!1,_.disabled||$.value)return;const p=N.dataTransfer.files;p.length>0&&q(p[0])},b=async N=>{const p=N.target,w=p.files;try{w&&w.length>0&&await q(w[0])}finally{p.value=""}},q=async N=>{var P,J,G;if(!N)return;if(!["image/png","image/jpeg","image/jpg"].includes(N.type)){o("upload-error",{code:"INVALID_FILE_TYPE",message:"ä»…æ”¯æŒ PNGã€JPG æ ¼å¼çš„å›¾ç‰‡"});return}const w=10*1024*1024;if(N.size>w){o("upload-error",{code:"FILE_TOO_LARGE",message:"å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MB"});return}$.value=!0,B.value=0;try{const U=await fe.uploadImage(N,I=>{B.value=I});o("update:modelValue",U.file_url),o("upload-success",U)}catch(U){console.error("Upload error:",U);let I="ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",te="UPLOAD_FAILED";U.code==="UPLOAD_FAILED"||U.name==="NotReadableError"?(I=U.message,te="FILE_READ_ERROR"):(P=U.message)!=null&&P.includes("Network Error")||U.code==="ERR_NETWORK"?(I="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ",te="NETWORK_ERROR"):(G=(J=U.response)==null?void 0:J.data)!=null&&G.message?(I=U.response.data.message,te=U.response.data.error||"SERVER_ERROR"):U.message&&(I=U.message),o("upload-error",{code:te,message:I})}finally{$.value=!1}},l=()=>{o("update:modelValue",null)},A=()=>{if(_.disabled||$.value||!_.modelValue)return;const N=new Image;N.onload=()=>{const p=N.naturalWidth||N.width,w=N.naturalHeight||N.height,P=Math.floor(window.innerWidth*.9),J=Math.floor(window.innerHeight*.9),G=Math.min(1,P/p,J/w);E.value={width:Math.max(1,Math.floor(p*G)),height:Math.max(1,Math.floor(w*G))},k.value=!0},N.onerror=()=>{E.value={width:520,height:390},k.value=!0},N.src=_.modelValue},T=async N=>{var P;const p=document.activeElement;if(p&&(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable)||_.disabled||$.value)return;const w=(P=N.clipboardData)==null?void 0:P.items;if(!(!w||w.length===0))for(let J=0;J<w.length;J++){const G=w[J];if(G.type.startsWith("image/")){N.preventDefault();const U=G.getAsFile();if(U){await q(U);return}}}};return Ae(()=>{document.addEventListener("paste",T)}),He(()=>{document.removeEventListener("paste",T)}),(N,p)=>{const w=de("a-modal");return d(),f(pe,null,[e("div",{class:he(["image-uploader",{"is-dragover":c.value,"has-image":u.modelValue,"is-disabled":u.disabled||$.value}]),onDragover:xe(Z,["prevent"]),onDragleave:S,onDrop:xe(r,["prevent"])},[u.modelValue?(d(),f(pe,{key:0},[e("img",{src:u.modelValue,alt:"é¡µé¢æˆªå›¾",class:"preview-image",onClick:A},null,8,Ye),e("div",et,[e("button",{class:"btn-action",type:"button",onClick:xe(A,["stop"])},[...p[1]||(p[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M2 12s3.5-6 10-6 10 6 10 6-3.5 6-10 6-10-6-10-6z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),x(" æŸ¥çœ‹å¤§å›¾ ",-1)])]),e("label",tt,[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",disabled:u.disabled||$.value,onChange:b,class:"hidden-input"},null,40,at),p[2]||(p[2]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})],-1)),p[3]||(p[3]=x(" æ›´æ¢ ",-1))]),e("button",{class:"btn-action danger",type:"button",onClick:xe(l,["stop"])},[...p[4]||(p[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1),x(" ç§»é™¤ ",-1)])])])],64)):$.value?(d(),f("div",st,[e("div",nt,[(d(),f("svg",ot,[p[5]||(p[5]=e("circle",{class:"bg",cx:"50",cy:"50",r:"45"},null,-1)),e("circle",{class:"progress",cx:"50",cy:"50",r:"45","stroke-dasharray":`${B.value*283} 283`},null,8,lt)])),e("span",it,z(Math.round(B.value*100))+"%",1)]),p[6]||(p[6]=e("p",null,"ä¸Šä¼ ä¸­...",-1))])):(d(),f("div",rt,[e("label",dt,[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",disabled:u.disabled||$.value,onChange:b,class:"hidden-input"},null,40,ut),p[7]||(p[7]=me('<div class="upload-icon" data-v-524d4854><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-524d4854><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-524d4854></path></svg></div><p class="upload-text" data-v-524d4854>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p><p class="upload-hint" data-v-524d4854>æˆ–ç‚¹å‡»ä¸Šä¼ </p><p class="upload-formats" data-v-524d4854>æ”¯æŒ PNG, JPG (æœ€å¤§ 10MB)</p>',4))]),p[8]||(p[8]=e("div",{class:"paste-hint"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),e("span",null,[x("ä¹Ÿå¯æŒ‰ "),e("kbd",null,"Ctrl"),x("+"),e("kbd",null,"V"),x(" ç²˜è´´å›¾ç‰‡")])],-1))]))],34),R(w,{open:k.value,"onUpdate:open":p[0]||(p[0]=P=>k.value=P),title:null,footer:null,maskClosable:!0,width:C.value,centered:"",bodyStyle:{padding:"0"}},{default:O(()=>[e("img",{src:u.modelValue,alt:"é¡µé¢æˆªå›¾",class:"preview-modal-image",style:Oe({width:E.value.width?E.value.width+"px":"auto",height:E.value.height?E.value.height+"px":"auto"})},null,12,ct)]),_:1},8,["open","width"])],64)}}},pt=Me(vt,[["__scopeId","data-v-524d4854"]]),gt={class:"config-editor"},ft={class:"section"},mt={class:"form-grid"},ht={class:"form-field full-width"},_t={class:"form-field full-width"},bt={class:"language-select-wrapper"},yt={class:"language-dropdown"},Ct={key:0,class:"form-field full-width"},wt={class:"form-field full-width"},kt=["placeholder"],zt={key:0,class:"field-hint error"},xt={key:1,class:"field-hint error"},$t={class:"form-field full-width"},Mt={class:"label-hint"},Nt=["placeholder"],At={class:"field-help"},Bt={key:0,class:"help-content"},Dt={class:"section"},Lt={class:"section-header"},Ut={class:"form-field"},It={class:"option-item"},Vt={class:"option-content"},jt={class:"option-label"},Et={class:"option-id"},St=["onClick"],Tt={key:0,class:"field-hint error"},Pt={class:"form-field"},Rt={class:"option-item"},Ht={class:"option-label"},Ot={class:"add-button-form"},Wt={class:"modal-form-field"},Ft={class:"input-with-action"},qt={class:"modal-form-field"},Jt={class:"modal-form-field"},Gt={class:"modal-form-field"},Zt=["placeholder"],Kt={class:"modal-form-field"},Qt=["placeholder"],Xt={class:"modal-form-field"},Yt=["placeholder"],ea={class:"modal-form-field"},ta={class:"modal-actions"},aa=["disabled"],sa={__name:"ConfigEditor",props:{config:{type:Object,required:!0},sessionId:String,errors:{type:Object,default:()=>({})}},emits:["config-changed"],setup(u,{expose:H,emit:_}){const o=u,c=_,$=g(!1),B=g(!1),k=g("zh-CN"),E=g(!1),C=Ue({button_id:"",category:"operation",name:{"zh-CN":"",en:""},description:{"zh-CN":"",en:""},response_info:{"zh-CN":"",en:""},voice_keywords_text:""}),Z=[{value:"operation",label:"æ“ä½œæŒ‰é’®"},{value:"function",label:"åŠŸèƒ½æŒ‰é’®"},{value:"navigation",label:"å¯¼èˆªæŒ‰é’®"},{value:"input_trigger",label:"è¾“å…¥è§¦å‘æŒ‰é’®"},{value:"selection",label:"é€‰æ‹©æŒ‰é’®"}],S=ue(()=>C.button_id.trim()!==""&&C.name["zh-CN"].trim()!==""),r=()=>{if(C.name["zh-CN"]){const t=C.name.en;t?C.button_id=t.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,""):C.button_id=`btn_${Date.now().toString(36)}`}else C.button_id=`btn_${Date.now().toString(36)}`},b=()=>{C.button_id="",C.category="operation",C.name={"zh-CN":"",en:""},C.description={"zh-CN":"",en:""},C.response_info={"zh-CN":"",en:""},C.voice_keywords_text="",k.value="zh-CN"},q=async()=>{var i,t;if(S.value){E.value=!0;try{const v=C.voice_keywords_text.split(`
`).map(K=>K.trim()).filter(K=>K!=="");await $e.create({button_id:C.button_id,name:C.name,description:C.description,response_info:C.response_info,voice_keywords:v,category:C.category}),L.success("æŒ‰é’®åˆ›å»ºæˆåŠŸ"),B.value=!1,b(),await T()}catch(v){const K=((t=(i=v.response)==null?void 0:i.data)==null?void 0:t.detail)||v.message||"åˆ›å»ºå¤±è´¥";L.error(K)}finally{E.value=!1}}},l=g([]),A=g(!1),T=async()=>{A.value=!0;try{const i=await $e.list();l.value=i.options||[]}catch(i){console.error("åŠ è½½æŒ‰é’®åˆ—è¡¨å¤±è´¥:",i),l.value=[]}finally{A.value=!1}},N=async(i,t)=>{var K,se,ne;if(window.confirm(`ç¡®å®šè¦ä»ç³»ç»Ÿä¸­åˆ é™¤æŒ‰é’®ã€Œ${t}ã€å—ï¼Ÿ

æ³¨æ„ï¼šåˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œä¸”æ‰€æœ‰ä½¿ç”¨æ­¤æŒ‰é’®çš„é¡µé¢é…ç½®éœ€è¦é‡æ–°é€‰æ‹©ã€‚`))try{await $e.delete(i),L.success(`æŒ‰é’®ã€Œ${t}ã€å·²åˆ é™¤`),(K=V.button_list)!=null&&K.includes(i)&&(V.button_list=V.button_list.filter(ae=>ae!==i)),await T()}catch(ae){const ve=((ne=(se=ae.response)==null?void 0:se.data)==null?void 0:ne.detail)||ae.message||"åˆ é™¤å¤±è´¥";L.error(ve)}},p=g(["zh-CN","en"]),w=g("zh-CN"),P=[{value:"zh-CN",label:"ç®€ä½“ä¸­æ–‡"},{value:"en",label:"English"},{value:"ja",label:"æ—¥æœ¬èª"},{value:"ms",label:"Bahasa Melayu"},{value:"zh-TW",label:"ç¹é«”ä¸­æ–‡"}],J=ue(()=>p.value.length===P.length),G=i=>{p.value=i,i.length>0&&!i.includes(w.value)&&(w.value=i[0])},U=()=>{J.value?(p.value=["zh-CN"],w.value="zh-CN"):p.value=P.map(i=>i.value)},I=ue(()=>{const i={"zh-CN":{nameLabel:"é¡µé¢åç§°ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰",namePlaceholder:"ä¾‹å¦‚: é¦–é¡µã€ç”¨æˆ·ä¸­å¿ƒ",descLabel:"é¡µé¢æè¿°ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰",descHint:"åŒ…å«åŠŸèƒ½è¯´æ˜ã€è¡Œä¸ºè§„åˆ™å’Œé¡µé¢ç›®æ ‡",descPlaceholder:"æè¿°æ­¤é¡µé¢çš„åŠŸèƒ½å’Œç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œ..."},en:{nameLabel:"Page Name (English)",namePlaceholder:"e.g. Home Page, User Profile",descLabel:"Page Description (English)",descHint:"Include features, behavior rules and goals",descPlaceholder:"Describe the page features and available user actions..."},ja:{nameLabel:"ãƒšãƒ¼ã‚¸åï¼ˆæ—¥æœ¬èªï¼‰",namePlaceholder:"ä¾‹: ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒ³ã‚¿ãƒ¼",descLabel:"ãƒšãƒ¼ã‚¸ã®èª¬æ˜ï¼ˆæ—¥æœ¬èªï¼‰",descHint:"æ©Ÿèƒ½èª¬æ˜ã€è¡Œå‹•è¦å‰‡ã€ç›®æ¨™ã‚’å«ã‚€",descPlaceholder:"ã“ã®ãƒšãƒ¼ã‚¸ã®æ©Ÿèƒ½ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè¡Œã§ãã‚‹æ“ä½œã‚’èª¬æ˜ã—ã¦ãã ã•ã„..."},ms:{nameLabel:"Nama Halaman (Bahasa Melayu)",namePlaceholder:"cth: Halaman Utama, Pusat Pengguna",descLabel:"Penerangan Halaman (Bahasa Melayu)",descHint:"Termasuk ciri, peraturan dan matlamat",descPlaceholder:"Terangkan ciri halaman dan tindakan pengguna yang tersedia..."},"zh-TW":{nameLabel:"é é¢åç¨±ï¼ˆç¹é«”ä¸­æ–‡ï¼‰",namePlaceholder:"ä¾‹å¦‚: é¦–é ã€ç”¨æˆ¶ä¸­å¿ƒ",descLabel:"é é¢æè¿°ï¼ˆç¹é«”ä¸­æ–‡ï¼‰",descHint:"åŒ…å«åŠŸèƒ½èªªæ˜ã€è¡Œç‚ºè¦å‰‡å’Œé é¢ç›®æ¨™",descPlaceholder:"æè¿°æ­¤é é¢çš„åŠŸèƒ½å’Œç”¨æˆ¶å¯åŸ·è¡Œçš„æ“ä½œ..."}};return i[w.value]||i["zh-CN"]}),te=ue(()=>w.value==="en"?`Page feature overview...

Actions available to users:
- Action 1
- Action 2

## Behavior Rules
Constraints the AI should follow on this page...

## Page Goal
The main goal for users on this page...`:`é¡µé¢åŠŸèƒ½æ¦‚è¿°...

ç”¨æˆ·å¯æ‰§è¡Œçš„æ“ä½œï¼š
- æ“ä½œ1
- æ“ä½œ2

## è¡Œä¸ºè§„åˆ™
AI åœ¨æ­¤é¡µé¢åº”éµå¾ªçš„çº¦æŸ...

## é¡µé¢ç›®æ ‡
ç”¨æˆ·åœ¨æ­¤é¡µé¢çš„ä¸»è¦ç›®æ ‡...`),ce=[{value:"knowledge",label:"çŸ¥è¯†é—®ç­” (knowledge)"},{value:"chat",label:"é—²èŠæ¨¡å¼ (chat)"},{value:"comprehension",label:"é˜…è¯»ç†è§£ (comprehension)"},{value:"Dir-read-agreement",label:"æœ—è¯»åè®® (Dir-read-agreement)"},{value:"UpdateFormLossReason",label:"æ›´æ–°æŒ‚å¤±åŸå›  (UpdateFormLossReason)"},{value:"UpdateFormCancelAccount",label:"æ›´æ–°è½¬è´¦è¡¨å• (UpdateFormCancelAccount)"}],ze=ce.reduce((i,t)=>(i[t.value]=t.label.split(" (")[0],i),{}),be=i=>{const t=l.value.find(v=>v.value===i);return t?t.label.split(" (")[0]:i},Q=i=>ze[i]||i,V=Ue({page_id:"",name:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},description:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},button_list:[],optional_actions:[]});Ae(async()=>{ye(),await T()}),_e(()=>o.config,()=>{ye()},{deep:!0});const ye=()=>{var i,t,v,K,se,ne,ae,ve,Ce,m;if(o.config){V.page_id=o.config.page_id||"",V.name={"zh-CN":((i=o.config.name)==null?void 0:i["zh-CN"])||"",en:((t=o.config.name)==null?void 0:t.en)||"",ja:((v=o.config.name)==null?void 0:v.ja)||"",ms:((K=o.config.name)==null?void 0:K.ms)||"","zh-TW":((se=o.config.name)==null?void 0:se["zh-TW"])||""};let ee=((ne=o.config.description)==null?void 0:ne["zh-CN"])||"",ie=((ae=o.config.description)==null?void 0:ae.en)||"";if(o.config.ai_context){const{behavior_rules:re,page_goal:we}=o.config.ai_context;re&&!ee.includes("## è¡Œä¸ºè§„åˆ™")&&(ee+=`

## è¡Œä¸ºè§„åˆ™
${re}`),we&&!ee.includes("## é¡µé¢ç›®æ ‡")&&(ee+=`

## é¡µé¢ç›®æ ‡
${we}`),re&&!ie.includes("## Behavior Rules")&&(ie+=`

## Behavior Rules
${re}`),we&&!ie.includes("## Page Goal")&&(ie+=`

## Page Goal
${we}`)}V.description={"zh-CN":ee.trim(),en:ie.trim(),ja:((ve=o.config.description)==null?void 0:ve.ja)||"",ms:((Ce=o.config.description)==null?void 0:Ce.ms)||"","zh-TW":((m=o.config.description)==null?void 0:m["zh-TW"])||""},V.button_list=(o.config.button_list||[]).filter(re=>re&&re.trim()),V.optional_actions=(o.config.optional_actions||[]).filter(re=>re&&re.trim())}},h=i=>{const t=P.find(v=>v.value===i);return t?t.label:i},n=()=>{c("config-changed",{page_id:V.page_id,name:{...V.name},description:{...V.description},button_list:[...V.button_list],optional_actions:[...V.optional_actions]})},F=i=>{V.button_list=i,n()},Y=i=>{V.optional_actions=i,n()},X=()=>{L.info("ç¿»è¯‘åŠŸèƒ½å¼€å‘ä¸­...")};return H({loadButtonOptions:T}),(i,t)=>{const v=de("a-checkbox"),K=de("a-divider"),se=de("a-select"),ne=de("a-radio-button"),ae=de("a-radio-group"),ve=de("a-tag"),Ce=de("a-modal");return d(),f("div",gt,[e("section",ft,[t[26]||(t[26]=e("div",{class:"section-header"},[e("div",{class:"section-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("h3",null,"åŸºæœ¬ä¿¡æ¯")],-1)),e("div",mt,[e("div",ht,[t[18]||(t[18]=e("label",null,[x(" é¡µé¢ ID (è‹±æ–‡æ ‡è¯†) "),e("span",{class:"required"},"*")],-1)),oe(e("input",{"onUpdate:modelValue":t[0]||(t[0]=m=>V.page_id=m),type:"text",class:he(["form-input",{error:u.errors.page_id}]),placeholder:"ä¾‹å¦‚: 1.0home_page, 4.1face_authorization_page",onInput:n},null,34),[[le,V.page_id]]),e("span",{class:he(["field-hint",{error:u.errors.page_id}])},z(u.errors.page_id||"æ ¼å¼: {é¡µé¢ç¼–å·}{è‹±æ–‡åç§°}ï¼Œå¦‚ 4.1face_authorization_pageï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”"),3)]),e("div",_t,[t[20]||(t[20]=e("label",null,[x(" è¯­è¨€ / Language "),e("span",{class:"required"},"*")],-1)),e("div",bt,[R(se,{value:p.value,"onUpdate:value":t[1]||(t[1]=m=>p.value=m),mode:"multiple",class:"language-select",options:P,placeholder:"é€‰æ‹©æ”¯æŒçš„è¯­è¨€...",onChange:G},{dropdownRender:O(({menuNode:m})=>[e("div",yt,[e("div",{class:"select-all-option",onClick:U},[R(v,{checked:J.value},null,8,["checked"]),t[19]||(t[19]=e("span",null,"å…¨é€‰",-1))]),R(K,{style:{margin:"4px 0"}}),(d(),De(We(m)))])]),_:1},8,["value"])])]),p.value.length>1?(d(),f("div",Ct,[t[21]||(t[21]=e("label",null,"å½“å‰ç¼–è¾‘è¯­è¨€",-1)),R(ae,{value:w.value,"onUpdate:value":t[2]||(t[2]=m=>w.value=m),"button-style":"solid",class:"language-tabs"},{default:O(()=>[(d(!0),f(pe,null,ke(p.value,m=>(d(),De(ne,{key:m,value:m},{default:O(()=>[x(z(h(m)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):j("",!0),e("div",wt,[e("label",null,[x(z(I.value.nameLabel)+" ",1),t[22]||(t[22]=e("span",{class:"required"},"*",-1))]),oe(e("input",{"onUpdate:modelValue":t[3]||(t[3]=m=>V.name[w.value]=m),type:"text",class:he(["form-input",{error:w.value==="zh-CN"?u.errors.name_zh:u.errors.name_en}]),placeholder:I.value.namePlaceholder,onInput:n},null,42,kt),[[le,V.name[w.value]]]),w.value==="zh-CN"&&u.errors.name_zh?(d(),f("span",zt,z(u.errors.name_zh),1)):j("",!0),w.value==="en"&&u.errors.name_en?(d(),f("span",xt,z(u.errors.name_en),1)):j("",!0)]),e("div",$t,[e("label",null,[x(z(I.value.descLabel)+" ",1),e("span",Mt,z(I.value.descHint),1)]),oe(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=m=>V.description[w.value]=m),class:"form-textarea description-textarea",rows:"8",placeholder:I.value.descPlaceholder,onInput:n},null,40,Nt),[[le,V.description[w.value]]]),e("div",At,[e("button",{type:"button",class:"help-toggle",onClick:t[5]||(t[5]=m=>$.value=!$.value)},[t[23]||(t[23]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)),x(" "+z($.value?"æ”¶èµ·æ ¼å¼è¯´æ˜":"æŸ¥çœ‹æ ¼å¼è¯´æ˜"),1)]),$.value?(d(),f("div",Bt,[t[24]||(t[24]=e("p",null,[e("strong",null,"æ¨èæ ¼å¼ï¼š")],-1)),e("pre",null,z(te.value),1)])):j("",!0)])]),e("div",{class:"form-field full-width"},[e("button",{type:"button",class:"translate-btn",onClick:X},[...t[25]||(t[25]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})],-1),x(" ä¸€é”®ç¿»è¯‘ ",-1)])])])])]),e("section",Dt,[e("div",Lt,[t[28]||(t[28]=me('<div class="section-icon accent" data-v-e197141c><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e197141c><rect x="3" y="3" width="7" height="7" data-v-e197141c></rect><rect x="14" y="3" width="7" height="7" data-v-e197141c></rect><rect x="14" y="14" width="7" height="7" data-v-e197141c></rect><rect x="3" y="14" width="7" height="7" data-v-e197141c></rect></svg></div><h3 data-v-e197141c>é¡µé¢èƒ½åŠ›</h3>',2)),e("button",{class:"add-button-btn",onClick:t[6]||(t[6]=m=>B.value=!0)},[...t[27]||(t[27]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),x(" æ–°å¢æŒ‰é’® ",-1)])])]),e("div",Ut,[t[30]||(t[30]=e("label",null,"å¯ç‚¹å‡»æŒ‰é’®",-1)),R(se,{value:V.button_list,"onUpdate:value":t[7]||(t[7]=m=>V.button_list=m),mode:"multiple",class:"button-select",placeholder:"é€‰æ‹©æŒ‰é’®...",options:l.value,"option-filter-prop":"label","show-search":"","allow-clear":"",onChange:F},{option:O(({value:m,label:ee})=>[e("span",It,[e("span",Vt,[e("span",jt,z(ee),1),e("span",Et,z(m),1)]),e("span",{class:"option-delete-btn",onClick:xe(ie=>N(m,ee),["stop"]),title:"ä»ç³»ç»Ÿä¸­åˆ é™¤æ­¤æŒ‰é’®"},[...t[29]||(t[29]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,St)])]),tagRender:O(({value:m,closable:ee,onClose:ie})=>[R(ve,{closable:ee,class:"button-tag",onClose:ie},{default:O(()=>[x(z(be(m)),1)]),_:2},1032,["closable","onClose"])]),_:1},8,["value","options"]),u.errors.button_list?(d(),f("span",Tt,z(u.errors.button_list),1)):j("",!0)]),e("div",Pt,[t[31]||(t[31]=e("label",null,"å¯é€‰æ„å›¾",-1)),R(se,{value:V.optional_actions,"onUpdate:value":t[8]||(t[8]=m=>V.optional_actions=m),mode:"multiple",class:"intent-select",placeholder:"æœç´¢æ„å›¾åç§°...",options:ce,"option-filter-prop":"label","show-search":"","allow-clear":"",onChange:Y},{option:O(({value:m,label:ee})=>[e("span",Rt,[e("span",Ht,z(ee),1)])]),tagRender:O(({value:m,closable:ee,onClose:ie})=>[R(ve,{closable:ee,class:"intent-tag",onClose:ie},{default:O(()=>[x(z(Q(m)),1)]),_:2},1032,["closable","onClose"])]),_:1},8,["value"])])]),R(Ce,{open:B.value,"onUpdate:open":t[17]||(t[17]=m=>B.value=m),title:"æ–°å¢æŒ‰é’®",width:600,footer:null,class:"add-button-modal",onCancel:b},{default:O(()=>[e("div",Ot,[e("div",Wt,[t[32]||(t[32]=e("label",null,[x(" æŒ‰é’® IDï¼ˆè‹±æ–‡æ ‡è¯†ï¼‰ "),e("span",{class:"required"},"*")],-1)),e("div",Ft,[oe(e("input",{"onUpdate:modelValue":t[9]||(t[9]=m=>C.button_id=m),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚: submit_form, cancel_order"},null,512),[[le,C.button_id]]),e("button",{type:"button",class:"generate-btn",onClick:r}," ç”Ÿæˆ ")]),t[33]||(t[33]=e("span",{class:"field-hint"},"åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œä½¿ç”¨ snake_case æ ¼å¼",-1))]),e("div",qt,[t[34]||(t[34]=e("label",null,"æŒ‰é’®åˆ†ç±»",-1)),R(se,{value:C.category,"onUpdate:value":t[10]||(t[10]=m=>C.category=m),class:"form-select",options:Z},null,8,["value"])]),e("div",Jt,[t[37]||(t[37]=e("label",null,"ç¼–è¾‘è¯­è¨€",-1)),R(ae,{value:k.value,"onUpdate:value":t[11]||(t[11]=m=>k.value=m),"button-style":"solid",class:"language-tabs"},{default:O(()=>[R(ne,{value:"zh-CN"},{default:O(()=>[...t[35]||(t[35]=[x("ç®€ä½“ä¸­æ–‡",-1)])]),_:1}),R(ne,{value:"en"},{default:O(()=>[...t[36]||(t[36]=[x("English",-1)])]),_:1})]),_:1},8,["value"])]),e("div",Gt,[e("label",null,[x(z(k.value==="zh-CN"?"æŒ‰é’®åç§°ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰":"Button Name (English)")+" ",1),t[38]||(t[38]=e("span",{class:"required"},"*",-1))]),oe(e("input",{"onUpdate:modelValue":t[12]||(t[12]=m=>C.name[k.value]=m),type:"text",class:"form-input",placeholder:k.value==="zh-CN"?"ä¾‹å¦‚: æäº¤è¡¨å•":"e.g. Submit Form"},null,8,Zt),[[le,C.name[k.value]]])]),e("div",Kt,[e("label",null,z(k.value==="zh-CN"?"æŒ‰é’®æè¿°":"Description"),1),oe(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=m=>C.description[k.value]=m),class:"form-textarea",rows:"2",placeholder:k.value==="zh-CN"?"æè¿°æŒ‰é’®çš„åŠŸèƒ½...":"Describe the button function..."},null,8,Qt),[[le,C.description[k.value]]])]),e("div",Xt,[e("label",null,z(k.value==="zh-CN"?"å“åº”ä¿¡æ¯":"Response Info"),1),oe(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=m=>C.response_info[k.value]=m),class:"form-textarea",rows:"2",placeholder:k.value==="zh-CN"?"ç‚¹å‡»æŒ‰é’®åçš„æç¤ºä¿¡æ¯...":"Message shown after clicking..."},null,8,Yt),[[le,C.response_info[k.value]]])]),e("div",ea,[t[39]||(t[39]=e("label",null,"è¯­éŸ³å…³é”®è¯",-1)),oe(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=m=>C.voice_keywords_text=m),class:"form-textarea",rows:"2",placeholder:`æ¯è¡Œä¸€ä¸ªå…³é”®è¯ï¼Œä¾‹å¦‚:
æäº¤
ç¡®å®š
submit`},null,512),[[le,C.voice_keywords_text]]),t[40]||(t[40]=e("span",{class:"field-hint"},"ç”¨äºè¯­éŸ³è¯†åˆ«ï¼Œæ¯è¡Œä¸€ä¸ªå…³é”®è¯",-1))]),e("div",ta,[e("button",{type:"button",class:"btn-secondary",onClick:t[16]||(t[16]=m=>B.value=!1)}," å–æ¶ˆ "),e("button",{type:"button",class:"btn-primary",disabled:!S.value||E.value,onClick:q},z(E.value?"ä¿å­˜ä¸­...":"ä¿å­˜æŒ‰é’®"),9,aa)])])]),_:1},8,["open"])])}}},na=Me(sa,[["__scopeId","data-v-e197141c"]]),oa={class:"clarify-panel"},la={class:"panel-header"},ia={key:0,class:"message assistant"},ra={class:"bubble-wrapper"},da={key:0,class:"avatar small"},ua={class:"bubble"},ca=["src","onClick"],va=["innerHTML"],pa={key:1,class:"streaming-cursor"},ga={class:"timestamp"},fa={key:1,class:"message assistant"},ma={class:"bubble-wrapper"},ha={class:"bubble"},_a={class:"streaming-output"},ba={key:1,class:"parsing-message"},ya={key:2,class:"message assistant"},Ca={class:"bubble-wrapper"},wa={class:"bubble summary-bubble"},ka={class:"summary-content"},za={key:3,class:"message assistant"},xa={key:4,class:"message assistant"},$a={class:"bubble-wrapper"},Ma={class:"bubble config-preview"},Na={class:"config-summary"},Aa={key:0,class:"config-item"},Ba={class:"page-id-value"},Da={key:1,class:"config-item"},La={key:2,class:"config-item"},Ua={class:"tag-list"},Ia={key:3,class:"config-item"},Va={class:"tag-list"},ja={key:5,class:"message assistant"},Ea={class:"bubble-wrapper"},Sa={class:"bubble unrecognized-buttons-card"},Ta={class:"unrecognized-list"},Pa={class:"item-info"},Ra={class:"item-name"},Ha={class:"item-id"},Oa={key:0,class:"item-context"},Wa=["disabled","onClick"],Fa={key:6,class:"message assistant"},qa={class:"bubble-wrapper"},Ja={class:"bubble"},Ga={key:0,class:"quick-options"},Za=["onClick"],Ka={key:0,class:"pending-image"},Qa=["src"],Xa={class:"input-area"},Ya={class:"input-wrapper"},es=["disabled"],ts=["disabled"],as=["disabled"],ss={__name:"ClarifyPanel",props:{sessionId:String,parseResult:Object,status:String,currentConfig:Object,imageUrl:String,streamingContent:String,summaryContent:String},emits:["config-updated","config-confirmed","completed","button-added"],setup(u,{emit:H}){const _=u,o=H,c=g([]),$=g(null),B=g(""),k=g(!1),E=g(null),C=g(null),Z=g(null),S=g(null),r=g(!1),b=g(null),q=g(!1),l=g([]),A=g(!1),T=ue(()=>({pending:"ç­‰å¾…ä¸­",parsing:"åˆ†æä¸­...",summarized:"å¾…ç¡®è®¤",clarifying:"å¯¹è¯ä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"})[_.status]||"");_e(()=>_.parseResult,h=>{var n;h&&_.status==="completed"&&!q.value&&(b.value=h,r.value=!0,Q()),((n=h==null?void 0:h.clarification_questions)==null?void 0:n.length)>0?$.value=h.clarification_questions[0]:$.value=null},{immediate:!0}),_e(()=>_.status,(h,n)=>{var F;h==="parsing"&&n!=="parsing"&&(c.value.push({role:"assistant",content:"æ­£åœ¨åˆ†æé¡µé¢æˆªå›¾ï¼Œè¯·ç¨å€™...",timestamp:new Date}),q.value=!1,r.value=!1,Q()),h==="summarized"&&n==="parsing"&&Q(),h==="clarifying"&&_.parseResult&&(c.value.push({role:"assistant",content:"æˆ‘å·²å®Œæˆåˆæ­¥åˆ†æï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è¦ç¡®è®¤ï¼š",timestamp:new Date}),((F=_.parseResult.clarification_questions)==null?void 0:F.length)>0&&($.value=_.parseResult.clarification_questions[0]),Q())}),_e(()=>_.streamingContent,()=>{_.streamingContent&&Q()});const N=()=>{b.value&&(o("config-confirmed",b.value),q.value=!0,r.value=!1,c.value.push({role:"user",content:"ç¡®è®¤åº”ç”¨æ­¤é…ç½®",timestamp:new Date}),Q())},p=()=>{r.value=!1,c.value.push({role:"user",content:"éœ€è¦é‡æ–°è¯†åˆ«",timestamp:new Date}),c.value.push({role:"assistant",content:"å¥½çš„ï¼Œè¯·é‡æ–°ä¸Šä¼ å›¾ç‰‡æˆ–æè¿°æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¼šé‡æ–°åˆ†æã€‚",timestamp:new Date}),Q()},w=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),I())},P=h=>{C.value=h;const n=new FileReader;return n.onload=F=>{Z.value=F.target.result},n.readAsDataURL(h),!1},J=h=>{var F;const n=(F=h.target.files)==null?void 0:F[0];if(n){if(!["image/png","image/jpeg","image/jpg"].includes(n.type))return;P(n)}h.target.value=""},G=()=>{C.value=null,Z.value=null},U=h=>{S.value=h},I=async()=>{var F,Y;if(!B.value.trim()&&!C.value||k.value)return;const h=B.value.trim(),n=Z.value;B.value="",G(),c.value.push({role:"user",content:h||"(ä¸Šä¼ äº†å›¾ç‰‡)",image:n,timestamp:new Date}),Q(),k.value=!0;try{if(_.sessionId&&(_.status==="summarized"||_.status==="clarifying"||_.status==="completed")){let X="";const i=c.value.length;c.value.push({role:"assistant",content:"",timestamp:new Date,isStreaming:!0});const t=Qe.chatStream(_.sessionId,h,_.currentConfig,v=>{v.type==="content"&&(X+=v.content,c.value[i].content=X,Q())},v=>{c.value[i].isStreaming=!1,c.value[i].content=X||"å¥½çš„ï¼Œæˆ‘å·²æ ¹æ®æ‚¨çš„å»ºè®®æ›´æ–°äº†é…ç½®ã€‚",v&&(b.value=v,r.value=!0,q.value=!1),k.value=!1,Q()},v=>{c.value[i].isStreaming=!1,c.value[i].content=`âŒ ${v||"è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•"}`,k.value=!1,Q()});window._currentChatStream=t}else c.value.push({role:"assistant",content:'è¯·å…ˆä¸Šä¼ é¡µé¢æˆªå›¾å¹¶ç‚¹å‡»"AI è¾…åŠ©å¡«å†™"ï¼Œæˆ‘ä¼šå¸®æ‚¨è¯†åˆ«é¡µé¢å…ƒç´ ã€‚',timestamp:new Date}),k.value=!1}catch(X){c.value.push({role:"assistant",content:`âŒ ${((Y=(F=X.response)==null?void 0:F.data)==null?void 0:Y.message)||"è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•"}`,timestamp:new Date}),k.value=!1}finally{Q()}},te=h=>{B.value=h,I()},ce=async h=>{var n,F,Y;if(!(A.value||l.value.includes(h.suggested_id))){A.value=!0;try{await $e.create({button_id:h.suggested_id,name:{"zh-CN":h.suggested_name_zh,en:h.suggested_name_en||""},description:{"zh-CN":h.context||"",en:""},response_info:{},voice_keywords:[],category:"operation"}),l.value.push(h.suggested_id),b.value&&!((n=b.value.button_list)!=null&&n.includes(h.suggested_id))&&(b.value.button_list||(b.value.button_list=[]),b.value.button_list.push(h.suggested_id)),L.success(`æŒ‰é’® "${h.suggested_name_zh}" æ·»åŠ æˆåŠŸ`),o("button-added",h)}catch(X){const i=((Y=(F=X.response)==null?void 0:F.data)==null?void 0:Y.detail)||X.message||"æ·»åŠ å¤±è´¥";L.error(i)}finally{A.value=!1}}},ze=async()=>{var F,Y,X;if(!((Y=(F=b.value)==null?void 0:F.unrecognized_buttons)!=null&&Y.length))return;const h=b.value.unrecognized_buttons.filter(i=>!l.value.includes(i.suggested_id));if(h.length===0){L.info("æ‰€æœ‰æŒ‰é’®å·²æ·»åŠ ");return}A.value=!0;let n=0;for(const i of h)try{await $e.create({button_id:i.suggested_id,name:{"zh-CN":i.suggested_name_zh,en:i.suggested_name_en||""},description:{"zh-CN":i.context||"",en:""},response_info:{},voice_keywords:[],category:"operation"}),l.value.push(i.suggested_id),b.value&&!((X=b.value.button_list)!=null&&X.includes(i.suggested_id))&&(b.value.button_list||(b.value.button_list=[]),b.value.button_list.push(i.suggested_id)),n++,o("button-added",i)}catch(t){console.error(`æ·»åŠ æŒ‰é’® ${i.suggested_id} å¤±è´¥:`,t)}A.value=!1,n>0&&L.success(`æˆåŠŸæ·»åŠ  ${n} ä¸ªæŒ‰é’®`)},be=()=>{b.value&&(b.value.unrecognized_buttons=[]),c.value.push({role:"assistant",content:'å¥½çš„ï¼Œå·²å¿½ç•¥è¿™äº›æ–°æŒ‰é’®ã€‚å¦‚æœä¹‹åéœ€è¦æ·»åŠ ï¼Œå¯ä»¥åœ¨"é¡µé¢èƒ½åŠ›"åŒºåŸŸç‚¹å‡»"æ–°å¢æŒ‰é’®"æ‰‹åŠ¨æ·»åŠ ã€‚',timestamp:new Date}),Q()},Q=()=>{Fe(()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight)})},V=h=>h?h.replace(/\n/g,"<br>"):"",ye=h=>new Date(h).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(h,n)=>{var Y,X,i,t;const F=de("a-image");return d(),f("div",oa,[e("div",la,[n[2]||(n[2]=me('<div class="assistant-info" data-v-49a691f8><div class="avatar" data-v-49a691f8><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-49a691f8><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z" data-v-49a691f8></path></svg></div><span class="name" data-v-49a691f8>UI config å¡«å†™åŠ©æ‰‹</span></div>',1)),u.status?(d(),f("span",{key:0,class:he(["status-badge",u.status])},[n[1]||(n[1]=e("span",{class:"status-dot"},null,-1)),x(" "+z(T.value),1)],2)):j("",!0)]),e("div",{class:"chat-container",ref_key:"chatContainer",ref:E},[c.value.length===0&&!u.status?(d(),f("div",ia,[...n[3]||(n[3]=[me('<div class="bubble" data-v-49a691f8><div class="welcome-content" data-v-49a691f8><div class="welcome-icon" data-v-49a691f8>ğŸ‘‹</div><div class="welcome-text" data-v-49a691f8><p data-v-49a691f8>ä½ å¥½ï¼ä¸Šä¼ é¡µé¢æˆªå›¾å¹¶ç‚¹å‡»&quot;AI è¾…åŠ©å¡«å†™&quot;ï¼Œæˆ‘å°†å¸®åŠ©æ‚¨è‡ªåŠ¨è¯†åˆ«é¡µé¢å…ƒç´ ã€‚</p><p class="sub" data-v-49a691f8>æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¸‹æ–¹è¾“å…¥æ¡†æè¿°æ‚¨æƒ³è¦é…ç½®çš„é¡µé¢åŠŸèƒ½ã€‚</p></div></div></div>',1)])])):j("",!0),(d(!0),f(pe,null,ke(c.value,(v,K)=>(d(),f("div",{key:K,class:he(["message",v.role])},[e("div",ra,[v.role==="assistant"?(d(),f("div",da,[...n[4]||(n[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})],-1)])])):j("",!0),e("div",ua,[v.image?(d(),f("img",{key:0,src:v.image,class:"chat-image",onClick:se=>U(v.image)},null,8,ca)):j("",!0),e("span",{innerHTML:V(v.content)},null,8,va),v.isStreaming?(d(),f("span",pa,"â–Š")):j("",!0)])]),e("span",ga,z(ye(v.timestamp)),1)],2))),128)),u.status==="parsing"?(d(),f("div",fa,[e("div",ma,[n[7]||(n[7]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",ha,[u.streamingContent?(d(),f(pe,{key:0},[e("pre",_a,z(u.streamingContent),1),n[5]||(n[5]=e("span",{class:"streaming-cursor"},"â–Š",-1))],64)):(d(),f("div",ba,[...n[6]||(n[6]=[e("span",{class:"parsing-icon"},"ğŸ”",-1),x(" æ­£åœ¨åˆ†æé¡µé¢æˆªå›¾ï¼Œè¯†åˆ«å¯äº¤äº’å…ƒç´ ... ",-1)])]))])])])):j("",!0),u.status==="summarized"&&u.summaryContent?(d(),f("div",ya,[e("div",Ca,[n[8]||(n[8]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",wa,[e("pre",ka,z(u.summaryContent),1)])])])):j("",!0),k.value?(d(),f("div",za,[...n[9]||(n[9]=[me('<div class="bubble-wrapper" data-v-49a691f8><div class="avatar small" data-v-49a691f8><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-49a691f8><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z" data-v-49a691f8></path></svg></div><div class="bubble loading" data-v-49a691f8><span class="dot" data-v-49a691f8></span><span class="dot" data-v-49a691f8></span><span class="dot" data-v-49a691f8></span></div></div>',1)])])):j("",!0),r.value&&b.value?(d(),f("div",xa,[e("div",$a,[n[16]||(n[16]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Ma,[n[15]||(n[15]=e("div",{class:"preview-header"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 6L9 17l-5-5"})]),x(" è§£æå®Œæˆï¼ä»¥ä¸‹æ˜¯è¯†åˆ«åˆ°çš„é…ç½®ä¿¡æ¯ï¼š ")],-1)),e("div",Na,[b.value.page_id?(d(),f("div",Aa,[n[10]||(n[10]=e("label",null,"é¡µé¢ IDï¼š",-1)),e("span",Ba,z(b.value.page_id),1)])):j("",!0),b.value.page_name?(d(),f("div",Da,[n[11]||(n[11]=e("label",null,"é¡µé¢åç§°ï¼š",-1)),e("span",null,z(b.value.page_name["zh-CN"]||""),1)])):j("",!0),(Y=b.value.button_list)!=null&&Y.length?(d(),f("div",La,[e("label",null,"è¯†åˆ«åˆ°çš„æŒ‰é’® ("+z(b.value.button_list.length)+"ä¸ª)ï¼š",1),e("div",Ua,[(d(!0),f(pe,null,ke(b.value.button_list,v=>(d(),f("span",{key:v,class:"config-tag"},z(v),1))),128))])])):j("",!0),(X=b.value.optional_actions)!=null&&X.length?(d(),f("div",Ia,[n[12]||(n[12]=e("label",null,"å¯é€‰æ“ä½œï¼š",-1)),e("div",Va,[(d(!0),f(pe,null,ke(b.value.optional_actions,v=>(d(),f("span",{key:v,class:"config-tag accent"},z(v),1))),128))])])):j("",!0)]),e("div",{class:"preview-actions"},[e("button",{class:"action-btn secondary",onClick:p},[...n[13]||(n[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 4v6h6M23 20v-6h-6"}),e("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})],-1),x(" é‡æ–°è¯†åˆ« ",-1)])]),e("button",{class:"action-btn primary",onClick:N},[...n[14]||(n[14]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 6L9 17l-5-5"})],-1),x(" ç¡®è®¤åº”ç”¨ ",-1)])])])])])])):j("",!0),((t=(i=b.value)==null?void 0:i.unrecognized_buttons)==null?void 0:t.length)>0?(d(),f("div",ja,[e("div",Ea,[n[18]||(n[18]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Sa,[n[17]||(n[17]=me('<div class="card-header warning" data-v-49a691f8><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-49a691f8><circle cx="12" cy="12" r="10" data-v-49a691f8></circle><line x1="12" y1="8" x2="12" y2="12" data-v-49a691f8></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-49a691f8></line></svg> å‘ç°æ–°æŒ‰é’® </div><p class="card-desc" data-v-49a691f8>æˆ‘åœ¨å›¾ç‰‡ä¸­è¯†åˆ«åˆ°äº†ä»¥ä¸‹æŒ‰é’®ï¼Œä½†å®ƒä»¬å°šæœªæ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼š</p>',2)),e("div",Ta,[(d(!0),f(pe,null,ke(b.value.unrecognized_buttons,v=>(d(),f("div",{key:v.suggested_id,class:"unrecognized-item"},[e("div",Pa,[e("span",Ra,z(v.suggested_name_zh),1),e("span",Ha,z(v.suggested_id),1),v.context?(d(),f("span",Oa,z(v.context),1)):j("",!0)]),e("button",{class:"add-btn",disabled:l.value.includes(v.suggested_id),onClick:K=>ce(v)},z(l.value.includes(v.suggested_id)?"å·²æ·»åŠ ":"æ·»åŠ "),9,Wa)]))),128))]),e("div",{class:"card-actions"},[e("button",{class:"action-btn secondary",onClick:be}," å¿½ç•¥è¿™äº›æŒ‰é’® "),e("button",{class:"action-btn primary",onClick:ze}," å…¨éƒ¨æ·»åŠ  ")])])])])):j("",!0),$.value&&u.status==="clarifying"?(d(),f("div",Fa,[e("div",qa,[n[19]||(n[19]=e("div",{class:"avatar small"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"})])],-1)),e("div",Ja,z($.value.question_text||$.value),1)]),$.value.options?(d(),f("div",Ga,[(d(!0),f(pe,null,ke($.value.options,v=>(d(),f("button",{key:v,class:"option-btn",onClick:K=>te(v)},z(v),9,Za))),128))])):j("",!0)])):j("",!0)],512),R(F,{width:200,style:{display:"none"},preview:{visible:!!S.value,onVisibleChange:v=>{v||(S.value=null)},src:S.value}},null,8,["preview"]),C.value?(d(),f("div",Ka,[e("img",{src:Z.value},null,8,Qa),e("button",{class:"remove-btn",onClick:G},[...n[20]||(n[20]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):j("",!0),e("div",Xa,[e("div",Ya,[e("label",{class:he(["upload-btn",{disabled:k.value}])},[e("input",{type:"file",accept:"image/png,image/jpeg,.png,.jpg,.jpeg",onChange:J,disabled:k.value},null,40,es),n[21]||(n[21]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),e("polyline",{points:"17 8 12 3 7 8"}),e("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1))],2),oe(e("textarea",{ref:"inputRef","onUpdate:modelValue":n[0]||(n[0]=v=>B.value=v),placeholder:"è¾“å…¥ä¿®æ”¹å»ºè®®æˆ–é—®é¢˜...",disabled:k.value,onKeydown:w,rows:"1"},null,40,ts),[[le,B.value]]),e("button",{class:"send-btn",disabled:!B.value.trim()&&!C.value||k.value,onClick:I},[...n[22]||(n[22]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"})],-1)])],8,as)]),n[23]||(n[23]=e("div",{class:"input-hint"}," Enter å‘é€ Â· Shift+Enter æ¢è¡Œ ",-1))])])}}},ns=Me(ss,[["__scopeId","data-v-49a691f8"]]),os={class:"modal-body"},ls={class:"page-section existing-page"},is={class:"form-content readonly"},rs={class:"form-field"},ds={class:"field-value"},us={class:"form-field"},cs={class:"field-value"},vs={class:"form-field description-field"},ps={class:"field-value description-value"},gs={class:"page-section current-page"},fs={class:"form-content editable"},ms={class:"form-field"},hs={class:"form-field"},_s={class:"form-field description-field"},bs={class:"char-count"},ys={class:"modal-footer"},Cs=["disabled"],ws={key:0,class:"btn-spinner"},ks=["disabled"],zs={key:0,class:"btn-spinner"},xs={__name:"DuplicatePageModal",props:{visible:{type:Boolean,default:!1},existingPage:{type:Object,default:()=>({})},currentConfig:{type:Object,default:()=>({})}},emits:["update:visible","cancel","save-draft","replace-save","config-changed"],setup(u,{emit:H}){const _=u,o=H,c=g({page_id:"",name_zh:"",description_zh:""}),$=g(!1),B=g(!1),k=ue(()=>$.value||B.value);_e(()=>[_.visible,_.currentConfig],([S,r])=>{var b,q;S&&r&&(c.value={page_id:r.page_id||"",name_zh:((b=r.name)==null?void 0:b["zh-CN"])||"",description_zh:((q=r.description)==null?void 0:q["zh-CN"])||""})},{immediate:!0,deep:!0}),_e(c,S=>{o("config-changed",S)},{deep:!0});const E=()=>{o("update:visible",!1),o("cancel")},C=async()=>{$.value=!0;try{await o("save-draft",c.value)}finally{$.value=!1}},Z=async()=>{B.value=!0;try{await o("replace-save",c.value)}finally{B.value=!1}};return(S,r)=>{const b=de("a-modal");return d(),De(b,{open:u.visible,title:null,width:720,footer:null,maskClosable:!1,class:"duplicate-page-modal",onCancel:E},{title:O(()=>[e("div",{class:"modal-header"},[r[4]||(r[4]=e("div",{class:"header-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),r[5]||(r[5]=e("div",{class:"header-content"},[e("h3",null,"å­˜åœ¨åŒåé¡µé¢"),e("p",null,"æ£€æµ‹åˆ°é¡µé¢åç§°/é¡µé¢IDé‡åˆï¼Œè¯·åœ¨å¼¹çª—ä¸­ä¿®æ”¹å½“å‰é¡µé¢åå†ä¿å­˜ï¼Œæ”¯æŒåŒåé¡µé¢ï¼Œå¦‚ä¸æ›´æ”¹ç‚¹å‡»ä¿å­˜ä¿®æ”¹åˆ°åˆ—è¡¨å°†æ˜¾ç¤ºä¸¤ä¸ªåŒåé¡µé¢ã€‚")],-1)),e("button",{class:"close-btn",onClick:E},[...r[3]||(r[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),default:O(()=>{var q,l,A,T,N,p;return[e("div",os,[e("div",ls,[r[9]||(r[9]=e("div",{class:"section-header"},[e("span",{class:"section-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("span",{class:"section-title"},"å·²å­˜åœ¨çš„é¡µé¢")],-1)),e("div",is,[e("div",rs,[r[6]||(r[6]=e("label",null,"é¡µé¢ID:",-1)),e("div",ds,z(((q=u.existingPage)==null?void 0:q.page_id)||"-"),1)]),e("div",us,[r[7]||(r[7]=e("label",null,"é¡µé¢åç§°:",-1)),e("div",cs,z(((A=(l=u.existingPage)==null?void 0:l.name)==null?void 0:A["zh-CN"])||"-"),1)]),e("div",vs,[r[8]||(r[8]=e("label",null,"é¡µé¢æè¿°:",-1)),e("div",ps,z(((N=(T=u.existingPage)==null?void 0:T.description)==null?void 0:N["zh-CN"])||"-"),1)])])]),e("div",gs,[r[14]||(r[14]=e("div",{class:"section-header"},[e("span",{class:"section-icon editable"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})])]),e("span",{class:"section-title"},"å½“å‰é¡µé¢ï¼ˆå¯ä¿®æ”¹ï¼‰")],-1)),e("div",fs,[e("div",ms,[r[10]||(r[10]=e("label",null,[e("span",{class:"required"},"*"),x("é¡µé¢ID: ")],-1)),oe(e("input",{"onUpdate:modelValue":r[0]||(r[0]=w=>c.value.page_id=w),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚: 1.0home_pageï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”"},null,512),[[le,c.value.page_id]]),r[11]||(r[11]=e("span",{class:"field-hint"},"æ ¼å¼: {é¡µé¢ç¼–å·}{è‹±æ–‡åç§°}ï¼Œå¦‚home_pageï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”",-1))]),e("div",hs,[r[12]||(r[12]=e("label",null,"é¡µé¢åç§°:",-1)),oe(e("input",{"onUpdate:modelValue":r[1]||(r[1]=w=>c.value.name_zh=w),type:"text",class:"form-input",placeholder:"è¯·è¾“å…¥é¡µé¢åç§°"},null,512),[[le,c.value.name_zh]])]),e("div",_s,[r[13]||(r[13]=e("label",null,[e("span",{class:"required"},"*"),x("é¡µé¢æè¿°: ")],-1)),oe(e("textarea",{"onUpdate:modelValue":r[2]||(r[2]=w=>c.value.description_zh=w),class:"form-textarea",rows:"6",placeholder:"è¯·è¾“å…¥é¡µé¢æè¿°...",maxlength:"1000"},null,512),[[le,c.value.description_zh]]),e("span",bs,z(((p=c.value.description_zh)==null?void 0:p.length)||0)+"/1000",1)])])])]),e("div",ys,[e("button",{class:"btn btn-cancel",onClick:E},"å–æ¶ˆ"),e("button",{class:"btn btn-draft",onClick:C,disabled:k.value},[$.value?(d(),f("span",ws)):j("",!0),r[15]||(r[15]=x(" ä¿å­˜è‰ç¨¿ ",-1))],8,Cs),e("button",{class:"btn btn-primary",onClick:Z,disabled:k.value},[B.value?(d(),f("span",zs)):j("",!0),r[16]||(r[16]=x(" æ›¿æ¢ä¿å­˜ ",-1))],8,ks)])]}),_:1},8,["open"])}}},$s=Me(xs,[["__scopeId","data-v-bfe7f8ee"]]),Ms={class:"page-editor"},Ns={class:"editor-header"},As={class:"header-left"},Bs={class:"header-title"},Ds={class:"title-icon"},Ls={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Us={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Is={class:"header-actions"},Vs={key:0,class:"unsaved-badge"},js=["disabled"],Es={key:0,class:"btn-spinner dark"},Ss=["disabled"],Ts={key:0,class:"btn-spinner"},Ps={class:"editor-body"},Rs={class:"editor-grid"},Hs={class:"panel panel-left"},Os={class:"panel-card"},Ws={class:"card-body"},Fs=["disabled"],qs={key:0,class:"btn-spinner"},Js={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Gs={class:"panel-card"},Zs={class:"card-body"},Ks={class:"json-preview-container"},Qs={class:"panel panel-center"},Xs={class:"panel-card config-card"},Ys={class:"card-body"},en={class:"panel panel-right"},tn={class:"panel-card ai-card"},an={class:"card-body"},sn={key:0,class:"json-editor-error"},nn={__name:"PageEditor",setup(u){const H=qe(),_=Je(),o=Xe(),c=ue(()=>H.name==="PageCreate"),$=g(""),B=g(null),k=g(""),E=g(null),C=g(null),Z=g(""),S=g(!1),r=g(!1),b=g(!1),q=g(!1),l=g(null),A=g({}),T=g(""),N=g(""),p=g(!1),w=g(!1),P=g(!1),J=g(null),G=g(null),U=g(""),I=g("");let te=null;const ce=ue(()=>{const a=o.draftConfig,s=(a.button_list||[]).filter(y=>y&&y.trim()),M=(a.optional_actions||[]).filter(y=>y&&y.trim()),D={pages:{[a.page_id||"unnamed"]:{name:a.name,description:a.description,buttonList:s,optionalActions:M}}};return JSON.stringify(D,null,2)}),ze=()=>{U.value=ce.value,I.value="",w.value=!0},be=a=>a&&typeof a=="object"?{"zh-CN":a["zh-CN"]||"",en:a.en||"",ja:a.ja||"",ms:a.ms||"","zh-TW":a["zh-TW"]||""}:typeof a=="string"?{"zh-CN":a,en:"",ja:"",ms:"","zh-TW":""}:{"zh-CN":"",en:"",ja:"",ms:"","zh-TW":""},Q=a=>Array.isArray(a)?a.map(s=>s==null?"":String(s)).filter(s=>s.trim()):[],V=()=>{I.value="";let a=null;try{a=JSON.parse(U.value)}catch{I.value="JSON æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•";return}if(!a||typeof a!="object"||!a.pages||typeof a.pages!="object"){I.value="JSON ç»“æ„é”™è¯¯ï¼Œéœ€è¦åŒ…å« pages å¯¹è±¡";return}const s=Object.entries(a.pages);if(s.length===0){I.value="pages ä¸èƒ½ä¸ºç©º";return}const[M,D]=s[0];if(!M||typeof M!="string"){I.value="é¡µé¢ ID æ— æ•ˆ";return}const y=D||{};o.applyUserEdit({page_id:M,name:be(y.name),description:be(y.description),button_list:Q(y.buttonList||y.button_list),optional_actions:Q(y.optionalActions||y.optional_actions)}),w.value=!1,L.success("JSON å·²åº”ç”¨åˆ°è¡¨å•")};Ae(async()=>{if(o.resetConfig(),H.query.project&&(B.value=parseInt(H.query.project,10)),!c.value&&H.params.id)try{const a=await fe.get(H.params.id);o.setOriginalConfig({page_id:a.page_id,name:a.name,description:a.description,button_list:a.button_list||[],optional_actions:a.optional_actions||[]}),$.value=a.screenshot_url||"",B.value=a.project_id||null}catch(a){console.error("Failed to load page:",a),L.error("åŠ è½½é¡µé¢å¤±è´¥"),_.push("/")}});const ye=a=>{$.value=a.file_url,L.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ")},h=a=>{L.error(a.message||"ä¸Šä¼ å¤±è´¥")},n=async()=>{var a,s;if(!$.value){L.warning("è¯·å…ˆä¸Šä¼ é¡µé¢æˆªå›¾");return}S.value=!0,q.value=!0,Z.value="parsing",T.value="",N.value="";try{const M=fe.parseStream($.value,D=>{D.type==="content"&&(T.value+=D.content)},(D,y)=>{S.value=!1,Z.value="completed",E.value=D,T.value="",N.value="",y&&(k.value=y),L.success("AI è§£æå®Œæˆ")},D=>{S.value=!1,Z.value="failed",T.value="",N.value="",L.error(D||"è§£æå¤±è´¥")},(D,y)=>{S.value=!1,Z.value="summarized",N.value=D,T.value="",y&&(k.value=y)});window._currentParseStream=M}catch(M){S.value=!1,Z.value="failed",L.error(((s=(a=M.response)==null?void 0:a.data)==null?void 0:s.message)||"è§£æå¤±è´¥")}},F=a=>{const{conflict:s}=o.tryApplyAiUpdate(a);s?(l.value=a,Ie.confirm({title:"é…ç½®å†²çª",icon:R(Ke),content:"AI å·²æ›´æ–°é…ç½®ï¼Œä½†æ‚¨æœ‰æœªä¿å­˜çš„ä¿®æ”¹ã€‚æ˜¯å¦åº”ç”¨ AI æ›´æ–°ï¼Ÿ",okText:"åº”ç”¨ AI æ›´æ–°",cancelText:"ä¿ç•™æˆ‘çš„ä¿®æ”¹",onOk(){o.forceApplyAiUpdate(l.value),L.success("å·²åº”ç”¨ AI æ›´æ–°")},onCancel(){o.keepUserEdit()}})):L.success("AI è§£æå®Œæˆï¼Œé…ç½®å·²å¡«å……")},Y=a=>{E.value=a},X=a=>{F(a),L.success("é…ç½®å·²åº”ç”¨åˆ°è¡¨å•")},i=()=>{S.value=!1},t=()=>{var a;(a=C.value)!=null&&a.loadButtonOptions&&C.value.loadButtonOptions()},v=a=>{o.applyUserEdit(a)},K=()=>{Ie.confirm({title:"ç¡®è®¤é‡ç½®",content:"ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿæ­¤æ“ä½œå°†æ¸…ç©ºå½“å‰æ‰€æœ‰æœªä¿å­˜çš„å†…å®¹ã€‚",onOk(){$.value="",q.value=!1,k.value="",E.value=null,Z.value="",S.value=!1,o.resetConfig(),L.success("é…ç½®å·²é‡ç½®")}})},se=()=>{var M,D,y,W,ge;const a={},s=o.draftConfig;return(M=s.page_id)!=null&&M.trim()?/^[a-zA-Z0-9_\.]+$/.test(s.page_id)||(a.page_id="åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹"):a.page_id="é¡µé¢ ID ä¸ºå¿…å¡«é¡¹",(y=(D=s.name)==null?void 0:D["zh-CN"])!=null&&y.trim()||(a.name_zh="ä¸­æ–‡åç§°ä¸ºå¿…å¡«é¡¹"),(ge=(W=s.name)==null?void 0:W.en)!=null&&ge.trim()||(a.name_en="è‹±æ–‡åç§°ä¸ºå¿…å¡«é¡¹"),a},ne=async({redirect:a=!0}={})=>{var M,D;const s=se();if(Object.keys(s).length>0)return A.value=s,L.error("è¯·æ£€æŸ¥è¡¨å•é”™è¯¯"),!1;r.value=!0;try{const y=o.draftConfig,W={page_id:y.page_id,name:y.name,description:y.description,button_list:y.button_list.filter(ge=>ge.trim()),optional_actions:y.optional_actions.filter(ge=>ge.trim()),screenshot_url:$.value,project_id:B.value};return c.value?await fe.create(W):await fe.update(H.params.id,W),L.success("ä¿å­˜æˆåŠŸ"),o.isDirty=!1,c.value&&a&&_.push(`/page/${y.page_id}`),!0}catch(y){return L.error(((D=(M=y.response)==null?void 0:M.data)==null?void 0:D.message)||"ä¿å­˜å¤±è´¥"),!1}finally{r.value=!1}},ae=async({redirect:a=!0}={})=>{var M,D,y;const s=(M=o.draftConfig.page_id)==null?void 0:M.trim();if(!s)return L.error("è¯·å…ˆå¡«å†™é¡µé¢ ID"),!1;if(!/^[a-zA-Z0-9_\.]+$/.test(s))return L.error("é¡µé¢ ID åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç‚¹"),!1;b.value=!0;try{const W=o.draftConfig,ge={page_id:s,name:W.name,description:W.description,button_list:W.button_list,optional_actions:W.optional_actions,screenshot_url:$.value,project_id:B.value};return await fe.saveDraft(ge),L.success("è‰ç¨¿å·²ä¿å­˜"),o.isDirty=!1,c.value&&a&&_.replace(`/page/${s}`),!0}catch(W){return L.error(((y=(D=W.response)==null?void 0:D.data)==null?void 0:y.message)||"ä¿å­˜è‰ç¨¿å¤±è´¥"),!1}finally{b.value=!1}},ve=async()=>{var a,s,M;if(c.value){const D=(a=o.draftConfig.page_id)==null?void 0:a.trim(),y=(M=(s=o.draftConfig.name)==null?void 0:s["zh-CN"])==null?void 0:M.trim();if(D)try{const W=await fe.checkDuplicate(D,y);if(W.exists){J.value=W.existing_page,G.value="save",P.value=!0;return}}catch(W){console.error("æ£€æŸ¥åŒåé¡µé¢å¤±è´¥:",W)}}await ne()},Ce=async()=>{var a,s,M;if(c.value){const D=(a=o.draftConfig.page_id)==null?void 0:a.trim(),y=(M=(s=o.draftConfig.name)==null?void 0:s["zh-CN"])==null?void 0:M.trim();if(D)try{const W=await fe.checkDuplicate(D,y);if(W.exists){J.value=W.existing_page,G.value="draft",P.value=!0;return}}catch(W){console.error("æ£€æŸ¥åŒåé¡µé¢å¤±è´¥:",W)}}await ae()},m=a=>{a.page_id&&(o.draftConfig.page_id=a.page_id),a.name_zh&&(o.draftConfig.name["zh-CN"]=a.name_zh),a.description_zh&&(o.draftConfig.description["zh-CN"]=a.description_zh)},ee=async a=>{m(a),P.value=!1,await ae()},ie=async a=>{m(a),P.value=!1,G.value==="save"?await ne():await ae()},re=()=>{P.value=!1,J.value=null,G.value=null},we=async()=>{try{await navigator.clipboard.writeText(ce.value),L.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{L.error("å¤åˆ¶å¤±è´¥")}},Ee=()=>{const a=new Blob([ce.value],{type:"application/json"}),s=URL.createObjectURL(a),M=document.createElement("a");M.href=s,M.download=`${o.draftConfig.page_id||"config"}_${Date.now()}.json`,M.click(),URL.revokeObjectURL(s)},Be=()=>{const a=te;te=null,p.value=!1,a&&a()},Se=()=>{o.isDirty=!1,Be()},Te=async()=>{await ae({redirect:!1})&&Be()},Pe=async()=>{await ne({redirect:!1})&&Be()};Ge((a,s,M)=>{if(o.isDirty){te=M,p.value=!0;return}M()});const Le=a=>{o.isDirty&&(a.preventDefault(),a.returnValue="")};return Ae(()=>{window.addEventListener("beforeunload",Le)}),Ze(()=>{window.removeEventListener("beforeunload",Le)}),_e(()=>H.path,()=>{}),(a,s)=>{const M=de("a-button"),D=de("a-modal");return d(),f("div",Ms,[e("header",Ns,[e("div",As,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=y=>a.$router.push("/"))},[...s[7]||(s[7]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),x(" è¿”å›åˆ—è¡¨ ",-1)])]),s[10]||(s[10]=e("div",{class:"header-divider"},null,-1)),e("div",Bs,[e("span",Ds,[c.value?(d(),f("svg",Ls,[...s[8]||(s[8]=[e("path",{d:"M12 4v16m-8-8h16"},null,-1)])])):(d(),f("svg",Us,[...s[9]||(s[9]=[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"},null,-1),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"},null,-1)])]))]),x(" "+z(c.value?"æ·»åŠ é¡µé¢é…ç½®":"ç¼–è¾‘é¡µé¢é…ç½®"),1)])]),e("div",Is,[Ne(o).isDirty?(d(),f("span",Vs,[...s[11]||(s[11]=[e("span",{class:"dot"},null,-1),x(" æœªä¿å­˜ ",-1)])])):j("",!0),e("button",{class:"action-btn secondary",onClick:K}," é‡ç½® "),e("button",{class:"action-btn secondary",onClick:Ce,disabled:r.value||b.value},[b.value?(d(),f("span",Es)):j("",!0),s[12]||(s[12]=x(" ä¿å­˜è‰ç¨¿ ",-1))],8,js),e("button",{class:"action-btn primary",onClick:ve,disabled:r.value||b.value},[r.value?(d(),f("span",Ts)):j("",!0),s[13]||(s[13]=x(" ä¿å­˜é…ç½® ",-1))],8,Ss)])]),e("div",Ps,[e("div",Rs,[e("aside",Hs,[e("div",Os,[s[15]||(s[15]=me('<div class="card-header" data-v-e79320a2><h3 data-v-e79320a2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e79320a2><rect x="3" y="3" width="18" height="18" rx="2" data-v-e79320a2></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-e79320a2></circle><path d="M21 15l-5-5L5 21" data-v-e79320a2></path></svg> é¡µé¢æˆªå›¾ </h3></div>',1)),e("div",Ws,[R(pt,{modelValue:$.value,"onUpdate:modelValue":s[1]||(s[1]=y=>$.value=y),disabled:S.value,onUploadSuccess:ye,onUploadError:h},null,8,["modelValue","disabled"]),e("button",{class:"ai-parse-btn",onClick:n,disabled:!$.value||S.value},[S.value?(d(),f("span",qs)):(d(),f("svg",Js,[...s[14]||(s[14]=[e("path",{d:"M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 110 2h-1.07A7 7 0 0113 23a7 7 0 01-7.07-7H5a1 1 0 110-2h1a7 7 0 017-7h1V5.73A2 2 0 0112 2z"},null,-1)])])),x(" "+z(S.value?"æ­£åœ¨åˆ†æ...":"AI è¾…åŠ©å¡«å†™"),1)],8,Fs)])]),e("div",Gs,[e("div",{class:"card-header"},[s[19]||(s[19]=e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M16 18l6-6-6-6M8 6l-6 6 6 6"})]),x(" JSON é¢„è§ˆ ")],-1)),e("div",{class:"card-actions"},[e("button",{class:"icon-btn",onClick:ze,title:"å±•å¼€ç¼–è¾‘"},[...s[16]||(s[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M8 3H3v5M16 3h5v5M8 21H3v-5M16 21h5v-5"})],-1)])]),e("button",{class:"icon-btn",onClick:we,title:"å¤åˆ¶"},[...s[17]||(s[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"}),e("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})],-1)])]),e("button",{class:"icon-btn",onClick:Ee,title:"ä¸‹è½½"},[...s[18]||(s[18]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"})],-1)])])])]),e("div",Zs,[e("div",Ks,[e("pre",null,[e("code",null,z(ce.value),1)])])])])]),e("main",Qs,[e("div",Xs,[s[20]||(s[20]=e("div",{class:"card-header"},[e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),x(" é…ç½®è¯¦æƒ… ")])],-1)),e("div",Ys,[R(na,{ref_key:"configEditorRef",ref:C,config:Ne(o).draftConfig,"session-id":k.value,errors:A.value,onConfigChanged:v},null,8,["config","session-id","errors"])])])]),e("aside",en,[e("div",tn,[s[21]||(s[21]=e("div",{class:"card-header"},[e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})]),x(" UI config å¡«å†™åŠ©æ‰‹ ")])],-1)),e("div",an,[R(ns,{"session-id":k.value,"parse-result":E.value,status:Z.value,"current-config":Ne(o).draftConfig,"image-url":$.value,"streaming-content":T.value,"summary-content":N.value,onConfigUpdated:Y,onConfigConfirmed:X,onCompleted:i,onButtonAdded:t},null,8,["session-id","parse-result","status","current-config","image-url","streaming-content","summary-content"])])])])])]),R(D,{open:w.value,"onUpdate:open":s[4]||(s[4]=y=>w.value=y),title:"JSON é…ç½®",width:760,maskClosable:!1,wrapClassName:"json-editor-modal"},{footer:O(()=>[R(M,{onClick:s[3]||(s[3]=y=>w.value=!1)},{default:O(()=>[...s[22]||(s[22]=[x("å–æ¶ˆ",-1)])]),_:1}),R(M,{type:"primary",onClick:V},{default:O(()=>[...s[23]||(s[23]=[x("åº”ç”¨",-1)])]),_:1})]),default:O(()=>[oe(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=y=>U.value=y),class:"json-editor-textarea",rows:"18",spellcheck:"false"},null,512),[[le,U.value]]),I.value?(d(),f("p",sn,z(I.value),1)):j("",!0)]),_:1},8,["open"]),R(D,{open:p.value,"onUpdate:open":s[5]||(s[5]=y=>p.value=y),title:"æœªä¿å­˜çš„æ›´æ”¹",maskClosable:!1,closable:!1},{footer:O(()=>[R(M,{disabled:r.value||b.value,onClick:Se},{default:O(()=>[...s[24]||(s[24]=[x("ç›´æ¥é€€å‡º",-1)])]),_:1},8,["disabled"]),R(M,{loading:b.value,onClick:Te},{default:O(()=>[...s[25]||(s[25]=[x("ä¿æŒè‰ç¨¿",-1)])]),_:1},8,["loading"]),R(M,{type:"primary",loading:r.value,onClick:Pe},{default:O(()=>[...s[26]||(s[26]=[x("ä¿å­˜é…ç½®",-1)])]),_:1},8,["loading"])]),default:O(()=>[s[27]||(s[27]=e("p",null,"å½“å‰å†…å®¹æœªä¿å­˜ï¼Œæ‚¨è¦ç›´æ¥é€€å‡ºã€ä¿æŒè‰ç¨¿è¿˜æ˜¯ä¿å­˜é…ç½®ï¼Ÿ",-1))]),_:1},8,["open"]),R($s,{visible:P.value,"onUpdate:visible":s[6]||(s[6]=y=>P.value=y),"existing-page":J.value,"current-config":Ne(o).draftConfig,onCancel:re,onConfigChanged:m,onSaveDraft:ee,onReplaceSave:ie},null,8,["visible","existing-page","current-config"])])}}},dn=Me(nn,[["__scopeId","data-v-e79320a2"]]);export{dn as default};
