import{r as u,x as z,c as A,o as Z,s as ss,b as n,d as e,l as _,k as C,m as w,t as a,i as v,v as c,J as E,F as $,h as T,p as F,j as i}from"./index-BfuFjEVY.js";import{_ as es,e as f}from"./_plugin-vue_export-helper-CLyVweMD.js";const ts={class:"sampling-page"},ls={class:"page-header"},os={class:"header-actions"},ns=["disabled"],as={class:"status-overview"},is={class:"status-card"},rs={class:"status-info"},ds={class:"status-value"},us={class:"status-card"},vs={class:"status-info"},ps={class:"status-value"},_s={class:"status-card"},cs={class:"status-info"},ms={class:"status-value"},fs={class:"status-card"},bs={class:"status-info"},ks={class:"status-value"},ys={class:"main-content"},gs={class:"config-panel"},ws={class:"panel-header"},xs=["disabled"],Cs={class:"config-form"},Ss={class:"config-group"},hs={class:"form-row"},qs={class:"form-row"},Ms={class:"config-group"},Vs={class:"form-row"},$s={class:"form-row"},Ts={class:"config-group"},Us={class:"form-row checkbox-row"},js={key:0,class:"form-row"},Rs={key:1,class:"form-row"},Ps={class:"config-group"},Ds={class:"form-row checkbox-row"},Is={key:0,class:"form-row"},Ns={class:"config-group"},Ls={class:"form-row"},Bs={class:"requests-panel"},zs={class:"panel-header"},As=["disabled"],Es={key:0,class:"requests-list"},Fs={class:"request-header"},Js={class:"request-server"},Ks={class:"request-time"},Os={class:"request-content"},Hs={class:"request-messages"},Gs={class:"role-badge"},Qs={class:"message-text"},Ws={class:"request-meta"},Xs={class:"meta-item"},Ys={key:0,class:"meta-item"},Zs={class:"request-actions"},se=["onClick","disabled"],ee=["onClick","disabled"],te=["onClick"],le={key:1,class:"empty-state"},oe={class:"empty-hint"},ne={class:"servers-section"},ae={key:0,class:"servers-grid"},ie={class:"server-status"},re={class:"server-info"},de={class:"server-name"},ue={class:"server-transport"},ve={key:1,class:"empty-state small"},pe={class:"modal-content"},_e={class:"modal-header"},ce={class:"modal-body"},me={class:"modal-footer"},fe={class:"modal-content large"},be={class:"modal-header"},ke={key:0,class:"modal-body"},ye={class:"detail-section"},ge={class:"detail-grid"},we={class:"detail-item"},xe={class:"detail-value mono"},Ce={class:"detail-item"},Se={class:"detail-value"},he={class:"detail-item"},qe={class:"detail-value"},Me={class:"detail-item"},Ve={class:"detail-value"},$e={key:0,class:"detail-section"},Te={class:"detail-code"},Ue={class:"detail-section"},je={class:"messages-detail"},Re={class:"role-label"},Pe={class:"message-content"},De={class:"modal-footer"},Ie={__name:"SamplingPage",setup(Ne){const S=u(!1),h=u(!1),q=u(!1),y=u(null),R=u(null),o=z({max_tokens_limit:4096,default_max_tokens:1024,rate_limit_per_minute:60,rate_limit_per_server:10,enable_content_filter:!0,blocked_keywords:[],require_approval:!1,auto_approve_threshold:100,approval_timeout_seconds:300,allowed_servers:[],blocked_servers:[]}),U=u([]),M=u([]),g=u(!1),b=u(!1),r=u(null),V=u(""),k=z({visible:!1,message:"",type:"info"}),P=A({get:()=>o.blocked_keywords.join(`
`),set:l=>{o.blocked_keywords=l.split(`
`).map(s=>s.trim()).filter(s=>s)}}),D=A({get:()=>o.blocked_servers.join(`
`),set:l=>{o.blocked_servers=l.split(`
`).map(s=>s.trim()).filter(s=>s)}});let j=null;Z(async()=>{await I(),j=setInterval(x,1e4)}),ss(()=>{j&&clearInterval(j)});async function I(){S.value=!0;try{await Promise.all([J(),K(),x(),O()])}finally{S.value=!1}}async function J(){try{const l=await f.getSamplingConfig();Object.assign(o,l)}catch{p("åŠ è½½é…ç½®å¤±è´¥","error")}}async function K(){try{R.value=await f.getSamplingStatus()}catch(l){console.error("åŠ è½½çŠ¶æ€å¤±è´¥:",l)}}async function x(){try{const l=await f.getSamplingRequests();U.value=l.requests||[]}catch(l){console.error("åŠ è½½è¯·æ±‚å¤±è´¥:",l)}}async function O(){try{const l=await f.getSamplingServers();M.value=l.servers||[]}catch(l){console.error("åŠ è½½æœåŠ¡å™¨å¤±è´¥:",l)}}async function H(){var l,s;h.value=!0;try{await f.updateSamplingConfig({max_tokens_limit:o.max_tokens_limit,default_max_tokens:o.default_max_tokens,rate_limit_per_minute:o.rate_limit_per_minute,rate_limit_per_server:o.rate_limit_per_server,enable_content_filter:o.enable_content_filter,blocked_keywords:o.blocked_keywords,require_approval:o.require_approval,auto_approve_threshold:o.auto_approve_threshold,approval_timeout_seconds:o.approval_timeout_seconds,blocked_servers:o.blocked_servers}),p("é…ç½®å·²ä¿å­˜","success")}catch(d){p("ä¿å­˜å¤±è´¥: "+(((s=(l=d.response)==null?void 0:l.data)==null?void 0:s.detail)||d.message),"error")}finally{h.value=!1}}async function N(l){var s,d;y.value=l.id;try{await f.approveSamplingRequest(l.id),p("è¯·æ±‚å·²æ‰¹å‡†","success"),await x()}catch(t){p("æ‰¹å‡†å¤±è´¥: "+(((d=(s=t.response)==null?void 0:s.data)==null?void 0:d.detail)||t.message),"error")}finally{y.value=null}}function L(l){r.value=l,V.value="",g.value=!0,b.value=!1}async function G(){var l,s;if(r.value){y.value=r.value.id,g.value=!1;try{await f.rejectSamplingRequest(r.value.id,V.value||"ç”¨æˆ·æ‹’ç»äº†æ­¤è¯·æ±‚"),p("è¯·æ±‚å·²æ‹’ç»","success"),await x()}catch(d){p("æ‹’ç»å¤±è´¥: "+(((s=(l=d.response)==null?void 0:l.data)==null?void 0:s.detail)||d.message),"error")}finally{y.value=null,r.value=null}}}function Q(l){r.value=l,b.value=!0}async function W(){q.value=!0;try{const l=await f.cleanupSamplingRequests();l.expired_count>0?(p(`å·²æ¸…ç† ${l.expired_count} ä¸ªè¿‡æœŸè¯·æ±‚`,"success"),await x()):p("æ²¡æœ‰è¿‡æœŸè¯·æ±‚éœ€è¦æ¸…ç†","info")}catch{p("æ¸…ç†å¤±è´¥","error")}finally{q.value=!1}}function B(l){return!l||!l.content?"":typeof l.content=="string"?l.content:l.content.type==="text"?l.content.text||"":l.content.type==="image"?"[å›¾ç‰‡å†…å®¹]":JSON.stringify(l.content)}function X(l){if(!l)return"";const s=new Date(l),t=(new Date-s)/1e3;return t<60?"åˆšåˆš":t<3600?`${Math.floor(t/60)} åˆ†é’Ÿå‰`:t<86400?`${Math.floor(t/3600)} å°æ—¶å‰`:s.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function p(l,s="info"){k.message=l,k.type=s,k.visible=!0,setTimeout(()=>{k.visible=!1},3e3)}return(l,s)=>{var d;return i(),n("div",ts,[e("header",ls,[s[20]||(s[20]=e("div",{class:"header-content"},[e("h1",null,"ğŸ§  MCP Sampling ç®¡ç†"),e("p",{class:"subtitle"},"ç®¡ç† MCP Server çš„ LLM è¯·æ±‚èƒ½åŠ›")],-1)),e("div",os,[e("button",{class:"btn-refresh",onClick:I,disabled:S.value},[e("span",{class:w({rotating:S.value})},"ğŸ”„",2),s[19]||(s[19]=C(" åˆ·æ–° ",-1))],8,ns)])]),e("section",as,[e("div",is,[s[22]||(s[22]=e("div",{class:"status-icon"},"ğŸ“Š",-1)),e("div",rs,[e("span",ds,a(((d=R.value)==null?void 0:d.pending_requests_count)||0),1),s[21]||(s[21]=e("span",{class:"status-label"},"å¾…å®¡æ ¸è¯·æ±‚",-1))])]),e("div",us,[s[24]||(s[24]=e("div",{class:"status-icon"},"ğŸ–¥ï¸",-1)),e("div",vs,[e("span",ps,a(M.value.length),1),s[23]||(s[23]=e("span",{class:"status-label"},"æ”¯æŒçš„æœåŠ¡å™¨",-1))])]),e("div",_s,[s[26]||(s[26]=e("div",{class:"status-icon"},"â±ï¸",-1)),e("div",cs,[e("span",ms,a(o.rate_limit_per_minute)+"/åˆ†é’Ÿ",1),s[25]||(s[25]=e("span",{class:"status-label"},"å…¨å±€é€Ÿç‡é™åˆ¶",-1))])]),e("div",fs,[s[28]||(s[28]=e("div",{class:"status-icon"},"ğŸ”’",-1)),e("div",bs,[e("span",ks,a(o.require_approval?"å¼€å¯":"å…³é—­"),1),s[27]||(s[27]=e("span",{class:"status-label"},"äººå·¥å®¡æ ¸",-1))])])]),e("div",ys,[e("section",gs,[e("div",ws,[s[29]||(s[29]=e("h2",null,"âš™ï¸ å®‰å…¨é…ç½®",-1)),e("button",{class:"btn-save",onClick:H,disabled:h.value},a(h.value?"ä¿å­˜ä¸­...":"ä¿å­˜é…ç½®"),9,xs)]),e("div",Cs,[e("div",Ss,[s[34]||(s[34]=e("h3",null,"Token é™åˆ¶",-1)),e("div",hs,[s[30]||(s[30]=e("label",null,"æœ€å¤§ Token é™åˆ¶",-1)),v(e("input",{type:"number","onUpdate:modelValue":s[0]||(s[0]=t=>o.max_tokens_limit=t),min:"100",max:"32000"},null,512),[[c,o.max_tokens_limit,void 0,{number:!0}]]),s[31]||(s[31]=e("span",{class:"hint"},"å•æ¬¡è¯·æ±‚å…è®¸çš„æœ€å¤§ token æ•°",-1))]),e("div",qs,[s[32]||(s[32]=e("label",null,"é»˜è®¤ Token æ•°",-1)),v(e("input",{type:"number","onUpdate:modelValue":s[1]||(s[1]=t=>o.default_max_tokens=t),min:"100",max:"8000"},null,512),[[c,o.default_max_tokens,void 0,{number:!0}]]),s[33]||(s[33]=e("span",{class:"hint"},"è¯·æ±‚æœªæŒ‡å®šæ—¶ä½¿ç”¨çš„é»˜è®¤å€¼",-1))])]),e("div",Ms,[s[37]||(s[37]=e("h3",null,"é€Ÿç‡é™åˆ¶",-1)),e("div",Vs,[s[35]||(s[35]=e("label",null,"å…¨å±€é™åˆ¶ï¼ˆ/åˆ†é’Ÿï¼‰",-1)),v(e("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>o.rate_limit_per_minute=t),min:"1",max:"1000"},null,512),[[c,o.rate_limit_per_minute,void 0,{number:!0}]])]),e("div",$s,[s[36]||(s[36]=e("label",null,"æ¯ Server é™åˆ¶ï¼ˆ/åˆ†é’Ÿï¼‰",-1)),v(e("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=t=>o.rate_limit_per_server=t),min:"1",max:"100"},null,512),[[c,o.rate_limit_per_server,void 0,{number:!0}]])])]),e("div",Ts,[s[43]||(s[43]=e("h3",null,"å®¡æ ¸ç­–ç•¥",-1)),e("div",Us,[e("label",null,[v(e("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=t=>o.require_approval=t)},null,512),[[E,o.require_approval]]),s[38]||(s[38]=C(" å¯ç”¨äººå·¥å®¡æ ¸ ",-1))]),s[39]||(s[39]=e("span",{class:"hint"},"å¯ç”¨åï¼Œè¶…è¿‡é˜ˆå€¼çš„è¯·æ±‚éœ€è¦äººå·¥æ‰¹å‡†",-1))]),o.require_approval?(i(),n("div",js,[s[40]||(s[40]=e("label",null,"è‡ªåŠ¨æ‰¹å‡†é˜ˆå€¼",-1)),v(e("input",{type:"number","onUpdate:modelValue":s[5]||(s[5]=t=>o.auto_approve_threshold=t),min:"10",max:"1000"},null,512),[[c,o.auto_approve_threshold,void 0,{number:!0}]]),s[41]||(s[41]=e("span",{class:"hint"},"ä½äºæ­¤ token æ•°çš„è¯·æ±‚è‡ªåŠ¨æ‰¹å‡†",-1))])):_("",!0),o.require_approval?(i(),n("div",Rs,[s[42]||(s[42]=e("label",null,"å®¡æ ¸è¶…æ—¶ï¼ˆç§’ï¼‰",-1)),v(e("input",{type:"number","onUpdate:modelValue":s[6]||(s[6]=t=>o.approval_timeout_seconds=t),min:"60",max:"3600"},null,512),[[c,o.approval_timeout_seconds,void 0,{number:!0}]])])):_("",!0)]),e("div",Ps,[s[46]||(s[46]=e("h3",null,"å†…å®¹è¿‡æ»¤",-1)),e("div",Ds,[e("label",null,[v(e("input",{type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=t=>o.enable_content_filter=t)},null,512),[[E,o.enable_content_filter]]),s[44]||(s[44]=C(" å¯ç”¨å†…å®¹è¿‡æ»¤ ",-1))])]),o.enable_content_filter?(i(),n("div",Is,[s[45]||(s[45]=e("label",null,"ç¦æ­¢å…³é”®è¯",-1)),v(e("textarea",{"onUpdate:modelValue":s[8]||(s[8]=t=>P.value=t),placeholder:"æ¯è¡Œä¸€ä¸ªå…³é”®è¯",rows:"3"},null,512),[[c,P.value]])])):_("",!0)]),e("div",Ns,[s[49]||(s[49]=e("h3",null,"Server æƒé™",-1)),e("div",Ls,[s[47]||(s[47]=e("label",null,"é»‘åå• Server",-1)),v(e("textarea",{"onUpdate:modelValue":s[9]||(s[9]=t=>D.value=t),placeholder:"æ¯è¡Œä¸€ä¸ª Server Key",rows:"2"},null,512),[[c,D.value]]),s[48]||(s[48]=e("span",{class:"hint"},"è¿™äº› Server å°†è¢«ç¦æ­¢ä½¿ç”¨ Sampling",-1))])])])]),e("section",Bs,[e("div",zs,[s[50]||(s[50]=e("h2",null,"ğŸ“‹ å¾…å®¡æ ¸è¯·æ±‚",-1)),e("button",{class:"btn-cleanup",onClick:W,disabled:q.value},a(q.value?"æ¸…ç†ä¸­...":"æ¸…ç†è¿‡æœŸ"),9,As)]),U.value.length>0?(i(),n("div",Es,[(i(!0),n($,null,T(U.value,t=>(i(),n("div",{key:t.id,class:"request-card"},[e("div",Fs,[e("span",Js,a(t.server_key),1),e("span",Ks,a(X(t.created_at)),1)]),e("div",Os,[e("div",Hs,[(i(!0),n($,null,T(t.messages.slice(-2),(m,Y)=>(i(),n("div",{key:Y,class:w(["message-preview",m.role])},[e("span",Gs,a(m.role),1),e("span",Qs,a(B(m)),1)],2))),128))]),e("div",Ws,[e("span",Xs,[s[51]||(s[51]=e("span",{class:"meta-icon"},"ğŸ¯",-1)),C(" "+a(t.max_tokens)+" tokens ",1)]),t.system_prompt?(i(),n("span",Ys,[...s[52]||(s[52]=[e("span",{class:"meta-icon"},"ğŸ“",-1),C(" æœ‰ç³»ç»Ÿæç¤ºè¯ ",-1)])])):_("",!0)])]),e("div",Zs,[e("button",{class:"btn-approve",onClick:m=>N(t),disabled:y.value===t.id}," âœ“ æ‰¹å‡† ",8,se),e("button",{class:"btn-reject",onClick:m=>L(t),disabled:y.value===t.id}," âœ— æ‹’ç» ",8,ee),e("button",{class:"btn-detail",onClick:m=>Q(t)}," è¯¦æƒ… ",8,te)])]))),128))])):(i(),n("div",le,[s[53]||(s[53]=e("div",{class:"empty-icon"},"ğŸ“­",-1)),s[54]||(s[54]=e("p",null,"æš‚æ— å¾…å®¡æ ¸çš„è¯·æ±‚",-1)),e("span",oe,a(o.require_approval?"å½“ MCP Server å‘èµ·é«˜ Token è¯·æ±‚æ—¶ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ":"å½“å‰å®¡æ ¸åŠŸèƒ½å·²å…³é—­"),1)]))])]),e("section",ne,[s[56]||(s[56]=e("h2",null,"ğŸ–¥ï¸ æ”¯æŒ Sampling çš„æœåŠ¡å™¨",-1)),M.value.length>0?(i(),n("div",ae,[(i(!0),n($,null,T(M.value,t=>(i(),n("div",{key:t.server_key,class:w(["server-card",{active:t.listener_active||t.connected}])},[e("div",ie,[e("span",{class:w(["status-dot",{active:t.listener_active||t.connected}])},null,2)]),e("div",re,[e("span",de,a(t.server_key),1),e("span",ue,a(t.transport.toUpperCase()),1)])],2))),128))])):(i(),n("div",ve,[...s[55]||(s[55]=[e("p",null,"æš‚æ— æ”¯æŒ Sampling çš„æœåŠ¡å™¨",-1),e("span",{class:"empty-hint"},"è¯·å…ˆåœ¨ MCP ç®¡ç†é¡µé¢å¯åŠ¨æœåŠ¡å™¨",-1)])]))]),g.value?(i(),n("div",{key:0,class:"modal-overlay",onClick:s[13]||(s[13]=F(t=>g.value=!1,["self"]))},[e("div",pe,[e("div",_e,[s[57]||(s[57]=e("h3",null,"æ‹’ç»è¯·æ±‚",-1)),e("button",{class:"close-btn",onClick:s[10]||(s[10]=t=>g.value=!1)},"Ã—")]),e("div",ce,[s[58]||(s[58]=e("p",null,"è¯·è¾“å…¥æ‹’ç»åŸå› ï¼ˆå¯é€‰ï¼‰ï¼š",-1)),v(e("textarea",{"onUpdate:modelValue":s[11]||(s[11]=t=>V.value=t),placeholder:"ä¾‹å¦‚ï¼šè¯·æ±‚å†…å®¹ä¸ç¬¦åˆè¦æ±‚",rows:"3"},null,512),[[c,V.value]])]),e("div",me,[e("button",{class:"btn-cancel",onClick:s[12]||(s[12]=t=>g.value=!1)},"å–æ¶ˆ"),e("button",{class:"btn-confirm",onClick:G},"ç¡®è®¤æ‹’ç»")])])])):_("",!0),b.value?(i(),n("div",{key:1,class:"modal-overlay",onClick:s[18]||(s[18]=F(t=>b.value=!1,["self"]))},[e("div",fe,[e("div",be,[s[59]||(s[59]=e("h3",null,"è¯·æ±‚è¯¦æƒ…",-1)),e("button",{class:"close-btn",onClick:s[14]||(s[14]=t=>b.value=!1)},"Ã—")]),r.value?(i(),n("div",ke,[e("div",ye,[s[64]||(s[64]=e("h4",null,"åŸºæœ¬ä¿¡æ¯",-1)),e("div",ge,[e("div",we,[s[60]||(s[60]=e("span",{class:"detail-label"},"è¯·æ±‚ ID",-1)),e("span",xe,a(r.value.id),1)]),e("div",Ce,[s[61]||(s[61]=e("span",{class:"detail-label"},"æ¥æº Server",-1)),e("span",Se,a(r.value.server_key),1)]),e("div",he,[s[62]||(s[62]=e("span",{class:"detail-label"},"Max Tokens",-1)),e("span",qe,a(r.value.max_tokens),1)]),e("div",Me,[s[63]||(s[63]=e("span",{class:"detail-label"},"æ¸©åº¦",-1)),e("span",Ve,a(r.value.temperature||"é»˜è®¤"),1)])])]),r.value.system_prompt?(i(),n("div",$e,[s[65]||(s[65]=e("h4",null,"ç³»ç»Ÿæç¤ºè¯",-1)),e("pre",Te,a(r.value.system_prompt),1)])):_("",!0),e("div",Ue,[s[66]||(s[66]=e("h4",null,"æ¶ˆæ¯å†…å®¹",-1)),e("div",je,[(i(!0),n($,null,T(r.value.messages,(t,m)=>(i(),n("div",{key:m,class:w(["message-item",t.role])},[e("span",Re,a(t.role),1),e("div",Pe,a(B(t)),1)],2))),128))])])])):_("",!0),e("div",De,[e("button",{class:"btn-cancel",onClick:s[15]||(s[15]=t=>b.value=!1)},"å…³é—­"),e("button",{class:"btn-reject",onClick:s[16]||(s[16]=t=>L(r.value))},"æ‹’ç»"),e("button",{class:"btn-approve",onClick:s[17]||(s[17]=t=>{N(r.value),b.value=!1})},"æ‰¹å‡†")])])])):_("",!0),k.visible?(i(),n("div",{key:2,class:w(["toast",k.type])},a(k.message),3)):_("",!0)])}}},ze=es(Ie,[["__scopeId","data-v-024e551f"]]);export{ze as default};
