import{r as u,c as z,o as X,a as r,b as n,f as F,d as t,e as y,k as c,F as V,h as j,w as C,g as U,j as i,t as d,m as L,l as N,i as b,v as w,p as A,M as Y,E as Z}from"./index-Dp0wXQeI.js";import{_ as ee,m}from"./_plugin-vue_export-helper-DINGzuyA.js";const te={class:"mcp-manager"},se={class:"page-content"},le={class:"section"},oe={class:"server-grid"},ae={class:"card-header"},re={class:"server-info"},ne={class:"server-details"},ie={class:"server-url"},de={class:"toggle-switch"},ce=["checked","onChange"],ue={class:"card-body"},ve={class:"server-desc"},pe={class:"server-tools"},he={class:"tools-list"},me={class:"card-footer"},fe=["onClick"],_e={class:"section"},ge={class:"section-header"},ke={key:0,class:"empty-state"},ye={key:1,class:"server-grid"},be={class:"card-header"},we={class:"server-info"},xe={class:"server-details"},Me={class:"server-url"},Ce={class:"card-actions"},Se=["onClick"],Be=["onClick"],Ve={class:"card-body"},je={key:0,class:"server-tools"},Ne={class:"tools-list"},De={class:"card-footer"},Ue={key:0,class:"last-check"},Le={class:"form-section"},Pe={class:"form-group"},Te={class:"form-group"},Oe={class:"form-group"},$e={class:"form-group"},ze={class:"form-group"},Fe={class:"json-editor-section"},Ae={key:0,class:"error-text"},Ie={class:"upload-section"},Je={class:"modal-footer"},Ee=["disabled"],Ke={key:0,class:"btn-spinner"},qe={__name:"MCPManager",setup(He){const f=u([]),_=u(!1),x=u("form"),g=u(null),S=u(!1),k=u(""),a=u({name:"",server_url:"",health_check_path:"/health",description:"",tools:[]}),p=u(""),M=u(""),I=z(()=>f.value.filter(s=>s.is_preset)),P=z(()=>f.value.filter(s=>!s.is_preset));X(async()=>{try{f.value=await m.list()}catch(s){console.error("Failed to load MCP servers:",s),r.error("加载服务器列表失败")}});const T=s=>s==="enabled"?"success":s==="error"?"error":"warning",O=s=>({enabled:"已启用",disabled:"已禁用",error:"连接失败"})[s]||s,J=s=>new Date(s).toLocaleString("zh-CN"),E=async s=>{try{const e=s.status!=="enabled";await m.toggle(s.name.toLowerCase(),e),s.status=e?"enabled":"disabled",r.success(e?"已启用":"已禁用")}catch(e){console.error("Failed to toggle server:",e),r.error("切换状态失败")}},K=async s=>{const e=r.loading("正在测试连接...",0);try{const o=await m.test(s.id||0);e(),o.connectivity?r.success("连接成功"):r.error("连接失败")}catch(o){e(),r.error("测试失败: "+o.message)}},q=s=>{var e;g.value=s,a.value={name:s.name,server_url:s.server_url,health_check_path:s.health_check_path||"/health",description:s.description||"",tools:s.tools||[]},p.value=((e=s.tools)==null?void 0:e.join(", "))||"",_.value=!0},H=s=>{Y.confirm({title:"删除服务器",icon:y(Z),content:`确定要删除「${s.name}」吗？`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){try{await m.delete(s.id),f.value=f.value.filter(e=>e.id!==s.id),r.success("删除成功")}catch(e){r.error("删除失败: "+e.message)}}})},R=async s=>{const e=s.target.files[0];e&&await $(e)},W=async s=>{const e=s.dataTransfer.files[0];e&&await $(e)},$=async s=>{var o;if(!s.name.endsWith(".json")){r.error("仅支持 .json 文件");return}if(s.size>1024*1024){r.error("文件大小不能超过 1MB");return}const e=await s.text();try{const v=JSON.parse(e);a.value={name:v.name||"",server_url:v.server_url||"",health_check_path:v.health_check_path||"/health",description:v.description||"",tools:v.tools||[]},p.value=((o=v.tools)==null?void 0:o.join(", "))||"",M.value=e,x.value="form",k.value="",r.success("文件解析成功")}catch{r.error("无效的 JSON 格式")}},D=()=>{_.value=!1,g.value=null,a.value={name:"",server_url:"",health_check_path:"/health",description:"",tools:[]},p.value="",M.value="",k.value="",x.value="form"},G=async()=>{var s,e;if(x.value==="json")try{const o=JSON.parse(M.value);a.value={name:o.name||"",server_url:o.server_url||"",health_check_path:o.health_check_path||"/health",description:o.description||"",tools:o.tools||[]}}catch{k.value="无效的 JSON 格式";return}if(p.value&&(a.value.tools=p.value.split(",").map(o=>o.trim()).filter(Boolean)),!a.value.name||!a.value.server_url){r.warning("请填写必填字段");return}S.value=!0;try{g.value?await m.update(g.value.id,a.value):await m.addConfig(a.value),f.value=await m.list(),D(),r.success("保存成功")}catch(o){r.error("保存失败: "+(((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||o.message))}finally{S.value=!1}};return(s,e)=>{const o=U("a-tab-pane"),v=U("a-tabs"),Q=U("a-modal");return i(),n("div",te,[e[35]||(e[35]=F('<header class="page-header" data-v-0475e156><div class="header-content" data-v-0475e156><div class="title-group" data-v-0475e156><h1 data-v-0475e156><span class="icon-wrapper" data-v-0475e156><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-0475e156><path d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" data-v-0475e156></path></svg></span> MCP 服务器管理 </h1><p class="subtitle" data-v-0475e156>管理 Model Context Protocol 服务器，扩展 AI 模型能力</p></div></div></header>',1)),t("div",se,[t("section",le,[e[16]||(e[16]=t("div",{class:"section-header"},[t("h2",null,[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"3"}),t("path",{d:"M12 1v6m0 6v10M4.22 4.22l4.24 4.24m7.08 7.08l4.24 4.24M1 12h6m6 0h10M4.22 19.78l4.24-4.24m7.08-7.08l4.24-4.24"})]),c(" 预置服务器 ")])],-1)),t("div",oe,[(i(!0),n(V,null,j(I.value,l=>(i(),n("article",{key:l.name,class:"server-card"},[t("div",ae,[t("div",re,[e[11]||(e[11]=t("div",{class:"server-icon preset"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})])],-1)),t("div",ne,[t("h3",null,d(l.name),1),t("span",ie,d(l.server_url),1)])]),t("label",de,[t("input",{type:"checkbox",checked:l.status==="enabled",onChange:h=>E(l)},null,40,ce),e[12]||(e[12]=t("span",{class:"toggle-slider"},null,-1))])]),t("div",ue,[t("p",ve,d(l.description),1),t("div",pe,[e[13]||(e[13]=t("span",{class:"tools-label"},"工具:",-1)),t("div",he,[(i(!0),n(V,null,j(l.tools,h=>(i(),n("span",{key:h,class:"tool-tag"},d(h),1))),128))])])]),t("div",me,[t("button",{class:"test-btn",onClick:h=>K(l)},[...e[14]||(e[14]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),c(" 测试连接 ",-1)])],8,fe),t("span",{class:L(["status-badge",T(l.status)])},[e[15]||(e[15]=t("span",{class:"status-dot"},null,-1)),c(" "+d(O(l.status)),1)],2)])]))),128))])]),t("section",_e,[t("div",ge,[e[18]||(e[18]=t("h2",null,[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})]),c(" 自定义服务器 ")],-1)),t("button",{class:"add-server-btn",onClick:e[0]||(e[0]=l=>_.value=!0)},[...e[17]||(e[17]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[t("path",{d:"M12 4v16m-8-8h16"})],-1),c(" 添加服务器 ",-1)])])]),P.value.length===0?(i(),n("div",ke,[e[20]||(e[20]=F('<div class="empty-illustration" data-v-0475e156><svg viewBox="0 0 200 200" fill="none" data-v-0475e156><circle cx="100" cy="100" r="80" fill="#f1f5f9" data-v-0475e156></circle><rect x="65" y="60" width="70" height="50" rx="4" fill="#e2e8f0" data-v-0475e156></rect><circle cx="80" cy="75" r="4" fill="#cbd5e1" data-v-0475e156></circle><circle cx="95" cy="75" r="4" fill="#cbd5e1" data-v-0475e156></circle><rect x="65" y="120" width="70" height="30" rx="4" fill="#e2e8f0" data-v-0475e156></rect><circle cx="80" cy="135" r="4" fill="#cbd5e1" data-v-0475e156></circle><circle cx="95" cy="135" r="4" fill="#cbd5e1" data-v-0475e156></circle><circle cx="100" cy="100" r="15" fill="#6366f1" opacity="0.2" data-v-0475e156></circle><path d="M95 100h10M100 95v10" stroke="#6366f1" stroke-width="2" stroke-linecap="round" data-v-0475e156></path></svg></div><h3 data-v-0475e156>暂无自定义服务器</h3><p data-v-0475e156>添加您自己的 MCP 服务器来扩展 AI 能力</p>',3)),t("button",{class:"add-btn-primary",onClick:e[1]||(e[1]=l=>_.value=!0)},[...e[19]||(e[19]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[t("path",{d:"M12 4v16m-8-8h16"})],-1),c(" 添加服务器 ",-1)])])])):(i(),n("div",ye,[(i(!0),n(V,null,j(P.value,l=>{var h;return i(),n("article",{key:l.id,class:"server-card custom"},[t("div",be,[t("div",we,[e[21]||(e[21]=t("div",{class:"server-icon custom"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})])],-1)),t("div",xe,[t("h3",null,d(l.name),1),t("span",Me,d(l.server_url),1)])]),t("div",Ce,[t("button",{class:"icon-btn",onClick:B=>q(l),title:"编辑"},[...e[22]||(e[22]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Se),t("button",{class:"icon-btn danger",onClick:B=>H(l),title:"删除"},[...e[23]||(e[23]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,Be)])]),t("div",Ve,[(h=l.tools)!=null&&h.length?(i(),n("div",je,[e[24]||(e[24]=t("span",{class:"tools-label"},"工具:",-1)),t("div",Ne,[(i(!0),n(V,null,j(l.tools,B=>(i(),n("span",{key:B,class:"tool-tag"},d(B),1))),128))])])):N("",!0)]),t("div",De,[t("span",{class:L(["status-badge",T(l.status)])},[e[25]||(e[25]=t("span",{class:"status-dot"},null,-1)),c(" "+d(O(l.status)),1)],2),l.last_check?(i(),n("span",Ue,[e[26]||(e[26]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M12 6v6l4 2"})],-1)),c(" "+d(J(l.last_check)),1)])):N("",!0)])])}),128))]))])]),y(Q,{open:_.value,"onUpdate:open":e[10]||(e[10]=l=>_.value=l),title:g.value?"编辑服务器":"添加 MCP 服务器",width:"640px",footer:null,onCancel:D,class:"server-modal"},{default:C(()=>[y(v,{activeKey:x.value,"onUpdate:activeKey":e[9]||(e[9]=l=>x.value=l),class:"modal-tabs"},{default:C(()=>[y(o,{key:"form",tab:"表单配置"},{default:C(()=>[t("div",Le,[t("div",Pe,[e[27]||(e[27]=t("label",null,[c("服务器名称 "),t("span",{class:"required"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.name=l),type:"text",class:"form-input",placeholder:"My MCP Server"},null,512),[[w,a.value.name]])]),t("div",Te,[e[28]||(e[28]=t("label",null,[c("服务器 URL "),t("span",{class:"required"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.server_url=l),type:"text",class:"form-input",placeholder:"https://mcp.example.com"},null,512),[[w,a.value.server_url]])]),t("div",Oe,[e[29]||(e[29]=t("label",null,"健康检查路径",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.health_check_path=l),type:"text",class:"form-input",placeholder:"/health"},null,512),[[w,a.value.health_check_path]])]),t("div",$e,[e[30]||(e[30]=t("label",null,"工具列表 (逗号分隔)",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>p.value=l),type:"text",class:"form-input",placeholder:"search, retrieve, store"},null,512),[[w,p.value]])]),t("div",ze,[e[31]||(e[31]=t("label",null,"描述",-1)),b(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.description=l),class:"form-textarea",rows:"3",placeholder:"服务器描述..."},null,512),[[w,a.value.description]])])])]),_:1}),y(o,{key:"json",tab:"JSON 编辑"},{default:C(()=>[t("div",Fe,[b(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>M.value=l),class:L(["json-editor",{error:k.value}]),rows:"15",placeholder:'{"name": "...", "server_url": "...", "tools": [...]}'},null,2),[[w,M.value]]),k.value?(i(),n("p",Ae,d(k.value),1)):N("",!0)])]),_:1}),y(o,{key:"upload",tab:"文件上传"},{default:C(()=>[t("div",Ie,[t("label",{class:"upload-area",onDragover:e[8]||(e[8]=A(()=>{},["prevent"])),onDrop:A(W,["prevent"])},[t("input",{type:"file",accept:".json",onChange:R,hidden:""},null,32),e[32]||(e[32]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e[33]||(e[33]=t("p",{class:"upload-title"},"点击或拖拽文件到此区域上传",-1)),e[34]||(e[34]=t("p",{class:"upload-hint"},"支持 .json 格式，最大 1MB",-1))],32)])]),_:1})]),_:1},8,["activeKey"]),t("div",Je,[t("button",{class:"modal-btn secondary",onClick:D},"取消"),t("button",{class:"modal-btn primary",onClick:G,disabled:S.value},[S.value?(i(),n("span",Ke)):N("",!0),c(" "+d(g.value?"保存":"添加"),1)],8,Ee)])]),_:1},8,["open","title"])])}}},Ge=ee(qe,[["__scopeId","data-v-0475e156"]]);export{Ge as default};
